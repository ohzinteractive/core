{"version":3,"sources":["utilities/ArrayUtilities.js","BaseApplication.js","shaders/basic_color/basic_color_vert.glsl","shaders/basic_color/basic_color_frag.glsl","materials/BaseShaderMaterial.js","CameraManager.js","Screen.js","Configuration.js","Time.js","KeyboardInput.js","Input.js","primitives/Sphere.js","editor/shaders/object_picker_vert.glsl","editor/shaders/object_picker_frag.glsl","Mesh.js","primitives/Arrow.js","SceneManager.js","utilities/MathUtilities.js","utilities/CameraUtilities.js","Capabilities.js","shaders/grid/grid_frag.glsl","shaders/grid/grid_vert.glsl","utilities/GeometryUtilities.js","components/Grid.js","render_mode/BaseRender.js","RenderLayers.js","shaders/box_blur/compose_frag.glsl","shaders/box_blur/box_blur_frag.glsl","shaders/copy/copy_frag.glsl","shaders/copy/copy_vert.glsl","render_mode/OutlineRender.js","materials/BlitMaterial.js","shaders/clear/clear_depth_normal_frag.glsl","materials/ClearDepthNormalMaterial.js","shaders/depth_normals/depth_normals_vert.glsl","shaders/depth_normals/depth_normals_frag.glsl","materials/DepthNormalMaterial.js","render_utilities/DepthAndNormalsRenderer.js","render_utilities/Blitter.js","Graphics.js","UI.js","shaders/ui_element/ui_element.vert","shaders/ui_element/ui_element.frag","materials/UIElementMaterial.js","shaders/ui/ss_texture_frag.glsl","shaders/ui/ss_texture_vert.glsl","ui/ui_element_position/ScreenSpacePosition.js","ui/ui_element_position/WorldSpacePosition.js","ui/ui_element_state/UIElementState.js","ui/ui_element_state/OnIdle.js","ui/ui_element_state/OnMouseEnter.js","ui/ui_element_state/OnMouseExit.js","ui/ui_element_state/OnMouseHover.js","components/UIElement.js","shaders/basic_line/basic_line_vert.glsl","shaders/basic_line/basic_line_frag.glsl","components/Line.js","Components.js","canvas_drawer/CanvasDrawer.js","components/AxisHelper.js","primitives/Cube.js","Debug.js","shaders/normal/normal.frag","shaders/normal/normal.vert","materials/NormalMaterial.js","render_mode/DebugNormalsRender.js","utilities/EasingFunctions.js","EventManager.js","utilities/ImageUtilities.js","resource_loader/AbstractLoader.js","resource_loader/JSONLoader.js","utilities/ModelUtilities.js","utilities/MeshSampler.js","ResourceContainer.js","shaders/ssao/ssao_frag.glsl","shaders/ssao/ssao_vert.glsl","materials/SSAOMaterial.js","shaders/ssao/ssao_compose_frag.glsl","materials/SSAOComposeMaterial.js","shaders/depth_normals/debug_normals_frag.glsl","materials/DisplayNormalTextureMaterial.js","materials/BoxBlurMaterial.js","render_utilities/Blurrer.js","render_mode/NormalAORender.js","render_mode/NormalRender.js","utilities/ObjectUtilities.js","PerspectiveCamera.js","static_batcher/GeometryBatch.js","static_batcher/GeometryBatcher.js","RenderLoop.js","resource_loader/TextureLoader.js","resource_loader/GLTFLoader.js","resource_loader/DAELoader.js","resource_loader/TextLoader.js","resource_loader/CubemapLoader.js","components/AudioClip.js","resource_loader/AudioLoader.js","resource_loader/OBJLoader.js","resource_loader/RGBETextureLoader.js","resource_loader/PointArrayLoader.js","resource_loader/HDRCubeTextureLoader.js","resource_loader/GLTFDRACOLoader.js","resource_loader/ResourceBatch.js","canvas_drawer/SimpleTextDrawer.js","utilities/TimeUtilities.js","utilities/Validation.js","index.js"],"names":["ArrayUtilities","source","target","push","apply","array","size","items_left_count","length","i","clone","elem","index","indexOf","splice","points","closest_point","closest_distance","distanceTo","obj","ids","Object","keys","arr","BaseApplication","module","exports","BaseShaderMaterial","vert","frag","uniforms","vertexShader","basic_vert","fragmentShader","basic_frag","_Color","value","THREE","Color","ShaderMaterial","CameraManager","_current","undefined","camera","camera_manager","Screen","width","height","render_width","render_height","width_height","Vector2","dpr","pixel_size","x","y","vector2","multiplyScalar","Configuration","parameters","window","devicePixelRatio","is_mobile","is_ios","is_ipad","vertex_image_unit_supported","min_zoom_distance","max_zoom_distance","max_zoom_distance_scale","zoom_speed","use_fxaa","use_ssaa","background_color","touch_sensitivity","zoom_sensitivity","spin_sensitivity","three_finger_rotation_speed","three_finger_allowed_x_rotation_offset","three_finger_allowed_y_rotation_offset","use_touch_gestures","texture_float_supported","use_ortographic","hover_enabled","rotation_enabled","transparency_amount","show_debug_sphere_on_floor_selection","show_debug_sphere_on_steps_in_floor","display_cleanup_log","navigation_speed_damping","navigation_speed","out_of_bounds_force","mouse_zoom_speed","touch_zoom_speed","json","configuration","Time","___time","Clock","__delta_time","__elapsed_time","__allocated_time","getDelta","getElapsedTime","delta_time","elapsed_time","time","KeyboardInput","ctrlz_pressed","ctrlz_fired","document","onkeydown","on_key_down","bind","onkeyup","on_key_up","onkeypress","on_key_press","e","keyCode","ctrlKey","key","press_key","release_keys","pressed","fired","down","key_name","up","keyboard_input","Input","mouse_pos","last_mouse_pos","mouse_dir","__clicked_time","is_mouse_down","is_mouse_up","rotation_angle","_normalized_mouse_pos","left_mouse_button_down","left_mouse_button_pressed","left_mouse_button_released","middle_mouse_button_down","right_mouse_button_down","right_mouse_button_pressed","right_mouse_button_released","mousewheel","previous_scale","previous_rotation","previous_rotation_dirty","mouse_str","tmp_mouse_velocity","bounding_client","multitouch_active","tapped","initial_zoom_distance","zoom_center","zoom_started","touch_zoom","multi_touch_dir","wheel_delta","mac","pinching_with_trackpad","scrolling_with_trackpad","scrolling_with_mouse","double_click","canvas","previous_pos_x","previous_pos_y","rect","getBoundingClientRect","left","top","container","region","ZingTouch","Region","init","scope","set_mouse_pos","addEventListener","on_double_click","on_focus_lost","on_mouse_up","on_mouse_move","on_touch_move","on_touch_end","one_finger_pan","Pan","numInputs","register","event","detail","data","two_fingers_pan","set","change","three_fingers_pan","touch_zoom_delta","distance","last_zoom_distance","center","gesture","Gesture","end","inputs","state","element","on_gesture_end","start","on_mouse_down","on_mouse_wheel","preventDefault","clientX","clientY","ev","events","get_os","is_mac","console","log","deltaY","is_int","Math","clamp","abs","current","originalEvent","which","changedTouches","middle_mouse_button_released","rotation_delta","normalize","userAgent","navigator","platform","macosPlatforms","windowsPlatforms","iosPlatforms","os","test","n","clear","normalized_mouse_pos","INPUT","Sphere","radius","color","geometry","SphereBufferGeometry","material","MeshBasicMaterial","Mesh","_selectable_material","__get_selectable_material","original_material","stored_layers","layers","mask","Arrow","dir","cone_height","cylinder_height","cylinder_geo","CylinderBufferGeometry","translate","cone_geometry","ConeBufferGeometry","buffer_geometry","BufferGeometryUtils","mergeBufferGeometries","rotateX","quaternion","setFromUnitVectors","Vector3","scale","z","SceneManager","Scene","name","scene","scene_manager","MathUtilities","from_range_start_value","from_range_end_value","to_range_start_value","to_range_end_value","min","max","rgb","r","round","toString","g","b","plane","projected_point","points_on_plane","projectPoint","from","to","t","elements","lerp","x1","x2","v","w","add","CameraUtilities","tmp_mat","Matrix4","tmp_vec","tmp_vec2","Plane","ray","Ray","tmp_size","tmp_unproj","applyQuaternion","NDC","v_fov","fov","PI","h_fov","atan","tan","aspect","distV","far","distH","plane_position","plane_normal","setFromNormalAndCoplanarPoint","get_forward_dir","isPerspectiveCamera","position","unproject_mouse_position","unproject","intersectPlane","zoom_scale","points_sphere","setFromPoints","world_space_center","camera_forward","project_points_on_plane","projected_points_center","box","Box3","getCenter","right","cross","mat","inverse_mat","getInverse","applyMatrix4","getSize","projected_center","zoom","get_zoom_to_fit_rect","bb","isOrthographicCamera","obj_x","obj_y","object_aspect","aspect_ratio","object","getWorldPosition","project","pos","copy","bottom","updateProjectionMatrix","camera_utilities","Capabilities","max_anisotropy","vertex_texture_sampler_available","fp_textures_available","capabilities","GeometryUtilities","geometry_buffer","indices","positions","getAttribute","bar_coordinates","vertices","count","getX","getY","getZ","BufferGeometry","setAttribute","BufferAttribute","Float32Array","add_barycentric_attribute","non_indexed_geometry_buffer","Grid","grid_vert","grid_frag","extensions","derivatives","transparent","depthWrite","plane_geometry","PlaneBufferGeometry","non_indexed_geometry","convert_to_non_indexed_geometry","rotation","BaseRender","context","renderer","RenderLayers","OutlineRender","webgl","main_rt","WebGLRenderTarget","rt1","rt2","compose_material","__get_compose_material","copy_material","__get_copy_material","box_blur_material","__get_box_blur_material","background_material","__get_background_material","copy_plane","PlaneGeometry","frustumCulled","copy_scene","h","setSize","_Screen","updateMatrix","updateMatrixWorld","enable","opaque","disable","outline","_renderer","setClearColor","clear_color","clearTarget","overrideMaterial","render","_MainTex","texture","_SampleDir","_Blur","copy_vert","copy_frag","depthTest","box_blur_frag","compose_frag","Vector4","background_frag","autoClear","BlitMaterial","frag_shader","vert_shader","defines","_Resolution","blending","NoBlending","AlwaysDepth","ClearDepthNormalMaterial","clear_depth","clear_normal","_DepthNormal","DepthNormalMaterial","_FarPlane","DepthAndNormalsRenderer","RT","clear_depth_normal_mat","depth_normal_material","graphics","__resize_RT_if_necessary","blit_clear_with_material","far_plane","Blitter","_blit_scene","_blit_material","_blit_quad","_blit_camera","OrthographicCamera","src","dst","setRenderTarget","dst_RT","Graphics","blitter","no_render","current_render_mode","generateDepthNormalTexture","depth_and_normals_renderer","is_webgl2","canvas_context","context_attributes","msaa","alpha","depth","desynchronized","stencil","antialias","premultipliedAlpha","preserveDrawingBuffer","powerPreference","logarithmicDepthBuffer","getContext","WebGL2RenderingContext","WebGLRenderer","setPixelRatio","get","domElement","getMaxAnisotropy","maxVertexTextures","floatVertexTextures","new_state","constructor","on_exit","on_enter","check_for_resize","__update_current_camera","override_mat","__apply_override_material","buffer","readRenderTargetPixels","clear_stencil","clear_alpha","current_width","clientWidth","current_height","clientHeight","update_size","setViewport","error","src_RT","blit_with_material","blit","blob_callback","ctx","old_width","old_height","new_width","new_height","tile_width","tile_height","divisions_x","parseInt","ceil","divisions_y","ctx_2D","setViewOffset","drawImage","toBlob","clearViewOffset","blob","link","createElement","download","href","URL","createObjectURL","click","onclick","requestAnimationFrame","revokeObjectURL","a","removeAttribute","render_target","UI","ui_elements","_tmp_normalized_pos","ss_scene","autoUpdate","ws_scene","ss_camera","remove","dispose","set_screen_space_coordinate_system","set_world_space_coordinate_system","update_state","children","current_clicked_element","ui","UIElementMaterial","intensity","_ScreenSize","_TextureSize","_PixelOffset","_NDC","_PivotPoint","_DepthOffset","ScreenSpacePosition","WorldSpacePosition","tmp_vec3","UIElementState","ui_element","normalized_mouse_position","OnIdle","is_mouse_over","set_state","_on_enter_state","OnMouseEnter","on_mouse_enter","_on_hover_state","_on_exit_state","OnMouseExit","on_mouse_exit","_on_idle_state","OnMouseHover","__trigger_on_hover","on_mouse_hover","UIElement","is_clickable","position_strategy","current_state","_position","on_hover","mouse_pos_tmp","cached_NDC_position","screen_pos_tmp","texture_size","matrixAutoUpdate","renderOrder","pixel_offset","offset","visible","minFilter","NearestFilter","magFilter","needsUpdate","image","get_size","get_pos_NDC","update","to_screen_position","Box2","setFromCenterAndSize","containsPoint","projected_pos","screen_pos","remove_screen_material","boolean","Line","_Thickness","_Length","_ElapsedTime","line_vs","line_fs","setup","next_position","previous_position","orientation","coverage","accumulated_length","next_point","__get_next_position","previous_point","__get_previous_position","vertexList","nextPositionList","previousPositionList","orientationList","coverageList","setIndex","_length","sub","parent","col","CanvasDrawer","uses_dynamic_font","__textHeight","fontStyle","body","getElementsByTagName","dummy","dummyText","createTextNode","appendChild","offsetHeight","removeChild","text","font","measureText","getFontHeight","ctxOptions","font_color","__draw","draw_canvas","canvas_texture","CanvasTexture","UVMapping","ClampToEdgeWrapping","generateMipMaps","fill","stroke","tl","tr","br","bl","defaultRadius","side","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","AxisHelper","blueAxisMat","LineBasicMaterial","depthFunc","blueAxisGeo","Geometry","blueAxisLine","greenAxisMat","greenAxisGeo","greenAxisLine","redAxisMat","linewidth","redAxisGeo","redAxisLine","Object3D","Cube","segments","BoxGeometry","Debug","Vector3_one","Vector3_zero","canvas_renderer","rt_debug","origin","arrow","axis","position_2d","fillStyle","fillRect","clearRect","strokeStyle","line","cube","forward_dir","forward","basic_color_vert","basic_color_frag","helper","Box3Helper","sphere","input_points","open","catmull","CatmullRomCurve3","updateArcLengths","getSpacedPoints","line_helper","draw_line","SphereGeometry","sphere_mesh","sphere1","curve","options","DEBUG","NormalMaterial","DebugNormalsRender","EasingFunctions","sin","pow","sqrt","sign","cos","bounceOut","EventManager","queue","zoom_changed_evt","store_clickd_evt","point_selected_evt","config_changed","path_substep_completed","path_completed","go_to_store_requested_evt","resource_loaded_evt","service_clicked_evt","unit_pos_updated_evt","floor_changed_evt","on_enter_floor_navigation","on_exit_floor_navigation","on_enter_floor_selection","on_exit_floor_selection","on_enter_outside_navigation","on_exit_outside_navigation","step_selected_evt","payload","callback","fire","store_id","hit_data","step_number","step_index","resource","service","unit_data","floor_id","event_manager","ImageUtilities","getImageData","imagedata","AbstractLoader","resource_id","url","progress","has_finished","has_error","error_message","message","resource_container","JSONLoader","loader","FileLoader","load","set_resource","JSON","parse","__update_progress","__loading_ended","xhr","total","loaded","msg","__set_error","ModelUtilities","result_callback","traverse","child","fromGeometry","geometries","get_mesh","gltf","animations","skinnedMeshes","node","isSkinnedMesh","cloneBones","cloneSkinnedMeshes","isBone","skinnedMesh","skeleton","cloneSkinnedMesh","orderedCloneBones","bones","cloneBone","Skeleton","boneInverses","matrixWorld","cast","receive","castShadow","receiveShadow","object_name","object_type","model_utilities","MeshSampler","sample_count","face_areas","min_area","faces","area","get_face_area","normalized_faces_array","get_uniform_face_distribution","selected_faces","select_random_faces","sampled_data","sample_data_from_faces","sampled_points","sampled_normals","face","w1","random","w2","sample_point_in_face","c","normal","normals","amount","selected_face","minimum_area","extended_triangle_indices","repetitions_needed","j","v1","v2","v3","vec1","vec2","w3","mesh_sampler","ResourceContainer","resources","fire_resource_loaded","SSAOMaterial","_InverseProjMatrix","_ProjectionMatrix","_Bias","_Radius","_SampleKernel","__get_sample_kernel","_RandomRotation","__get_rotation_kernel","sample_kernel","kernel_size","rotation_kernel","Uint8Array","floor","rotation_texture","DataTexture","RGBFormat","wrapS","RepeatWrapping","wrapT","SSAOComposeMaterial","_AO","DisplayNormalTextureMaterial","depth_normals_vert","BoxBlurMaterial","Blurrer","RT1","RT2","box_blur_mat","NormalAORender","ssao_mat","ssao_compose_mat","debug_normals","ssaa","main_RT","SSAO_RT","blurrer","__check_RT_size","__update_uniforms","depth_normals_RT","blur","projectionMatrix","NormalRender","ObjectUtilities","xml","nodeType","attributes","attribute","item","nodeName","nodeValue","hasChildNodes","childNodes","xml_to_json","old","PerspectiveCamera","near","GeometryBatch","batch_width","data_textures","object_names","zero_offset","write_offset","uniform_dirty_count","tmp_uploaded_data_count","uniform_name","default_value_v3","src_tex","__create_rgb_texture","dst_tex","one_pixel_tex","new_data_tex","__add_data_texture","__flood_data_texture_rgb","default_value_v4","__create_rgba_texture","__flood_data_texture_rgba","__create_rgba_float_texture","vector3","use_r","use_g","use_b","obj_index","__get_object_index","data_texture","__get_data_texture","__set_pixel_rgb","one_pixel","last_accessed_index","dirty_count","vector4","use_a","__set_pixel_rgba","upload_budget","__partial_texture_data_upload","__full_texture_data_upload","texture_data","copyTextureToTexture","v4","RGBAFormat","RGBA","FloatType","conosle","src_texture","dst_texture","one_pixel_text","GeometryBatcher","batches","buffer_geometries","attr_accessor_uvs","texture_width","ceilPowerOfTwo","__init_uv_array","uv_index","vertex_count","buffer_attribute","upload_texture_data","uvs","geometry_batcher","RenderLoop","target_application","_frame_id","is_running","frames_passed","__update","post_start","on_pre_render","on_post_render","cancelAnimationFrame","TextureLoader","GLTFLoader","DAELoader","ColladaLoader","TextLoader","CubemapLoader","CubeTextureLoader","setPath","urls","AudioClip","loop","volume","audio","audio_listener","Audio","setBuffer","setLoop","setVolume","play","AudioLoader","OBJLoader","RGBETextureLoader","RGBELoader","setDataType","UnsignedByteType","hdr","PointArrayLoader","parse_path","raw_data","string_array","split","pop","parseFloat","HDRCubeTextureLoader","url_suffix","GLTFDRACOLoader","draco_loader","DRACOLoader","setDecoderPath","setDecoderConfig","type","setDRACOLoader","ResourceBatch","batch_name","resource_loaders","print_error","finished","SimpleTextDrawer","text_margin","text_size","get_text_size","globalAlpha","textBaseline","textAlignment","fillText","TimeUtilities","Validation","Number","str","Components"],"mappings":"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","file":"index.js","sourceRoot":"src","sourcesContent":["export default class ArrayUtilities\r\n{\r\n\tconstructor(){}\r\n\r\n\r\n  static merge_from_to(source, target)\r\n  {\r\n    target.push.apply( target, source );\r\n  }\r\n\r\n  static expand_vec3_array(array, size)\r\n  {\r\n    let items_left_count = size - array.length;\r\n\r\n\t\tfor (let i = 0;i < items_left_count;i++)\r\n    {\r\n      array.push(array[i].clone());\r\n    }\r\n  }\r\n\r\n  static remove_elem(array, elem)\r\n  {\r\n    let index = array.indexOf(elem);\r\n    if (index > -1) {\r\n      array.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  static get_closest_point(points, target)\r\n  {\r\n    let closest_point = points[0];\r\n    let closest_distance = closest_point.distanceTo(target);\r\n    for(let i=1; i< points.length; i++)\r\n    {\r\n      if(points[i].distanceTo(target) < closest_distance)\r\n      {\r\n        closest_point = points[i];\r\n        closest_distance = points[i].distanceTo(target);\r\n      }\r\n    }\r\n    return closest_point;\r\n  }\r\n\r\n  static object_values_to_array(obj) {\r\n    let ids = Object.keys(obj)\r\n    let arr = [];\r\n    for (let i = 0; i < ids.length; i++) {\r\n      arr.push(obj[ids[i]]);\r\n    }\r\n    return arr;\r\n  }\r\n\r\n}\r\n\r\n","export default class BaseApplication\r\n{\r\n\tstart() {}\r\n\tpost_start() {}\r\n\tend() {}\r\n\tupdate() {}\r\n\ton_post_render() {}\r\n\ton_pre_render() {}\r\n\tresources_fully_loaded() {}\r\n}\r\n","module.exports=\"#define GLSLIFY 1\\nvarying vec2 vUv;\\n\\nvoid main()\\n{\\n  vec3 pos = position;\\n  mat4 MVP = projectionMatrix * modelViewMatrix;\\n\\n  gl_Position = MVP * vec4( pos, 1.0 );\\n  vUv = uv;\\n}\";","module.exports=\"#define GLSLIFY 1\\nuniform vec3 _Color;\\n\\nvoid main()\\n{\\n    gl_FragColor = vec4(_Color, 1.0);\\n}\";","import basic_vert from '/shaders/basic_color/basic_color_vert';\r\nimport basic_frag from '/shaders/basic_color/basic_color_frag';\r\n\r\nexport default class BaseShaderMaterial extends THREE.ShaderMaterial\r\n{\r\n\tconstructor(vert, frag, uniforms)\r\n\t{\r\n\r\n\t\tsuper({\r\n\t\t\tvertexShader: vert \t\t|| basic_vert,\r\n\t\t\tfragmentShader: frag \t|| basic_frag,\r\n\t\t\tuniforms: uniforms \t\t|| {\r\n\t\t\t\t_Color: {value: new THREE.Color(\"#FF0000\")}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\n\r\n","class CameraManager {\r\n\tconstructor()\r\n\t{\r\n\t\tthis._current = undefined;\r\n\t}\r\n\r\n\tset current(camera)\r\n\t{\r\n\t\tthis._current = camera;\r\n\t}\r\n\r\n\tget current()\r\n\t{\r\n\t\treturn this._current;\r\n\t}\r\n}\r\n\r\nconst camera_manager = new CameraManager();\r\nmodule.exports = camera_manager;\r\n","class Screen {\r\n\tconstructor()\r\n\t{\r\n\t\tthis.width = 1;\r\n\t\tthis.height = 1;\r\n\r\n\t\tthis.render_width = 1;\r\n\t\tthis.render_height = 1;\r\n\t\tthis.width_height = new THREE.Vector2(this.width, this.height);\r\n\r\n\r\n\t\tthis.dpr = 1;\r\n\t\tthis.pixel_size = new THREE.Vector2(1/this.width, 1/this.height);\r\n\t}\r\n\r\n\tupdate_size(width, height)\r\n\t{\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\r\n\t\tthis.pixel_size = new THREE.Vector2(1/this.width, 1/this.height) ;\r\n\r\n\t\tthis.width_height.x = width  ;\r\n\t\tthis.width_height.y = height ;\r\n\r\n\t\tthis.render_width = width * this.dpr;\r\n\t\tthis.render_height = height * this.dpr;\r\n\r\n\r\n\t}\r\n\r\n\tapply_pixel_density_v2(vector2)\r\n\t{\r\n\t\tvector2.multiplyScalar(1/this.dpr);\r\n\r\n\t\treturn vector2;\r\n\t}\r\n\tapply_pixel_density(value)\r\n\t{\r\n\t\treturn value * (1/this.dpr);\r\n\t}\r\n\r\n\r\n\tget_pixel_size()\r\n\t{\r\n\t\treturn this.pixel_size;\r\n\t}\r\n\r\n\tget aspect_ratio()\r\n\t{\r\n\t\treturn this.width/this.height;\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport default new Screen();\r\n","/*\r\n\r\n  A configuration class used as a singleton\r\n\r\n*/\r\n\r\nclass Configuration {\r\n  constructor(parameters = {}) {\r\n\r\n    this.dpr = window.devicePixelRatio ? window.devicePixelRatio : 1;\r\n    this.is_mobile = false;\r\n    this.is_ios = false;\r\n    this.is_ipad = false;\r\n\r\n    this.vertex_image_unit_supported = true;\r\n\r\n    this.min_zoom_distance = 3000;\r\n\r\n    this.max_zoom_distance = 40000;\r\n    this.max_zoom_distance_scale = 1.1;\r\n    this.zoom_speed = 0.1;\r\n\r\n\r\n\r\n    this.use_fxaa = false;\r\n    this.use_ssaa = true;\r\n\r\n\r\n\r\n    this.background_color = new THREE.Color(0.768,0.768,0.768);\r\n\r\n\r\n\r\n\r\n    //TOUCH\r\n    this.touch_sensitivity = 1.5;\r\n    this.zoom_sensitivity = 0.7;\r\n    this.spin_sensitivity = 2;\r\n    this.three_finger_rotation_speed = 3;\r\n    this.three_finger_allowed_x_rotation_offset = 30;\r\n    this.three_finger_allowed_y_rotation_offset = 20;\r\n\r\n\r\n    this.use_touch_gestures = false;\r\n\r\n\r\n    this.texture_float_supported = false;\r\n\r\n    this.use_ortographic = true;\r\n\r\n    this.hover_enabled = false;\r\n    this.rotation_enabled = false;\r\n\r\n    this.transparency_amount = 0.2;\r\n\r\n    this.show_debug_sphere_on_floor_selection = false;\r\n    this.show_debug_sphere_on_steps_in_floor = false;\r\n    this.display_cleanup_log = false;\r\n\r\n\r\n    this.navigation_speed_damping = 0.74;\r\n    this.navigation_speed = 200;\r\n    this.out_of_bounds_force = 1.5;\r\n    this.mouse_zoom_speed = 0.05;\r\n    this.touch_zoom_speed = 0.5;\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n  from_json(json)\r\n  {\r\n\r\n\r\n  }\r\n}\r\n\r\nconst configuration = new Configuration();\r\nmodule.exports = configuration;\r\n","class Time\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.___time = new THREE.Clock();\r\n\t\tthis.__delta_time = 0;\r\n\t\tthis.__elapsed_time = 0;\r\n\t\tthis.__allocated_time = new THREE.Vector2(0,0);\r\n\t}\r\n\r\n\r\n\tget delta_time()\r\n\t{\r\n\t\treturn this.__delta_time < 0.4? this.__delta_time : 0.016;\r\n\t}\r\n\tget elapsed_time()\r\n\t{\r\n\t\treturn this.__elapsed_time;\r\n\t}\r\n\tget shader_time()\r\n\t{\r\n\t\tthis.__allocated_time.x = this.delta_time;\r\n\t\tthis.__allocated_time.y = this.elapsed_time;\r\n\t\treturn  this.__allocated_time;\r\n\t}\r\n\r\n\t__update()\r\n\t{\r\n\t\tthis.__delta_time = this.___time.getDelta();\r\n\t\tthis.__elapsed_time = this.___time.getElapsedTime();\r\n\t}\r\n}\r\n\r\nconst time = new Time();\r\nmodule.exports = time;\r\n\r\n","export class KeyboardInput\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.ctrlz_pressed = false;\r\n\t\tthis.ctrlz_fired = false;\r\n\r\n\t\tthis.keys = [];\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tdocument.onkeydown \t= this.on_key_down.bind(this);\r\n\t\tdocument.onkeyup \t\t= this.on_key_up.bind(this);\r\n\t\tdocument.onkeypress = this.on_key_press.bind(this);\r\n\t}\r\n\r\n\ton_key_down(e)\r\n\t{\r\n\t\tif(e.keyCode == 90 && e.ctrlKey && !this.ctrlz_fired)\r\n    {\r\n    \tthis.ctrlz_pressed = true;\r\n    \tthis.ctrlz_fired = true;\r\n    } \r\n    if(e.key)\r\n    {\r\n    \tthis.press_key(e.key);\r\n    }\r\n\t}\r\n\ton_key_press(e)\r\n\t{\r\n\t\t\r\n\t}\r\n\ton_key_up(e)\r\n\t{\r\n\t\tthis.release_keys();\r\n\t}\r\n\r\n\tclear()\r\n\t{\r\n\t\tthis.ctrlz_pressed = false;\r\n\t\tfor(let i=0; i< this.keys.length; i++)\r\n\t\t{\r\n\t\t\tthis.keys[i].pressed = false;\r\n\t\t}\r\n\t}\r\n\r\n\trelease_keys()\r\n\t{\r\n\t\tthis.ctrlz_fired = false;\r\n\t\t\r\n\t\tfor(let i=0; i< this.keys.length; i++)\r\n\t\t{\r\n\t\t\tthis.keys[i].fired = false;\r\n\t\t\tthis.keys[i].down = false;\r\n\t\t}\r\n\t}\r\n\r\n\tpress_key(key)\r\n\t{\r\n\t\tfor(let i=0; i< this.keys.length; i++)\r\n\t\t{\r\n\t\t\tif(this.keys[i].key_name === key && !this.keys[i].fired)\r\n\t\t\t{\r\n\t\t\t\tthis.keys[i].pressed = true;\r\n\t\t\t\tthis.keys[i].down = true;\r\n\t\t\t\tthis.keys[i].fired = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tkey_is_pressed(key)\r\n\t{\r\n\t\tfor(let i=0; i< this.keys.length; i++)\r\n\t\t{\r\n\t\t\tif(this.keys[i].key_name === key)\r\n\t\t\t{\r\n\t\t\t\treturn this.keys[i].pressed;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tkey_is_down(key)\r\n\t{\r\n\t\tfor(let i=0; i< this.keys.length; i++)\r\n\t\t{\r\n\t\t\tif(this.keys[i].key_name === key)\r\n\t\t\t{\r\n\t\t\t\treturn this.keys[i].down;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tregister_key(key)\r\n\t{\r\n\t\tthis.keys.push(\r\n\t\t{\r\n\t\t\tkey_name: key,\r\n\t\t\tpressed: false,\r\n\t\t\tdown: false,\r\n\t\t\tup: false,\r\n\t\t\tfired: false\r\n\r\n\t\t});\r\n\t}\r\n\tunregister_key(key_name)\r\n\t{\r\n\t\tlet key = undefined;\r\n\t\tfor(let i=0; i< this.keys.length; i++)\r\n\t\t{\r\n\t\t\tif(this.keys[i].key_name === key_name)\r\n\t\t\t\tkey = this.keys[i];\r\n\t\t}\r\n\r\n\t\tlet index = this.keys.indexOf(key);\r\n    if (index > -1) {\r\n      this.keys.splice(index, 1);\r\n    }\r\n\t}\r\n\r\n}\r\n\r\nconst keyboard_input = new KeyboardInput();\r\nmodule.exports = keyboard_input;","import Screen from '/Screen';\r\nimport Configuration from '/Configuration';\r\nimport Time from '/Time';\r\nimport KeyboardInput from '/KeyboardInput';\r\n\r\nclass Input {\r\n\tconstructor() {\r\n\t\tthis.mouse_pos = new THREE.Vector2();\r\n\t\tthis.last_mouse_pos = new THREE.Vector2();\r\n\t\tthis.mouse_dir = new THREE.Vector2();\r\n\r\n\r\n\t\tthis.__clicked_time = 0;\r\n\t\tthis.__elapsed_time = 0;\r\n\t\tthis.__delta_time = 0;\r\n\r\n\t\tthis.is_mouse_down = false;\r\n\t\tthis.is_mouse_up = false;\r\n\r\n\t\tthis.rotation_angle = 0;\r\n\r\n\t\tthis._normalized_mouse_pos = new THREE.Vector2(0, 0);\r\n\r\n\t\tthis.left_mouse_button_down = false;\r\n\t\tthis.left_mouse_button_pressed = false;\r\n\t\tthis.left_mouse_button_released = false;\r\n\t\tthis.middle_mouse_button_down = false;\r\n\t\tthis.right_mouse_button_down = false;\r\n\t\tthis.right_mouse_button_pressed = false;\r\n\t\tthis.right_mouse_button_released = false;\r\n\r\n\t\tthis.mousewheel = 0;\r\n\r\n\t\tthis.previous_scale = 0;\r\n\t\tthis.previous_rotation = 0;\r\n\t\tthis.previous_rotation_dirty = true;\r\n\r\n\t\tthis.mouse_str = \"mouse\";\r\n\r\n\t\tthis.tmp_mouse_velocity = new THREE.Vector2();\r\n\t\tthis.bounding_client = new THREE.Vector2();\r\n\r\n\t\tthis.multitouch_active = false;\r\n\r\n\t\tthis.tapped = false;\r\n\t\tthis.initial_zoom_distance = 100;\r\n\t\tthis.zoom_center = new THREE.Vector2();\r\n\t\tthis.zoom_started = false;\r\n\t\tthis.touch_zoom = 1;\r\n\r\n\t\tthis.multi_touch_dir = new THREE.Vector2();\r\n\t\tthis.wheel_delta = 0;\r\n\r\n\t\tthis.mac = 'mac';\r\n\t\tthis.pinching_with_trackpad = false;\r\n\t\tthis.scrolling_with_trackpad = false;\r\n\t\tthis.scrolling_with_mouse = false;\r\n\r\n\t\tthis.double_click = false;\r\n\r\n\t\tthis.canvas = undefined;\r\n\r\n\t\t// Input 2.0\r\n\t\tthis.previous_pos_x = 0;\r\n\t\tthis.previous_pos_y = 0;\r\n\t}\r\n\r\n\tmouse_is_within_bounds(rect) {\r\n\t\trect = rect || this.canvas.getBoundingClientRect();\r\n\r\n\t\treturn this.mouse_pos.x > rect.left &&\r\n\t\t\tthis.mouse_pos.x < rect.left + rect.width &&\r\n\t\t\tthis.mouse_pos.y > rect.top &&\r\n\t\t\tthis.mouse_pos.y < rect.top + rect.height;\r\n\t}\r\n\r\n\tinit(container, canvas) {\r\n\t\tthis.canvas = canvas;\r\n\r\n\t\tlet region = new ZingTouch.Region(container, false, false);\r\n\t\tKeyboardInput.init();\r\n\r\n\t\tlet scope = this;\r\n\r\n\t\tregion.bind(container, 'tap', function (e) {\r\n\t\t\tscope.tapped = true;\r\n\t\t\tscope.set_mouse_pos(e);\r\n\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('dblclick', this.on_double_click.bind(this));\r\n\r\n\t\tcontainer.addEventListener('mouseleave', this.on_focus_lost.bind(this));\r\n\r\n\t\tcontainer.addEventListener('mouseup', this.on_mouse_up.bind(this));\r\n\t\tcontainer.addEventListener('mousemove', this.on_mouse_move.bind(this));\r\n\r\n\t\tcontainer.addEventListener('touchmove', this.on_touch_move.bind(this), false);\r\n\t\tcontainer.addEventListener('touchend', this.on_touch_end.bind(this), false);\r\n\r\n\t\t// region.bind(container, 'pan', function(e){\r\n\t\t// \tscope.on_mouse_move(e);\r\n\t\t// \tconsole.log(\"PAN\");\r\n\t\t// });\r\n\t\tlet one_finger_pan = new ZingTouch.Pan({ numInputs: 1 });\r\n\t\tregion.register(\"one_finger_pan\", one_finger_pan);\r\n\t\tregion.bind(container, \"one_finger_pan\", (event) => {\r\n\t\t\tif (event.detail.data.length > 0) {\r\n\t\t\t\t// scope.multi_touch_dir.set(event.detail.data[0].change.x, event.detail.data[0].change.y)\r\n\t\t\t\t// scope.multi_touch_dir.multiplyScalar(scope.__delta_time);\r\n\t\t\t\t// scope.on_mouse_move_zingtouch(event);\r\n\t\t\t}\r\n\r\n\t\t})\r\n\t\tlet two_fingers_pan = new ZingTouch.Pan({ numInputs: 2 });\r\n\t\tregion.register(\"two_fingers_pan\", two_fingers_pan);\r\n\t\tregion.bind(container, \"two_fingers_pan\", (event) => {\r\n\t\t\tif (event.detail.data.length > 0) {\r\n\r\n\t\t\t\t// scope.multi_touch_dir.set(event.detail.data[0].change.x, event.detail.data[0].change.y)\r\n\t\t\t\t// scope.multi_touch_dir.multiplyScalar(scope.__delta_time);\r\n\t\t\t\tscope.multi_touch_dir.set(event.detail.data[0].change.x, event.detail.data[0].change.y)\r\n\t\t\t\tscope.multi_touch_dir.multiplyScalar(scope.__delta_time);\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tlet three_fingers_pan = new ZingTouch.Pan({ numInputs: 3 });\r\n\t\tregion.register(\"three_fingers_pan\", three_fingers_pan);\r\n\t\tregion.bind(container, \"three_fingers_pan\", (event) => {\r\n\t\t\tif (event.detail.data.length > 0) {\r\n\t\t\t\tscope.multi_touch_dir.set(event.detail.data[0].change.x, event.detail.data[0].change.y)\r\n\t\t\t\tscope.multi_touch_dir.multiplyScalar(scope.__delta_time);\r\n\t\t\t}\r\n\r\n\t\t})\r\n\r\n\t\tregion.bind(container, 'distance', function (e) {\r\n\r\n\t\t\tif (!scope.zoom_started) {\r\n\t\t\t\tscope.zoom_started = true;\r\n\t\t\t\tscope.touch_zoom_delta = 0;\r\n\t\t\t\tscope.initial_zoom_distance = e.detail.distance;\r\n\t\t\t\tscope.last_zoom_distance = e.detail.distance;\r\n\r\n\t\t\t\tscope.zoom_center.set(e.detail.center.x, e.detail.center.y);\r\n\t\t\t\tscope.mouse_pos.set(e.detail.center.x, e.detail.center.y);\r\n\t\t\t}\r\n\t\t\tscope.touch_zoom_delta = e.detail.distance - scope.last_zoom_distance;\r\n\t\t\tscope.last_zoom_distance = e.detail.distance;\r\n\t\t\tscope.touch_zoom = 1;\r\n\t\t}, false);\r\n\r\n\t\tlet gesture = new ZingTouch.Gesture();\r\n\t\tgesture.end = (inputs, state, element) => { scope.on_gesture_end(inputs) }\r\n\t\tgesture.start = (inputs, state, element) => { scope.on_mouse_down(inputs) }\r\n\t\tregion.register('shortTap', gesture);\r\n\r\n\t\tregion.bind(container, 'shortTap', function (e) {\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('wheel', this.on_mouse_wheel.bind(this))\r\n    container.addEventListener( 'contextmenu', (event)=>{event.preventDefault()}, false );\r\n\r\n\t\tcontainer.addEventListener(\"mousemove\", (event) => {\r\n\t\t\tthis.mouse_pos.x = event.clientX;\r\n\t\t\tthis.mouse_pos.y = event.clientY;\r\n\t\t\tthis.scrolling_with_mouse = false;\r\n\t\t\tthis.scrolling_with_trackpad = false;\r\n\t\t\tthis.pinching_with_trackpad = false;\r\n\t\t});\r\n\t}\r\n\r\n\tset_mouse_pos(ev) {\r\n\t\tthis.mouse_pos.x = ev.detail.events[0].clientX;\r\n\t\tthis.mouse_pos.y = ev.detail.events[0].clientY;\r\n\t}\r\n\r\n\tget normalized_mouse_pos() {\r\n\t\tthis._normalized_mouse_pos.x = (this.mouse_pos.x / Screen.width) * 2.0 - 1;\r\n\t\tthis._normalized_mouse_pos.y = -1 * ((this.mouse_pos.y / Screen.height) * 2.0 - 1);\r\n\t\treturn this._normalized_mouse_pos;\r\n\t}\r\n\r\n\tget NDC() {\r\n\t\treturn this.normalized_mouse_pos;\r\n\t}\r\n\r\n\tis_mac() {\r\n\t\treturn this.get_os() === this.mac;\r\n\t}\r\n\r\n\ton_double_click(event) {\r\n\t\tthis.double_click = true;\r\n\t}\r\n\r\n\ton_mouse_wheel(event) {\r\n\r\n\r\n\t\tthis.mouse_pos.x = event.clientX;\r\n\t\tthis.mouse_pos.y = event.clientY;\r\n\r\n\t\t// User is using a mac\r\n\t\tif (this.is_mac()) {\r\n\t\t\t// User is pinching\r\n\t\t\tif (event.ctrlKey) {\r\n\t\t\t\t// Negative values means pinch in.\r\n\t\t\t\t// Positive values means pinch out.\r\n\t\t\t\tconsole.log(\"Pinching with a touchpad\", event.deltaY)\r\n\t\t\t\tthis.pinching_with_trackpad = true;\r\n\t\t\t\tthis.scrolling_with_trackpad = false;\r\n\t\t\t\tthis.scrolling_with_mouse = false;\r\n\t\t\t\t// User is scrolling\r\n\t\t\t} else {\r\n\t\t\t\t// User is using the touchpad\r\n\t\t\t\tif (this.is_int(event.deltaY)) {\r\n\t\t\t\t\t// Negative values means scroll up\r\n\t\t\t\t\t// Positive values means scroll down\r\n\t\t\t\t\t// console.log(\"Scrolling with a touchpad\", (event.deltaY))\r\n\t\t\t\t\t// 350 is aprox the maximum value of deltaY on touchpad scroll\r\n\t\t\t\t\tthis.pinching_with_trackpad = false;\r\n\t\t\t\t\tthis.scrolling_with_trackpad = true;\r\n          this.scrolling_with_mouse = false;\r\n\r\n          this.wheel_delta = THREE.Math.clamp(event.deltaY / 350, -1, 1) * -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Negative values means scroll up\r\n\t\t\t\t\t// Positive values means scroll down\r\n\t\t\t\t\t// console.log(\"Scrolling with a mouse\", event.deltaY)\r\n\t\t\t\t\tthis.pinching_with_trackpad = false;\r\n\t\t\t\t\tthis.scrolling_with_trackpad = false;\r\n\t\t\t\t\tthis.scrolling_with_mouse = true;\r\n\r\n\t\t\t\t\tthis.wheel_delta = event.deltaY / Math.abs(event.deltaY);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//probably windows\r\n\t\t\tthis.pinching_with_trackpad = false;\r\n\t\t\tthis.scrolling_with_trackpad = false;\r\n\t\t\tthis.scrolling_with_mouse = true;\r\n\r\n\t\t\tif (Math.abs(event.deltaY) < 0.0001)\r\n\t\t\t\tthis.wheel_delta = 0;\r\n\t\t\telse\r\n\t\t\t\tthis.wheel_delta = event.deltaY / Math.abs(event.deltaY);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\ton_mouse_down(inputs) {\r\n\t\tthis.mouse_pos.x = inputs[0].current.clientX;\r\n\t\tthis.mouse_pos.y = inputs[0].current.clientY;\r\n\r\n\t\tthis.multitouch_active = inputs.length > 1;\r\n\r\n\t\tthis.mouse_dir.x = 0;\r\n\t\tthis.mouse_dir.y = 0;\r\n\r\n\r\n\t\tthis.__clicked_time = this.__elapsed_time;\r\n\t\tthis.is_mouse_down = true;\r\n\t\tthis.is_mouse_up = false;\r\n\r\n\t\tswitch (inputs[0].current.originalEvent.which) {\r\n\t\t\tcase 1:\r\n\t\t\t\tthis.left_mouse_button_down = true;\r\n\t\t\t\tthis.left_mouse_button_pressed = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2: this.middle_mouse_button_down = true; break;\r\n\t\t\tcase 3:\r\n\t\t\t\tthis.right_mouse_button_down = true;\r\n\t\t\t\tthis.right_mouse_button_pressed = true;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault: this.left_mouse_button_down = true; this.left_mouse_button_pressed = true; break;\r\n\t\t}\r\n\r\n\r\n\t\tthis.wheel_delta = 0;\r\n\t\tthis.previous_scale = 0;\r\n\t\tthis.previous_rotation = 0;\r\n\r\n\r\n\t}\r\n\r\n\tmouse_clicked() {\r\n\t\treturn this.tapped;\r\n\t}\r\n\r\n\ton_touch_move(e) {\r\n\t\tthis.on_mouse_move({ clientX: e.changedTouches[0].clientX, clientY: e.changedTouches[0].clientY})\r\n\t}\r\n\r\n\ton_touch_end(e) {\r\n\t\tthis.on_gesture_end([{ current: { originalEvent: e } }])\r\n\t}\r\n\r\n\ton_mouse_up(e) {\r\n\t\tthis.on_gesture_end([ { current: { originalEvent: e } } ])\r\n\t}\r\n\r\n\ton_gesture_end(inputs) {\r\n\t\tthis.multitouch_active = inputs ? (inputs.length > 1) : false;\r\n\t\tthis.is_mouse_up = true;\r\n\t\tthis.zoom_started = false;\r\n\t\tthis.touch_zoom = 1;\r\n\t\tthis.mouse_dir.x = 0;\r\n\t\tthis.mouse_dir.y = 0;\r\n\t\tthis.previous_scale = 0;\r\n\t\tthis.previous_rotation = 0;\r\n\t\tthis.wheel_delta = 0;\r\n\r\n\t\tthis.left_mouse_button_down = false;\r\n\t\tthis.middle_mouse_button_down = false;\r\n\t\tthis.right_mouse_button_down = false;\r\n\r\n\t\tif (inputs) {\r\n\t\t\tswitch (inputs[0].current.originalEvent.which) {\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tthis.left_mouse_button_released = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tthis.middle_mouse_button_released = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tthis.right_mouse_button_released = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis.left_mouse_button_released = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.is_mouse_down = false;\r\n\t\tthis.previous_rotation_dirty = true;\r\n\t\tthis.rotation_delta = 0;\r\n\t}\r\n\r\n\r\n\ton_focus_lost() {\r\n\t\tthis.on_gesture_end();\r\n\t\tthis.left_mouse_button_released = true;\r\n\t\tthis.middle_mouse_button_released = true;\r\n\t\tthis.right_mouse_button_released = true;\r\n\t\tthis.left_mouse_button_released = true;\r\n\r\n\t}\r\n\r\n\ttime_since_last_mouse_down() {\r\n\t\treturn this.__elapsed_time - this.__clicked_time;\r\n\t}\r\n\r\n\ton_mouse_move(event) {\r\n\t\tthis.mouse_pos.x = event.clientX;\r\n\t\tthis.mouse_pos.y = event.clientY;\r\n\r\n\t\tthis.mouse_dir.set(this.mouse_pos.x - this.previous_pos_x,\r\n\t\t\t\t\t\t\t\t\t\t\t this.mouse_pos.x - this.previous_pos_y);\r\n\r\n\t\tthis.mouse_dir.normalize();\r\n\r\n\t\tthis.previous_pos_x = this.mouse_pos.x;\r\n\t\tthis.previous_pos_y = this.mouse_pos.x;\r\n\t}\r\n\r\n\ton_mouse_move_zingtouch(event) {\r\n\t\tif (event.detail.data.length > 0) {\r\n\t\t\tthis.set_mouse_pos(event);\r\n\t\t\tthis.mouse_dir.set(event.detail.data[0].change.x, event.detail.data[0].change.y)\r\n\t\t\t// this.mouse_dir.x *=  Screen.height / Screen.width;\r\n\r\n\t\t\t// this.mouse_dir.multiplyScalar(this.__delta_time/window.devicePixelRatio);\r\n\t\t}\r\n\t}\r\n\r\n\tget_os() {\r\n\t\tvar userAgent = window.navigator.userAgent,\r\n\t\t\tplatform = window.navigator.platform,\r\n\t\t\tmacosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'],\r\n\t\t\twindowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'],\r\n\t\t\tiosPlatforms = ['iPhone', 'iPad', 'iPod'],\r\n\t\t\tos = null;\r\n\r\n\t\tif (macosPlatforms.indexOf(platform) !== -1) {\r\n\t\t\tos = 'mac';\r\n\t\t} else if (iosPlatforms.indexOf(platform) !== -1) {\r\n\t\t\tos = 'ios';\r\n\t\t} else if (windowsPlatforms.indexOf(platform) !== -1) {\r\n\t\t\tos = 'windows';\r\n\t\t} else if (/Android/.test(userAgent)) {\r\n\t\t\tos = 'android';\r\n\t\t} else if (!os && /Linux/.test(platform)) {\r\n\t\t\tos = 'linux';\r\n\t\t}\r\n\r\n\t\treturn os;\r\n\t}\r\n\r\n\tis_int(n) {\r\n\t\treturn n % 1 === 0;\r\n\t}\r\n\r\n\tclear() {\r\n\r\n\t\tthis.__elapsed_time = Time.elapsed_time;\r\n\t\tthis.__delta_time = Time.delta_time;\r\n\t\tthis.is_mouse_up = false;\r\n\t\tthis.wheel_delta = 0;\r\n\t\tthis.rotation_delta = 0;\r\n\r\n\t\tthis.double_click = false;\r\n\r\n\r\n\t\tthis.tapped = false;\r\n\t\tthis.mouse_dir.multiplyScalar(0);\r\n\t\tthis.multi_touch_dir.multiplyScalar(0);\r\n\t\tthis.left_mouse_button_pressed = false;\r\n\t\tthis.left_mouse_button_released = false;\r\n\r\n\t\tthis.right_mouse_button_pressed = false;\r\n\t\tthis.right_mouse_button_released = false;\r\n\t\tKeyboardInput.clear();\r\n\r\n\t}\r\n\r\n}\r\n\r\nconst INPUT = new Input();\r\nmodule.exports = INPUT;\r\n","export default class Sphere extends THREE.Mesh\r\n{\r\n\tconstructor(radius, color)\r\n\t{\r\n    color = color || \"#FF0000\";\r\n    radius = radius || 1;\r\n    let geometry = new THREE.SphereBufferGeometry( radius, 64, 64);\r\n    let material = new THREE.MeshBasicMaterial( {color: color} );\r\n\t\tsuper(geometry, material);\r\n\t}\r\n}","module.exports=\"#define GLSLIFY 1\\nvoid main()\\n{\\n  vec3 pos = position;\\n  mat4 MVP = projectionMatrix * modelViewMatrix;\\n\\n  gl_Position = MVP * vec4( pos, 1.0 );\\n  //gl_Position.zw -= 0.1;\\n}\";","module.exports=\"#define GLSLIFY 1\\nuniform vec3 _Color;\\n\\nvoid main()\\n{\\n    gl_FragColor = vec4(_Color, 1.0);\\n}\";","import vert from '/editor/shaders/object_picker_vert';\r\nimport frag from '/editor/shaders/object_picker_frag';\r\nexport default class Mesh extends THREE.Mesh\r\n{\r\n\tconstructor(geometry, material)\r\n\t{\r\n\t\tsuper(geometry, material);\r\n\r\n\t\tthis._selectable_material = this.__get_selectable_material();\r\n\t\tthis.original_material = this.material;\r\n\t\tthis.stored_layers = this.layers.mask;\r\n\t}\r\n\r\n\t__get_selectable_material()\r\n\t{\r\n\t\treturn new THREE.ShaderMaterial({\r\n\t\t\tuniforms: {\r\n\t\t\t\t_Color: {value: new THREE.Color()}\r\n\t\t\t},\r\n\t\t\tvertexShader: vert,\r\n      fragmentShader: frag\r\n\t\t});\r\n\t}\r\n\r\n\trestore_material()\r\n\t{\r\n\t\tthis.material = this.original_material;\r\n\t}\r\n\r\n\tstore_layer_state()\r\n\t{\r\n\t\tthis.stored_layers = this.layers.mask;\r\n\t}\r\n\trestore_layer_state()\r\n\t{\r\n\t\tthis.layers.mask = this.stored_layers;\r\n\t}\r\n\r\n\tget selectable_material()\r\n\t{\r\n\t\treturn this._selectable_material;\r\n\t}\r\n}\r\n","import Mesh from '/Mesh';\r\n\r\nexport default class Arrow extends Mesh\r\n{\r\n\tconstructor(color, length, dir)\r\n\t{\r\n\t\tcolor = color || \"#FF0000\";\r\n\t\tlength = length || 1;\r\n\r\n\t\tlet cone_height = 0.4;\r\n\t\tlet cylinder_height = length - cone_height;\r\n\t\tlet cylinder_geo = new THREE.CylinderBufferGeometry( 0.01, 0.01, cylinder_height, 32 );\r\n\t\tcylinder_geo.translate(0,cylinder_height/2,0);\r\n\t\tlet cone_geometry = new THREE.ConeBufferGeometry( 0.1, cone_height, 32 );\r\n\t\tcone_geometry.translate(0, cylinder_height+cone_height/2, 0);\r\n\t  let buffer_geometry = THREE.BufferGeometryUtils.mergeBufferGeometries([cylinder_geo, cone_geometry]);\r\n\t  buffer_geometry.rotateX(3.14/2);\r\n    let material = new THREE.MeshBasicMaterial( {color: color} );\r\n\t\tsuper(buffer_geometry, material);\r\n\r\n\t\tif(dir)\r\n\t\t\tthis.quaternion.setFromUnitVectors(new THREE.Vector3(0,0,1), dir);\r\n\t}\r\n\r\n\tset dir(dir)\r\n\t{\r\n\t\tthis.quaternion.setFromUnitVectors(new THREE.Vector3(0,0,1), dir);\r\n\t}\r\n\tset length(value)\r\n\t{\r\n\t\tthis.scale.z = value;\r\n\t}\r\n}\r\n","class SceneManager\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis._current = new THREE.Scene();\r\n\t\tthis._current.name = \"default_scene\";\r\n\r\n\t}\r\n\r\n\tadd_scene(name)\r\n\t{\r\n\r\n\t}\r\n\r\n\tget current()\r\n\t{\r\n\t\treturn this._current;\r\n\t}\r\n\r\n\tset current(scene)\r\n\t{\r\n\t\tthis._current = scene;\r\n\t}\r\n}\r\n\r\nconst scene_manager = new SceneManager();\r\nmodule.exports = scene_manager;","export default class MathUtilities\r\n{\r\n\tconstructor(){}\r\n\r\n\tstatic linear_map(value,\r\n             from_range_start_value,\r\n             from_range_end_value,\r\n             to_range_start_value,\r\n             to_range_end_value)\r\n  {\r\n      return ((value - from_range_start_value)/ (from_range_end_value - from_range_start_value)) * (to_range_end_value - to_range_start_value) + to_range_start_value;\r\n  }\r\n\r\n  static between(value, min, max)\r\n  {\r\n\t\treturn (value >= min && value <= max)\r\n\r\n  }\r\n\r\n  static rgb_to_hex(rgb) {\r\n    rgb.r = Math.round(rgb.r * 255).toString(16);\r\n    rgb.g = Math.round(rgb.g * 255).toString(16);\r\n    rgb.b = Math.round(rgb.b * 255).toString(16);\r\n\r\n    if (rgb.r.length == 1)\r\n      rgb.r = \"0\" + rgb.r;\r\n    if (rgb.g.length == 1)\r\n      rgb.g = \"0\" + rgb.g;\r\n    if (rgb.b.length == 1)\r\n      rgb.b = \"0\" + rgb.b;\r\n\r\n    return \"#\" + rgb.r + rgb.g + rgb.b;\r\n  }\r\n\r\n  static project_points_on_plane(points, plane)\r\n  {\r\n    let projected_point = new THREE.Vector3();\r\n    let points_on_plane = [];\r\n    for(let i=0; i< points.length; i++)\r\n    {\r\n      plane.projectPoint(points[i], projected_point);\r\n      points_on_plane.push(projected_point.clone());\r\n    }\r\n\r\n    return points_on_plane;\r\n  }\r\n\r\n  static matrix4_lerp(from,to,target, t)\r\n  {\r\n    for(let i=0; i< 16; i++)\r\n    {\r\n      target.elements[i] = THREE.Math.lerp(from.elements[i], to.elements[i], t);\r\n    }\r\n  }\r\n\r\n  static equals(x1, x2) {\r\n    return Math.abs(x1 - x2) < 0.000001\r\n  }\r\n\r\n  static perspective_divide(v)\r\n  {\r\n    v.x /= v.w;\r\n    v.y /= v.w;\r\n    v.z /= v.w;\r\n    return v;\r\n  }\r\n\r\n  static points_average(points)\r\n  {\r\n    let center = points[0].clone();\r\n    for(let i=1; i< points.length; i++)\r\n    {\r\n      center.add(points[i]);\r\n    }\r\n    center.multiplyScalar(1/points.length);\r\n    return center;\r\n  }\r\n}\r\n","import CameraManager from '/CameraManager';\r\nimport Input from '/Input';\r\nimport Sphere from '/primitives/Sphere';\r\nimport Arrow from '/primitives/Arrow';\r\nimport SceneManager from '/SceneManager';\r\nimport MathUtilities from '/utilities/MathUtilities';\r\nimport Screen from '/Screen';\r\n\r\nclass CameraUtilities\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.tmp_mat = new THREE.Matrix4();\r\n\t\tthis.tmp_vec = new THREE.Vector3(0,0,1);\r\n\t\tthis.tmp_vec2 = new THREE.Vector3(0,0,0);\r\n\t\tthis.plane = new THREE.Plane();\r\n\t\tthis.ray = new THREE.Ray();\r\n\r\n    this.tmp_size = new THREE.Vector3();\r\n    this.tmp_unproj = new THREE.Vector3();\r\n\t}\r\n\r\n  get_up_dir(camera) {\r\n    camera = camera || CameraManager.current;\r\n    this.tmp_vec.set(0, 1, 0);\r\n    this.tmp_vec.applyQuaternion(camera.quaternion);\r\n\r\n    return this.tmp_vec;\r\n  }\r\n\tget_forward_dir(camera)\r\n\t{\r\n    camera = camera || CameraManager.current;\r\n\t\tthis.tmp_vec.set(0,0,1);\r\n\t\tthis.tmp_vec.applyQuaternion(camera.quaternion);\r\n\r\n\t\treturn this.tmp_vec;\r\n\r\n\t}\r\n\tget_right_dir(camera)\r\n\t{\r\n    camera = camera || CameraManager.current;\r\n\t\tthis.tmp_vec.set(1,0,0);\r\n  \t\tthis.tmp_vec.applyQuaternion(camera.quaternion);\r\n  \t\treturn this.tmp_vec;\r\n\r\n\t}\r\n\r\n\tunproject_mouse_position(NDC, camera)\r\n  {\r\n    camera = camera || CameraManager.current;\r\n    let v_fov = (camera.fov/2) * Math.PI/180;\r\n    let h_fov = (2 * Math.atan(Math.tan(v_fov) * camera.aspect))/2;\r\n\r\n\r\n    let distV = Math.tan(v_fov) * camera.far;\r\n    let distH = Math.tan(h_fov) * camera.far;\r\n\r\n    this.tmp_vec.set(distH * NDC.x , distV * NDC.y, -camera.far).normalize();\r\n\r\n    return this.tmp_vec.applyQuaternion(camera.quaternion);\r\n  }\r\n\r\n  get_plane_intersection(plane_position, plane_normal, NDC, camera)\r\n  {\r\n    camera = camera || CameraManager.current;\r\n    NDC = NDC || Input.normalized_mouse_pos;\r\n\r\n\t\tthis.plane.setFromNormalAndCoplanarPoint(plane_normal || this.get_forward_dir(camera), plane_position);\r\n    if(camera.isPerspectiveCamera)\r\n    {\r\n      this.ray.set(camera.position, this.unproject_mouse_position(NDC, camera));\r\n    }\r\n    else\r\n    {\r\n      this.tmp_unproj.set(NDC.x, NDC.y, 1).unproject(camera);\r\n      this.ray.set(camera.position, this.tmp_unproj);\r\n    }\r\n\r\n    this.ray.intersectPlane(this.plane, this.tmp_vec2);\r\n    return this.tmp_vec2;\r\n  }\r\n\r\n\r\n\r\n\r\n  fit_points_on_camera(points, zoom_scale = 1)\r\n  {\r\n    let points_sphere = new THREE.Sphere().setFromPoints(points);\r\n    let world_space_center = points_sphere.center;\r\n    let camera_forward = this.get_forward_dir(CameraManager.current).clone();\r\n\r\n    let plane = new THREE.Plane().setFromNormalAndCoplanarPoint(camera_forward, world_space_center);\r\n\r\n\r\n\r\n    let points_on_plane = MathUtilities.project_points_on_plane(points, plane)\r\n\r\n    let projected_points_center = new THREE.Vector3();\r\n    let box =  new THREE.Box3().setFromPoints(points_on_plane);\r\n    box.getCenter(projected_points_center);\r\n\r\n\r\n    let up = new THREE.Vector3(0,1,0).applyQuaternion(CameraManager.current.quaternion)\r\n    let right = up.clone().cross(camera_forward).normalize();\r\n    let mat = new THREE.Matrix4().set(  right.x, up.x, camera_forward.x, world_space_center.x,\r\n                                        right.y, up.y, camera_forward.y, world_space_center.y,\r\n                                        right.z, up.z, camera_forward.z, world_space_center.z,\r\n                                              0,    0,                0,        1);\r\n\r\n    let inverse_mat = new THREE.Matrix4().getInverse(mat);\r\n    for(let i=0; i< points_on_plane.length; i++)\r\n    {\r\n      points_on_plane[i].applyMatrix4(inverse_mat);\r\n    }\r\n\r\n\r\n    let size = new THREE.Vector3();\r\n    box =  new THREE.Box3().setFromPoints(points_on_plane);\r\n    box.getSize(size);\r\n    size.multiplyScalar(zoom_scale);\r\n    let projected_center = new THREE.Vector3();\r\n    box.getCenter(projected_center);\r\n\r\n\r\n    return {\r\n      position: projected_points_center,\r\n      zoom: this.get_zoom_to_fit_rect(size.x/2, size.y/2)\r\n    }\r\n\r\n  }\r\n\r\n  get_zoom_to_fit_rect(width,height)\r\n  {\r\n    let v_fov = (CameraManager.current.fov/2) * Math.PI/180;\r\n    let h_fov = (2 * Math.atan(Math.tan(v_fov) * CameraManager.current.aspect))/2;\r\n\r\n    let distV = height / Math.tan(v_fov);\r\n    let distH = width / Math.tan(h_fov);\r\n\r\n    return Math.max(Math.abs(distH), Math.abs(distV));\r\n  }\r\n\r\n  get_zoom_to_fit_box(bb, camera)\r\n  {\r\n    if(camera.isOrthographicCamera)\r\n    {\r\n      bb.getSize(this.tmp_size);\r\n\r\n      let obj_x = this.tmp_size.x;\r\n      let obj_y = this.tmp_size.y;\r\n      let object_aspect = obj_x / obj_y;\r\n      if(Screen.aspect_ratio / object_aspect > 1)\r\n      {\r\n        return Screen.height/obj_y;\r\n      }\r\n      else\r\n      {\r\n        return Screen.width/obj_x;\r\n      }\r\n    }\r\n    else\r\n    {\r\n      // return this.fit_points_on_camera([bb.min, bb.max], 1).zoom;\r\n      let size = new THREE.Vector3();\r\n      bb.getSize(size);\r\n      return this.get_zoom_to_fit_rect(size.x, size.y);\r\n\r\n    }\r\n  }\r\n\r\n  get_html_screen_pos(object, camera)\r\n  {\r\n    object.getWorldPosition(this.tmp_vec);\r\n    this.tmp_vec.project(camera);\r\n\r\n    this.tmp_vec.x = (this.tmp_vec.x * 0.5 + 0.5) * (Screen.width);\r\n    this.tmp_vec.y = (1-(this.tmp_vec.y * 0.5 + 0.5)) * Screen.height;\r\n    return this.tmp_vec;\r\n  }\r\n\r\n  world_pos_to_screen(pos, camera)\r\n  {\r\n  \tcamera = camera || CameraManager.current;\r\n    this.tmp_vec.copy(pos);\r\n    this.tmp_vec.project(camera);\r\n\r\n    this.tmp_vec.x = (this.tmp_vec.x * 0.5 + 0.5) * (Screen.width);\r\n    this.tmp_vec.y = (1-(this.tmp_vec.y * 0.5 + 0.5)) * Screen.height;\r\n    return this.tmp_vec;\r\n  }\r\n\r\n  update_projection(camera)\r\n  {\r\n    camera.left   = -Screen.width/2;\r\n    camera.right  = Screen.width/2;\r\n    camera.top    = Screen.height/2;\r\n    camera.bottom = -Screen.height/2;\r\n    camera.aspect = Screen.aspect_ratio;\r\n    camera.updateProjectionMatrix(true);\r\n  }\r\n}\r\n\r\nconst camera_utilities = new CameraUtilities();\r\nmodule.exports = camera_utilities;\r\n","class Capabilities\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.max_anisotropy = 0;\r\n\t\tthis.vertex_texture_sampler_available = false;\r\n\t\tthis.fp_textures_available = false;\r\n\t}\r\n}\r\n\r\nconst capabilities = new Capabilities();\r\nmodule.exports = capabilities;\r\n","module.exports=\"#define GLSLIFY 1\\nuniform vec3 _Color;\\n\\nvarying vec3 vBarycentric;\\n\\nfloat edgeFactor(vec3 baryc ){\\n    vec3 d = fwidth(baryc);\\n    vec3 a3 = smoothstep(vec3(0.0), d*1.5, baryc);\\n    return min(min(a3.x, a3.y), a3.z);\\n}\\n\\nvoid main()\\n{\\t\\n\\tfloat alpha = edgeFactor(vBarycentric + vec3(1. , 1., 0.));\\n\\tgl_FragColor.rgb = mix(_Color, vec3(0.), alpha);\\n\\tgl_FragColor.a = 1.0 - alpha;\\n\\tgl_FragColor.a *= 0.2;\\n}\";","module.exports=\"#define GLSLIFY 1\\nattribute vec3 barycentric;\\nvarying vec3 vBarycentric;\\nvoid main()\\n{\\n\\n  mat4 VP = projectionMatrix * viewMatrix;\\n  vec3 pos = (modelMatrix * vec4(position, 1.0)).xyz;\\n  gl_Position = VP * vec4(pos, 1.0);\\n  vBarycentric = barycentric;\\n}\";","export default class GeometryUtilities\r\n{\r\n\tstatic convert_to_non_indexed_geometry(geometry_buffer)\r\n\t{\r\n\t\tlet indices = geometry_buffer.index;\r\n\t\tlet positions = geometry_buffer.getAttribute(\"position\");\r\n\r\n\t\tlet bar_coordinates = [];\r\n\t\tlet vertices = [];\r\n\r\n\t\tfor(let i=0; i< indices.count; i+=3)\r\n\t\t{\r\n\t\t\t// VERTEX 1\r\n\t\t\tvertices.push(positions.getX(indices.array[i+0]));\r\n\t\t\tvertices.push(positions.getY(indices.array[i+0]));\r\n\t\t\tvertices.push(positions.getZ(indices.array[i+0]));\r\n\r\n\t\t\tbar_coordinates.push(1);\r\n\t\t\tbar_coordinates.push(0);\r\n\t\t\tbar_coordinates.push(0);\r\n\r\n\r\n\t\t\t// VERTEX 2\r\n\r\n\t\t\tvertices.push(positions.getX(indices.array[i+1]));\r\n\t\t\tvertices.push(positions.getY(indices.array[i+1]));\r\n\t\t\tvertices.push(positions.getZ(indices.array[i+1]));\r\n\r\n\t\t\tbar_coordinates.push(0);\r\n\t\t\tbar_coordinates.push(1);\r\n\t\t\tbar_coordinates.push(0);\r\n\r\n\r\n\t\t\t// VERTEX 3\r\n\r\n\t\t\tvertices.push(positions.getX(indices.array[i+2]));\r\n\t\t\tvertices.push(positions.getY(indices.array[i+2]));\r\n\t\t\tvertices.push(positions.getZ(indices.array[i+2]));\r\n\r\n\t\t\tbar_coordinates.push(0);\r\n\t\t\tbar_coordinates.push(0);\r\n\t\t\tbar_coordinates.push(1);\r\n\r\n\r\n\t\t}\r\n\r\n\t\tlet geometry = new THREE.BufferGeometry();\r\n\t\t// geometry.setAttribute('barycentric', new THREE.BufferAttribute( new Float32Array(bar_coordinates), 3 ));\r\n\t\tgeometry.setAttribute('position', new THREE.BufferAttribute( new Float32Array(vertices), 3 ) );\r\n\t\tGeometryUtilities.add_barycentric_attribute(geometry);\r\n\t\treturn geometry;\r\n\t}\r\n\r\n\tstatic add_barycentric_attribute(non_indexed_geometry_buffer)\r\n\t{\r\n\t\tlet bar_coordinates = [];\r\n\t\tlet positions = non_indexed_geometry_buffer.getAttribute(\"position\");\r\n\r\n\t\tfor(let i=0; i< positions.count; i+=3)\r\n\t\t{\r\n\t\t\tbar_coordinates.push(1);\r\n\t\t\tbar_coordinates.push(0);\r\n\t\t\tbar_coordinates.push(0);\r\n\r\n\t\t\tbar_coordinates.push(0);\r\n\t\t\tbar_coordinates.push(1);\r\n\t\t\tbar_coordinates.push(0);\r\n\r\n\t\t\tbar_coordinates.push(0);\r\n\t\t\tbar_coordinates.push(0);\r\n\t\t\tbar_coordinates.push(1);\r\n\r\n\t\t}\r\n\t\tnon_indexed_geometry_buffer.setAttribute('barycentric', new THREE.BufferAttribute( new Float32Array(bar_coordinates), 3 ));\r\n\t}\r\n}\r\n","import grid_frag from '/shaders/grid/grid_frag';\r\nimport grid_vert from '/shaders/grid/grid_vert';\r\nimport GeometryUtilities from '/utilities/GeometryUtilities';\r\n\r\nexport default class Grid extends THREE.Mesh {\r\n\tconstructor()\r\n\t{\r\n\r\n\t\tlet material = new THREE.ShaderMaterial({\r\n      uniforms: {\r\n      \t_Color: {value: new THREE.Color(\"#919191\")}\r\n      },\r\n      vertexShader: grid_vert,\r\n      fragmentShader: grid_frag,\r\n      extensions: {derivatives: true},\r\n      transparent: true,\r\n      depthWrite: false\r\n    });\r\n\r\n\r\n    let plane_geometry = new THREE.PlaneBufferGeometry( 100, 100, 100,100 );\r\n\r\n\t\tlet non_indexed_geometry = GeometryUtilities.convert_to_non_indexed_geometry(plane_geometry);\r\n\r\n\t\tsuper(non_indexed_geometry, material);\r\n\r\n\t\tthis.rotation.x = -3.14/2;\r\n\t}\r\n\r\n}\r\n","export default class BaseRender\r\n{\r\n\tconstructor()\r\n\t{\r\n\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\t\r\n\t}\r\n\r\n\ton_enter(context, renderer)\r\n\t{\r\n\r\n\t}\r\n\r\n\ton_exit(context, renderer)\r\n\t{\r\n\t\t\r\n\t}\r\n\r\n\tresize()\r\n\t{\r\n\t\t\r\n\t}\r\n\r\n}\r\n"," \r\nexport default class RenderLayers {\r\n  constructor() {\r\n\r\n  }\r\n\r\n  static get opaque()            { return 0; }\r\n  static get transparent()       { return 1; }\r\n  static get outline()       \t\t { return 2; }\r\n  static get selectable()\t\t\t\t { return 3; }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n","module.exports=\"#define GLSLIFY 1\\nuniform sampler2D _MainTex;\\nuniform sampler2D _Blur;\\nuniform vec2 _Screen;\\nvarying vec2 vUv;\\n\\nfloat aastep(float threshold, float value) {\\n  #ifdef GL_OES_standard_derivatives\\n    float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;\\n    return smoothstep(threshold-afwidth, threshold+afwidth, value);\\n  #else\\n    return step(threshold, value);\\n  #endif  \\n}\\n\\nvoid main()\\n{\\n\\tvec2 pixel_size = 1.0/_Screen;\\n\\n\\tvec4 color = texture2D( _MainTex, vUv);\\n\\tfloat mask = 1.0 - color.a;\\n\\n\\tfloat blur = texture2D( _Blur, vUv).a;\\n\\n  // gl_FragColor = vec4(mask,mask,mask,0.0);\\n  // gl_FragColor = color;\\n\\n\\tgl_FragColor = vec4(mix(color.rgb, mix(color.rgb, vec3(1.,0.,0.),aastep(0.076, blur)), mask), 1.0);\\n}\\n\\n\";","module.exports=\"#define GLSLIFY 1\\nuniform sampler2D _MainTex;\\nuniform vec2 _Resolution;\\nuniform vec2 _SampleDir;\\nvarying vec2 vUv;\\n\\nvoid main()\\n{\\n\\n\\tvec3 sum = vec3(0.,0.,0.);\\n\\tvec2 dir = (0.5/_Resolution) * _SampleDir;\\n\\tfloat _Distance = 2.0;\\n\\tsum += texture2D( _MainTex, vUv + dir * -4. * _Distance ).rgb * 0.0525;\\n\\tsum += texture2D( _MainTex, vUv + dir * -3. * _Distance ).rgb * 0.075;\\n\\tsum += texture2D( _MainTex, vUv + dir * -2. * _Distance ).rgb * 0.110;\\n\\tsum += texture2D( _MainTex, vUv + dir * -1. * _Distance ).rgb * 0.150;\\n\\tsum += texture2D( _MainTex, vUv + dir *  0. * _Distance ).rgb * 0.225;\\n\\tsum += texture2D( _MainTex, vUv + dir *  1. * _Distance ).rgb * 0.150;\\n\\tsum += texture2D( _MainTex, vUv + dir *  2. * _Distance ).rgb * 0.110;\\n\\tsum += texture2D( _MainTex, vUv + dir *  3. * _Distance ).rgb * 0.075;\\n\\tsum += texture2D( _MainTex, vUv + dir *  4. * _Distance ).rgb * 0.0525;\\n\\tgl_FragColor = vec4(sum, 1.0);\\n\\n}\\n\";","module.exports=\"#define GLSLIFY 1\\nuniform sampler2D _MainTex;\\n\\nvarying vec2 vUv;\\nvoid main()\\n{\\n\\tgl_FragColor = texture2D(_MainTex, vUv);\\n}\";","module.exports=\"#define GLSLIFY 1\\nvarying vec2 vUv;\\nvoid main()\\n{\\n\\tgl_Position = vec4(uv * 2.0 - 1.0, 1.0, 1.0);\\n\\tvUv = uv;\\n}\";","import Screen from '/Screen';\r\nimport RenderLayers from '/RenderLayers';\r\n\r\nimport compose_frag from '/shaders/box_blur/compose_frag';\r\nimport box_blur_frag from '/shaders/box_blur/box_blur_frag';\r\nimport copy_frag from '/shaders/copy/copy_frag';\r\nimport copy_vert from '/shaders/copy/copy_vert';\r\nimport background_frag from '/shaders/basic_color/basic_color_frag';\r\n\r\nexport default class OutlineRender\r\n{\r\n\r\n\tconstructor(webgl)\r\n\t{\r\n\t\tthis.main_rt \t\t\t\t= new THREE.WebGLRenderTarget(Screen.width, Screen.height);\r\n\t\tthis.rt1\t\t \t\t\t\t= new THREE.WebGLRenderTarget(Screen.width, Screen.height);\r\n\t\tthis.rt2\t\t \t\t\t\t= new THREE.WebGLRenderTarget(Screen.width, Screen.height);\r\n\r\n\r\n    this.compose_material \t\t= this.__get_compose_material();\r\n    this.copy_material \t\t\t\t= this.__get_copy_material();\r\n    this.box_blur_material \t\t= this.__get_box_blur_material();\r\n    this.background_material \t= this.__get_background_material();\r\n\r\n\t\tthis.copy_plane = new THREE.Mesh( new THREE.PlaneGeometry(1,1), this.copy_material );\r\n\t\tthis.copy_plane.frustumCulled = false;\r\n\t\tthis.copy_scene = new THREE.Scene();\r\n\t\tthis.copy_scene.add(this.copy_plane);\r\n\r\n\t}\r\n\r\n\tresize(w,h)\r\n\t{\r\n\t\tthis.main_rt.setSize(w,h);\r\n\t\tthis.rt1.setSize(w,h);\r\n\t\tthis.rt2.setSize(w,h);\r\n\t\tthis.box_blur_material.uniforms._Screen.value.set(w,h);\r\n\t\tthis.compose_material.uniforms._Screen.value.set(w,h);\r\n\t}\r\n\r\n\r\n\trender(webgl)\r\n\t{\r\n\t\twebgl.camera.updateMatrix();\r\n\t\twebgl.camera.updateMatrixWorld();\r\n\r\n\t\twebgl.camera.layers.enable(RenderLayers.opaque);\r\n\t\twebgl.camera.layers.enable(RenderLayers.transparent);\r\n\t\twebgl.camera.layers.disable(RenderLayers.outline);\r\n\r\n\t\t//render scene\r\n\t\twebgl._renderer.setClearColor(webgl.clear_color, 0);\r\n\t\twebgl._renderer.clearTarget(this.main_rt,true,true,true);\r\n\r\n\t\tthis.copy_scene.overrideMaterial = this.background_material;\r\n\t\tthis.background_material.uniforms._Color.value.set(webgl.clear_color.r, webgl.clear_color.g, webgl.clear_color.b, 0);\r\n\t\twebgl._renderer.render(this.copy_scene, webgl.camera, this.main_rt, false);\r\n\r\n\r\n\t\twebgl._renderer.render(webgl.scene, webgl.camera, this.main_rt, false);\r\n\r\n\r\n\r\n\r\n\t\t//horizontal blur\r\n\t\tthis.box_blur_material.uniforms._MainTex.value = this.main_rt.texture;\r\n\t\tthis.box_blur_material.uniforms._SampleDir.value.set(1,0);\r\n\r\n\t\tthis.copy_scene.overrideMaterial = this.box_blur_material;\r\n\t\twebgl._renderer.render(this.copy_scene, webgl.camera, this.rt1, false);\r\n\r\n\t\t//vertical blur\r\n\t\tthis.box_blur_material.uniforms._SampleDir.value.set(0,1);\r\n\t\tthis.box_blur_material.uniforms._MainTex.value = this.rt1.texture;\r\n\r\n\t\twebgl._renderer.render(this.copy_scene, webgl.camera, this.rt2, false);\r\n\r\n\r\n\t\t//compose\r\n\t\tthis.copy_scene.overrideMaterial = this.compose_material;\r\n\t\tthis.compose_material.uniforms._MainTex.value = this.main_rt.texture;\r\n\t\tthis.compose_material.uniforms._Blur.value = this.rt2.texture;\r\n\t\twebgl._renderer.render(this.copy_scene, webgl.camera, undefined, false);\r\n\t\tthis.copy_scene.overrideMaterial = undefined;\r\n\t}\r\n\r\n\t__get_copy_material()\r\n\t{\r\n\t\treturn new THREE.ShaderMaterial({\r\n      uniforms: {\r\n        _MainTex: \t\t\t{value : undefined}\r\n      },\r\n      vertexShader: copy_vert,\r\n      fragmentShader: copy_frag,\r\n      depthTest: false,\r\n      depthWrite: false\r\n    });\r\n\t}\r\n\r\n\t__get_box_blur_material()\r\n\t{\r\n \t\treturn new THREE.ShaderMaterial({\r\n      uniforms: {\r\n        _MainTex: \t\t\t{value : undefined},\r\n        _SampleDir: \t\t{value : new THREE.Vector2()},\r\n        _Screen: \t\t\t\t{value : new THREE.Vector2(Screen.width, Screen.height)}\r\n      },\r\n      vertexShader: copy_vert,\r\n      fragmentShader: box_blur_frag,\r\n      depthTest: false,\r\n      depthWrite: false\r\n    });\r\n\t}\r\n\r\n\t__get_compose_material()\r\n\t{\r\n\t\treturn new THREE.ShaderMaterial({\r\n      uniforms: {\r\n        _MainTex: \t\t\t{value : undefined},\r\n        _Blur: \t\t\t\t\t{value : undefined},\r\n        _Screen: \t\t\t\t{value : new THREE.Vector2(Screen.width, Screen.height)}\r\n      },\r\n      vertexShader: copy_vert,\r\n      fragmentShader: compose_frag,\r\n      depthTest: false,\r\n      depthWrite: false,\r\n      extensions: {\r\n      \tderivatives: true\r\n      }\r\n    });\r\n\t}\r\n\r\n\t__get_background_material()\r\n\t{\r\n\t\treturn new THREE.ShaderMaterial({\r\n      uniforms: {\r\n        _Color: \t\t\t\t{value : new THREE.Vector4(0,0,0,0)}\r\n      },\r\n      vertexShader: copy_vert,\r\n      fragmentShader: background_frag,\r\n      depthTest: true,\r\n      depthWrite: false\r\n\r\n    });\r\n\t}\r\n\r\n\ton_enter(webgl)\r\n\t{\r\n\t\twebgl._renderer.autoClear = false;\r\n\t}\r\n\r\n\ton_exit(webgl)\r\n\t{\r\n\t\twebgl._renderer.autoClear = true;\r\n\t}\r\n}\r\n","import vert from '/shaders/copy/copy_vert';\r\nimport frag from '/shaders/copy/copy_frag';\r\n\r\nexport default class BlitMaterial extends THREE.ShaderMaterial\r\n{\r\n\tconstructor(frag_shader, vert_shader, defines)\r\n\t{\r\n\t\tsuper({\r\n\t\t\tuniforms: {\r\n\t\t\t\t_MainTex: {value: null},\r\n        _Resolution:{value: new THREE.Vector2(0,0)}\r\n\t\t\t},\r\n\t\t\tdefines: defines || {},\r\n\t\t\tvertexShader: vert_shader || vert,\r\n\t\t\tfragmentShader: frag_shader || frag,\r\n\t\t\tdepthWrite: false,\r\n      blending: THREE.NoBlending,\r\n      depthTest: false,\r\n      depthWrite: false,\r\n      depthFunc: THREE.AlwaysDepth\r\n\t\t});\r\n\t}\r\n\r\n}\r\n","module.exports=\"#define GLSLIFY 1\\nuniform vec4 _DepthNormal;\\nvec2 EncodeFloatRG( float v )\\n{\\n    vec2 kEncodeMul = vec2(1.0, 255.0);\\n    float kEncodeBit = 1.0/255.0;\\n    vec2 enc = kEncodeMul * v;\\n    enc = fract (enc);\\n    enc.x -= enc.y * kEncodeBit;\\n    return enc;\\n}\\n\\nvec2 EncodeNormal (vec3 n)\\n{\\n    float scale = 1.7777;\\n    vec2 enc = n.xy / (n.z+1.0);\\n    enc /= scale;\\n    enc = enc*0.5+0.5;\\n    return enc;\\n}\\n\\nvoid main()\\n{\\n    gl_FragColor = vec4(EncodeFloatRG(_DepthNormal.x), EncodeNormal(normalize(_DepthNormal.yzw)));  \\n}\";","import BlitMaterial from '/materials/BlitMaterial';\r\nimport frag from '/shaders/clear/clear_depth_normal_frag';\r\n\r\nexport default class ClearDepthNormalMaterial extends BlitMaterial\r\n{\r\n\tconstructor(clear_depth, clear_normal)\r\n\t{\r\n\t\tsuper(frag);\r\n\t\tthis.uniforms._DepthNormal = {value: new THREE.Vector4(clear_depth, clear_normal.x, clear_normal.y, clear_normal.z)};\r\n\t}\r\n\r\n}\r\n","module.exports=\"#define GLSLIFY 1\\nvarying vec3 v_normal;\\nvarying vec3 v_pos;\\n\\nvoid main()\\n{\\n  vec3 pos = position;\\n  mat4 MVP = projectionMatrix * modelViewMatrix;\\n\\n  v_normal \\t= (modelViewMatrix * vec4(normal, 0.0)).xyz;\\n  v_pos \\t\\t= (modelViewMatrix * vec4( pos, 1.0 )).xyz;\\n\\n  gl_Position = MVP * vec4( pos, 1.0 );\\n}\";","module.exports=\"#define GLSLIFY 1\\nvarying vec3 v_normal;\\nvarying vec3 v_pos;\\n\\nuniform float _FarPlane;\\n\\nvec2 EncodeFloatRG( float v )\\n{\\n    vec2 kEncodeMul = vec2(1.0, 255.0);\\n    float kEncodeBit = 1.0/255.0;\\n    vec2 enc = kEncodeMul * v;\\n    enc = fract (enc);\\n    enc.x -= enc.y * kEncodeBit;\\n    return enc;\\n}\\n\\nvec2 EncodeNormal (vec3 n)\\n{\\n    float scale = 1.7777;\\n    vec2 enc = n.xy / (n.z+1.0);\\n    enc /= scale;\\n    enc = enc*0.5+0.5;\\n    return enc;\\n}\\n\\nvoid main()\\n{\\n\\tgl_FragColor = vec4(EncodeFloatRG(length(v_pos.z)/_FarPlane), EncodeNormal(normalize(v_normal)));\\t\\n}\\n\\n\";","import vert from '/shaders/depth_normals/depth_normals_vert';\r\nimport frag from '/shaders/depth_normals/depth_normals_frag';\r\n\r\nexport default class DepthNormalMaterial extends THREE.ShaderMaterial\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper({\r\n      uniforms: {\r\n      \t_FarPlane: {value: 1}\r\n      },\r\n      vertexShader: vert,\r\n      fragmentShader: frag\r\n    });\r\n\t}\r\n\r\n\tset far_plane(value)\r\n\t{\r\n\t\tthis.uniforms._FarPlane.value = value;\r\n\t}\r\n\r\n}\r\n","import CameraManager from '/CameraManager';\r\nimport SceneManager from '/SceneManager';\r\nimport Screen from '/Screen';\r\n\r\nimport ClearDepthNormalMaterial from '/materials/ClearDepthNormalMaterial';\r\nimport DepthNormalMaterial from '/materials/DepthNormalMaterial';\r\n\r\nexport default class DepthAndNormalsRenderer\r\n{\r\n\tconstructor()\r\n\t{\r\n    this.RT = new THREE.WebGLRenderTarget(Screen.width, Screen.height);\r\n\r\n    this.clear_depth_normal_mat = new ClearDepthNormalMaterial(1, new THREE.Vector3(0,0,1));\r\n    this.depth_normal_material = new DepthNormalMaterial();\r\n\t}\r\n\r\n\r\n\trender(graphics)\r\n\t{\r\n\t\tthis.__resize_RT_if_necessary();\r\n\r\n\r\n    graphics.clear(this.RT, undefined, true,true)\r\n\r\n    graphics.blit_clear_with_material(this.RT, this.clear_depth_normal_mat);\r\n\r\n    this.depth_normal_material.far_plane = CameraManager.current.far;\r\n\r\n    graphics.render(undefined, undefined, this.RT, this.depth_normal_material);\r\n\r\n\t}\r\n\r\n  __resize_RT_if_necessary()\r\n  {\r\n    if(this.RT.width !== Screen.width || this.RT.height !== Screen.height)\r\n    {\r\n      this.RT.setSize(Screen.width, Screen.height);\r\n    }\r\n  }\r\n\r\n\tget render_target()\r\n\t{\r\n\t\treturn this.RT;\r\n\t}\r\n\r\n}\r\n","import BlitMaterial from '/materials/BlitMaterial';\r\n\r\nexport default class Blitter\r\n{\r\n\r\n  constructor(renderer)\r\n  {\r\n      this.renderer = renderer;\r\n      this._blit_scene = new THREE.Scene();\r\n      this._blit_material = new BlitMaterial();\r\n      this._blit_quad = new THREE.Mesh(\r\n        new THREE.PlaneBufferGeometry( 1, 1 ),this._blit_material );\r\n      this._blit_scene.add( this._blit_quad );\r\n      this._blit_camera = new THREE.OrthographicCamera( -1, 1, 1, -1, -10000, 10000 );\r\n\r\n  }\r\n\r\n\r\n  blit(src, dst)\r\n  {\r\n    this._blit_quad.material = this._blit_material;\r\n    this._blit_quad.material.uniforms._MainTex.value = src.texture;\r\n    this._blit_quad.material.uniforms._Resolution.value.set(src.width, src.height);\r\n\r\n    this.renderer.setRenderTarget(dst === undefined? null : dst);\r\n\r\n    this.renderer.render( this._blit_scene,\r\n                          this._blit_camera);\r\n  }\r\n\r\n  blit_with_material(src, dst, mat)\r\n  {\r\n    this._blit_quad.material = mat;\r\n    this._blit_quad.material.uniforms._MainTex.value = src.texture;\r\n    this._blit_quad.material.uniforms._Resolution.value.set(src.width, src.height);\r\n\r\n    this.renderer.setRenderTarget(dst === undefined? null : dst);\r\n\r\n    this.renderer.render( this._blit_scene,\r\n                          this._blit_camera );\r\n  }\r\n\r\n  blit_clear_with_material(dst_RT, mat)\r\n  {\r\n    this._blit_quad.material = mat;\r\n\r\n    this.renderer.setRenderTarget(dst_RT === undefined? null : dst_RT);\r\n\r\n    this.renderer.render( this._blit_scene, this._blit_camera);\r\n  }\r\n\r\n}\r\n","import Configuration from           '/Configuration';\r\nimport BaseRender from   '/render_mode/BaseRender';\r\nimport OutlineRender from           '/render_mode/OutlineRender';\r\nimport Screen from '/Screen';\r\nimport CameraManager from '/CameraManager';\r\nimport SceneManager from '/SceneManager';\r\nimport Capabilities from '/Capabilities';\r\nimport DepthAndNormalsRenderer from '/render_utilities/DepthAndNormalsRenderer';\r\nimport Blitter from '/render_utilities/Blitter';\r\n\r\nclass Graphics {\r\n\r\n\r\n  constructor() {\r\n    this._renderer = undefined;\r\n    this.blitter = undefined;\r\n    this.canvas = undefined;\r\n    this.no_render = undefined;\r\n    this.current_render_mode = undefined;\r\n    this.generateDepthNormalTexture = false;\r\n    this.depth_and_normals_renderer = undefined;\r\n\r\n    this.is_webgl2 = false;\r\n    this.canvas_context = undefined;\r\n    this.context_attributes = undefined;\r\n  }\r\n\r\n  init(canvas, msaa = true, context_attributes) {\r\n    this.context_attributes = context_attributes || {\r\n      alpha: true,\r\n      depth: true,\r\n      desynchronized: false,\r\n      stencil: false,\r\n      antialias: msaa,\r\n      premultipliedAlpha: true,\r\n      preserveDrawingBuffer: true,\r\n      powerPreference: 'high-performance',\r\n      logarithmicDepthBuffer: false\r\n    }\r\n\r\n    this.canvas_context = canvas.getContext('webgl', this.context_attributes) ||\r\n                          canvas.getContext('webgl', this.context_attributes) ||\r\n                          canvas.getContext('experimental-webgl', this.context_attributes);\r\n\r\n    this.is_webgl2 = !!(window.WebGL2RenderingContext && canvas.getContext('webgl2'));\r\n    console.log(`Using Webgl ${this.is_webgl2 ? 2 : 1}`);\r\n\r\n    this._renderer = new THREE.WebGLRenderer({\r\n      canvas: canvas,\r\n      context: this.canvas_context\r\n    });\r\n\r\n    this._renderer.autoClear = false;\r\n\r\n    this._renderer.setPixelRatio(1);\r\n\r\n    Screen.dpr = window.devicePixelRatio;\r\n\r\n    if(!this.is_webgl2) {\r\n      this._renderer.extensions.get('ANGLE_instanced_arrays')\r\n    }\r\n\r\n    this.blitter = new Blitter(this._renderer);\r\n\r\n    this.canvas = this._renderer.domElement;\r\n\r\n    this.no_render = new BaseRender();\r\n\r\n    this.current_render_mode = this.no_render;\r\n\r\n    Capabilities.max_anisotropy = this._renderer.capabilities.getMaxAnisotropy();\r\n    Capabilities.vertex_texture_sampler_available = this._renderer.capabilities.maxVertexTextures > 0;\r\n    Capabilities.fp_textures_available = this._renderer.capabilities.floatVertexTextures;\r\n\r\n    this.generateDepthNormalTexture = false;\r\n\r\n    this.depth_and_normals_renderer = new DepthAndNormalsRenderer();\r\n\r\n  }\r\n\r\n  get dom_element()\r\n  {\r\n    return this._renderer.domElement;\r\n  }\r\n\r\n  get depth_normals_RT()\r\n  {\r\n    return this.depth_and_normals_renderer.render_target;\r\n  }\r\n\r\n\r\n  set_state(new_state)\r\n  {\r\n    console.log(\"VIEWAPI - map render mode switch to: \" + new_state.constructor.name);\r\n\r\n    this.current_render_mode.on_exit(this, this._renderer);\r\n    this.current_render_mode = new_state;\r\n    this.current_render_mode.on_enter(this, this._renderer);\r\n  }\r\n\r\n  update() {\r\n    this.check_for_resize();\r\n\r\n    if(this.generateDepthNormalTexture)\r\n    {\r\n      this.depth_and_normals_renderer.render(this);\r\n    }\r\n\r\n    if(CameraManager.current)\r\n    {\r\n      this.__update_current_camera();\r\n      this.current_render_mode.render();\r\n    }\r\n  }\r\n\r\n  __update_current_camera()\r\n  {\r\n    CameraManager.current.aspect = Screen.aspect_ratio;\r\n    CameraManager.current.updateProjectionMatrix();\r\n    CameraManager.current.updateMatrix();\r\n    CameraManager.current.updateMatrixWorld(true);\r\n  }\r\n\r\n\r\n\r\n  render(scene, camera, RT, override_mat)\r\n  {\r\n    this.__apply_override_material(scene, override_mat);\r\n\r\n    this._renderer.setRenderTarget(RT === undefined? null : RT);\r\n    this._renderer.render(scene  || SceneManager.current,\r\n                          camera || CameraManager.current);\r\n\r\n    this.__apply_override_material(scene, undefined);\r\n\r\n\r\n  }\r\n\r\n  __apply_override_material(scene, mat)\r\n  {\r\n    if(scene)\r\n      scene.overrideMaterial = mat;\r\n    else\r\n      SceneManager.current.overrideMaterial = mat;\r\n  }\r\n\r\n  readback_RT(RT, buffer)\r\n  {\r\n    this._renderer.readRenderTargetPixels( RT, 0, 0, RT.width, RT.height, buffer);\r\n  }\r\n\r\n  clear(RT, camera, clear_depth, clear_stencil)\r\n  {\r\n    this._renderer.setRenderTarget(RT === undefined? null : RT);\r\n\r\n    if(camera)\r\n    {\r\n      this._renderer.setClearColor(camera.clear_color, camera.clear_alpha);\r\n    }\r\n\r\n    this._renderer.clear( camera?         true : false, // clear color\r\n                          clear_depth?    true : false,\r\n                          clear_stencil?  true : false);\r\n  }\r\n\r\n  check_for_resize()\r\n  {\r\n\r\n    let current_width   = this.canvas.clientWidth;\r\n    let current_height  = this.canvas.clientHeight;\r\n\r\n    if (\r\n          current_width  !== Screen.width  ||\r\n          current_height !== Screen.height ||\r\n          window.devicePixelRatio !== Screen.dpr\r\n        )\r\n    {\r\n      Screen.dpr = window.devicePixelRatio;\r\n      Screen.update_size(current_width, current_height);\r\n\r\n      this.canvas.width  = Screen.render_width;\r\n      this.canvas.height = Screen.render_height;\r\n      this._renderer.setViewport(0, 0, Screen.render_width, Screen.render_height);\r\n\r\n      this.__update_current_camera();\r\n    }\r\n  }\r\n\r\n  on_resize() {\r\n    console.error(\"Graphics.on_resize call no longer needed.\")\r\n  }\r\n\r\n\r\n  blit(src_RT, dst_RT, mat)\r\n  {\r\n    if(mat)\r\n      this.blitter.blit_with_material(src_RT, dst_RT, mat);\r\n    else\r\n      this.blitter.blit(src_RT, dst_RT);\r\n  }\r\n\r\n  blit_clear_with_material(dst_RT, mat)\r\n  {\r\n    this.blitter.blit_clear_with_material(dst_RT, mat);\r\n  }\r\n\r\n\r\n  take_screenshot(blob_callback)\r\n  {\r\n\r\n    const ctx = this;\r\n\r\n\r\n    let old_width = Screen.width;\r\n    let old_height = Screen.height;\r\n\r\n    let new_width = 4096;\r\n    let new_height = 4096;\r\n\r\n    let tile_width = 1024;\r\n    let tile_height = 1024;\r\n\r\n    let divisions_x = parseInt(Math.ceil(new_width / tile_width));\r\n    let divisions_y = parseInt(Math.ceil(new_height / tile_height));\r\n\r\n    Screen.update_size(tile_width, tile_height);\r\n\r\n    this._renderer.setPixelRatio(1);\r\n\r\n    this._renderer.setSize(tile_width ,tile_height, false);\r\n\r\n    this.ctx_2D.canvas.width  = new_width;\r\n    this.ctx_2D.canvas.height = new_height;\r\n\r\n    CameraManager.current.aspect = Screen.aspect_ratio;\r\n    CameraManager.current.updateMatrix();\r\n    CameraManager.current.updateMatrixWorld(true);\r\n\r\n    for(let x = 0; x < divisions_x; x++)\r\n    {\r\n      for(let y = 0; y < divisions_y; y++)\r\n      {\r\n\r\n        CameraManager.current.setViewOffset( new_width,             new_height,\r\n                                             Screen.width*x,         Screen.height*y,\r\n                                             Screen.width,            Screen.height);\r\n        this.current_render_mode.render();\r\n\r\n        this.ctx_2D.drawImage(this._renderer.domElement, Screen.width*x, Screen.height*y);\r\n      }\r\n    }\r\n\r\n    // transform the result canvas into a blob\r\n    // from them the callback turns into a ULR and download it\r\n    this.ctx_2D.canvas.toBlob(blob_callback,\"image/png;base64;\");\r\n\r\n    CameraManager.current.clearViewOffset();\r\n    Screen.update_size(old_width,old_height);\r\n    this._renderer.setPixelRatio(window.devicePixelRatio);\r\n    this._renderer.setSize(old_width,old_height, false);\r\n\r\n    CameraManager.current.aspect = Screen.aspect_ratio;\r\n    CameraManager.current.updateMatrix();\r\n    CameraManager.current.updateMatrixWorld(true);\r\n\r\n  }\r\n\r\n  download_screenshot (blob) {\r\n    console.log(\"el blob\", blob);\r\n    let link = document.createElement('a');\r\n    link.download = \"Snapshot.png\";\r\n\r\n    link.href = URL.createObjectURL(blob);\r\n    link.click()\r\n\r\n    link.onclick = function() {\r\n      requestAnimationFrame(function() {\r\n        URL.revokeObjectURL(a.href);\r\n      });\r\n      a.removeAttribute('href')\r\n    };\r\n\r\n  }\r\n\r\n}\r\n\r\nconst graphics = new Graphics();\r\nmodule.exports = graphics;\r\n\r\n","import Input from '/Input';\r\nimport CameraManager from '/CameraManager';\r\nimport Graphics from '/Graphics';\r\nimport Screen from '/Screen';\r\n\r\n\r\n\r\nclass UI\r\n{\r\n\r\n    constructor()\r\n    {\r\n        this.ui_elements = [];\r\n        this._tmp_normalized_pos = new THREE.Vector2();\r\n        this.ss_scene = new THREE.Scene();\r\n        this.ss_scene.autoUpdate = false;\r\n        this.ss_scene.frustumCulled = false;\r\n\r\n        this.ws_scene = new THREE.Scene();\r\n        this.ws_scene.autoUpdate = false;\r\n        this.ws_scene.frustumCulled = false;\r\n\r\n        this.ss_camera = new THREE.OrthographicCamera(-1, 1, 1,-1, -100, 100);\r\n    }\r\n\r\n    delete_element(elem)\r\n    {\r\n        let index = this.ui_elements.indexOf(elem);\r\n        if (index > -1) {\r\n            this.ui_elements.splice(index, 1);\r\n        }\r\n\r\n        this.ss_scene.remove(elem);\r\n        this.ws_scene.remove(elem);\r\n\r\n        elem.dispose();\r\n    }\r\n\r\n    add_screen_space_element(elem)\r\n    {\r\n        this.ui_elements.push(elem);\r\n        this.ss_scene.add(elem);\r\n\r\n        elem.set_screen_space_coordinate_system()\r\n    }\r\n    add_world_space_element(elem)\r\n    {\r\n        this.ui_elements.push(elem);\r\n        this.ws_scene.add(elem);\r\n\r\n        elem.set_world_space_coordinate_system();\r\n    }\r\n\r\n\r\n    update()\r\n    {\r\n\r\n        // this.ss_camera.left     = -Screen.width / 2;\r\n        // this.ss_camera.right    = Screen.width / 2;\r\n        // this.ss_camera.top      = Screen.top / 2;\r\n        // this.ss_camera.right    = -Screen.bottom / 2;\r\n        this.ss_camera.updateProjectionMatrix();\r\n\r\n        this._tmp_normalized_pos.copy(Input.normalized_mouse_pos);\r\n        for(let i=0; i< this.ui_elements.length; i++)\r\n        {\r\n            this.ui_elements[i].update_state(this._tmp_normalized_pos)\r\n        }\r\n    }\r\n\r\n    render(renderer)\r\n    {\r\n        // renderer.render_ui(this.scene);\r\n        if(this.ss_scene.children.length > 0)\r\n            Graphics.render(this.ss_scene, this.ss_camera);\r\n        if (this.ws_scene.children.length > 0)\r\n            Graphics.render(this.ws_scene, CameraManager.current);\r\n    }\r\n\r\n    clear()\r\n    {\r\n        this.current_clicked_element = undefined\r\n    }\r\n}\r\n\r\nconst ui = new UI();\r\nmodule.exports = ui;\r\n","module.exports=\"#define GLSLIFY 1\\nuniform vec2 _ScreenSize;\\nuniform vec2 _TextureSize;\\nuniform vec2 _PixelOffset;\\nuniform vec3 _NDC;\\nuniform vec2 _PivotPoint;\\nuniform float _DepthOffset;\\nvarying vec2 vUv;\\n\\nvec2 add_pixel_offset(vec2 pos)\\n{\\n\\tpos = pos * 0.5 + 0.5;\\n\\tpos *= _ScreenSize;\\n\\tpos = ceil(pos+_PixelOffset)+0.5;\\n\\tpos /= _ScreenSize;\\n\\treturn pos * 2.0 - 1.0;\\n}\\nvoid main()\\n{\\n\\tvec4 projected_pos = projectionMatrix * viewMatrix * vec4(_NDC, 1.0);\\n  projected_pos.zw += _DepthOffset;\\n\\n\\tprojected_pos.xyz /= projected_pos.w;\\n\\n  vec2 normalized_size = _TextureSize/_ScreenSize;\\n  vec2 dir = uv * 2.0 - 1.0;\\n  dir -= _PivotPoint;\\n  vec2 pos = projected_pos.xy+dir * normalized_size;\\n  gl_Position = vec4(add_pixel_offset(pos), projected_pos.z, 1.0);\\n  vUv = uv;\\n\\n}\\n\";","module.exports=\"#define GLSLIFY 1\\nuniform sampler2D _MainTex;\\nuniform vec2 _ScreenSize;\\nuniform vec2 _TextureSize;\\nvarying vec2 vUv;\\n\\nvoid main()\\n{\\n\\tgl_FragColor = texture2D(_MainTex, vUv + vec2(0.5, 0.5)/_TextureSize);\\n}\\n\";","import vert from '/shaders/ui_element/ui_element.vert';\r\nimport frag from '/shaders/ui_element/ui_element.frag';\r\nimport BaseShaderMaterial from '/materials/BaseShaderMaterial';\r\n\r\nexport default class UIElementMaterial extends BaseShaderMaterial {\r\n    constructor(intensity = 1) {\r\n        super(vert, frag, {\r\n            _MainTex: { value: undefined },\r\n            _ScreenSize: { value: new THREE.Vector2(Screen.width, Screen.height) },\r\n            _TextureSize: { value: new THREE.Vector2() },\r\n            _PixelOffset: { value: new THREE.Vector2(0, 0) },\r\n            _NDC: { value: new THREE.Vector3() },\r\n            _PivotPoint: { value: new THREE.Vector2() },\r\n            _DepthOffset: { value: 0 }\r\n        });\r\n        this.transparent = true;\r\n        this.depthWrite = false;\r\n        this.depthTest = false;\r\n    }\r\n\r\n}\r\n","module.exports=\"#define GLSLIFY 1\\nuniform sampler2D _MainTex;\\nuniform vec2 _ScreenSize;\\nuniform vec2 _TextureSize;\\nvarying vec2 vUv;\\n\\nvoid main()\\n{\\n\\tgl_FragColor = texture2D(_MainTex, vUv + vec2(0.5, 0.5)/_TextureSize);\\n}\";","module.exports=\"#define GLSLIFY 1\\nuniform vec2 _ScreenSize;\\nuniform vec2 _TextureSize;\\nuniform vec2 _PixelOffset;\\nuniform vec3 _NDC;\\nuniform vec2 _PivotPoint;\\nuniform float _DepthOffset;\\nvarying vec2 vUv;\\n\\nvec2 round_to_ceil(vec2 pos)\\n{\\n\\tpos = pos * 0.5 + 0.5;\\n\\tpos *= _ScreenSize;\\n\\tpos = ceil(pos)+0.5;\\n\\tpos /= _ScreenSize;\\n\\treturn pos * 2.0 - 1.0;\\n}\\nvoid main()\\n{\\n\\tvec4 projected_pos = projectionMatrix * viewMatrix * vec4(_NDC, 1.0);\\n  projected_pos.zw += _DepthOffset;\\n\\n\\tprojected_pos.xyz /= projected_pos.w;\\n\\t\\n  vec2 normalized_size = _TextureSize/_ScreenSize;\\n  vec2 dir = uv * 2.0 - 1.0;\\n  dir -= _PivotPoint; \\n  vec2 pos = projected_pos.xy+ dir * normalized_size;\\n  gl_Position = vec4(round_to_ceil(pos), projected_pos.z, 1.0);\\n  vUv = uv;\\n\\n}\";","export default class ScreenSpacePosition\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.tmp_vec = new THREE.Vector2();\r\n\t}\r\n\r\n\tget_pos_NDC(position)\r\n\t{\r\n\t\treturn this.tmp_vec.set(position.x, position.y);\r\n\t}\r\n}","import CameraManager from '/CameraManager';\r\n\r\nexport default class WorldSpacePosition\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.tmp_vec3 = new THREE.Vector3();\r\n\t\tthis.tmp_vec2 = new THREE.Vector2();\r\n\t}\r\n\r\n\tget_pos_NDC(position)\r\n\t{\r\n\t\tthis.tmp_vec3.copy(position);\r\n    \tthis.tmp_vec3.project(CameraManager.current);\r\n\r\n\t\treturn this.tmp_vec2.set(this.tmp_vec3.x, this.tmp_vec3.y);\r\n\t}\r\n}\r\n","export default class UIElementState\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\r\n\t}\r\n\r\n\tupdate(ui_element, normalized_mouse_position)\r\n\t{\r\n\r\n\t}\r\n\r\n\ton_enter(ui_element){}\r\n\ton_exit(ui_element){}\r\n}","import UIElementState from '/ui/ui_element_state/UIElementState'\r\n\r\nexport default class OnIdle extends UIElementState\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tupdate(ui_element, normalized_mouse_position)\r\n\t{\r\n\t\tif(ui_element.is_mouse_over(normalized_mouse_position))\r\n\t\t{\r\n\t\t\tui_element.set_state(ui_element._on_enter_state);\r\n\t\t}\r\n\t}\r\n}\r\n","import UIElementState from '/ui/ui_element_state/UIElementState'\r\n\r\nexport default class OnMouseEnter extends UIElementState\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\ton_enter(ui_element)\r\n\t{\r\n\t\tui_element.on_mouse_enter();\r\n\t}\r\n\r\n\tupdate(ui_element, normalized_mouse_position)\r\n\t{\r\n\t\tif(ui_element.is_mouse_over(normalized_mouse_position))\r\n\t\t{\r\n\t\t\tui_element.set_state(ui_element._on_hover_state);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tui_element.set_state(ui_element._on_exit_state);\r\n\t\t}\r\n\t}\r\n}\r\n","import UIElementState from '/ui/ui_element_state/UIElementState'\r\n\r\nexport default class OnMouseExit extends UIElementState\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\ton_enter(ui_element)\r\n\t{\r\n\t\tui_element.on_mouse_exit();\r\n\t\tui_element.set_state(ui_element._on_idle_state);\r\n\t}\r\n\r\n}\r\n","import UIElementState from '/ui/ui_element_state/UIElementState'\r\n\r\nexport default class OnMouseHover extends UIElementState\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\ton_enter(ui_element)\r\n\t{\r\n\t\tthis.__trigger_on_hover(ui_element);\r\n\t}\r\n\r\n\tupdate(ui_element, normalized_mouse_position)\r\n\t{\r\n\t\tif(ui_element.is_mouse_over(normalized_mouse_position))\r\n\t\t{\r\n\t\t\tthis.__trigger_on_hover(ui_element);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tui_element.set_state(ui_element._on_exit_state);\r\n\t\t}\r\n\t}\r\n\r\n\t__trigger_on_hover(ui_element)\r\n\t{\r\n\t\tui_element.on_mouse_hover();\r\n\t}\r\n}\r\n","import UI from '/UI';\r\nimport CameraManager from '/CameraManager';\r\nimport Screen from '/Screen';\r\n\r\nimport UIElementMaterial from '/materials/UIElementMaterial';\r\nimport screen_space_text_frag from '/shaders/ui/ss_texture_frag';\r\nimport screen_space_text_vert from '/shaders/ui/ss_texture_vert';\r\n\r\nimport ScreenSpacePosition from '/ui/ui_element_position/ScreenSpacePosition';\r\nimport WorldSpacePosition from '/ui/ui_element_position/WorldSpacePosition';\r\n\r\nimport OnIdle from '/ui/ui_element_state/OnIdle';\r\nimport OnMouseEnter from '/ui/ui_element_state/OnMouseEnter';\r\nimport OnMouseExit from '/ui/ui_element_state/OnMouseExit';\r\nimport OnMouseHover from '/ui/ui_element_state/OnMouseHover';\r\n\r\n\r\nexport default class UIElement extends THREE.Mesh\r\n{\r\n  constructor(vert, frag)\r\n  {\r\n    super(new THREE.PlaneGeometry(1, 1), new UIElementMaterial());\r\n\r\n\r\n    this.is_clickable = false;\r\n\r\n    this.position_strategy = new WorldSpacePosition();\r\n    this.current_state = new OnIdle();\r\n\r\n    this._position = new THREE.Vector3();\r\n\r\n    this._on_idle_state = new OnIdle();\r\n    this._on_enter_state = new OnMouseEnter();\r\n    this._on_exit_state = new OnMouseExit();\r\n    this._on_hover_state = new OnMouseHover();\r\n\r\n    this.on_enter = undefined;\r\n    this.on_exit = undefined;\r\n    this.on_hover = undefined;\r\n\r\n    this.mouse_pos_tmp = new THREE.Vector2();\r\n    this.cached_NDC_position = new THREE.Vector2();\r\n    this.screen_pos_tmp = new THREE.Vector2();\r\n\r\n\r\n    this.texture_size = new THREE.Vector2(1,1);\r\n\r\n\r\n    this.frustumCulled = false;\r\n    this.matrixAutoUpdate = false;\r\n    this.renderOrder = 0;\r\n\r\n    this.size = 1;\r\n    this.pixel_offset = new THREE.Vector2();\r\n  }\r\n\r\n  set_render_order(value)\r\n  {\r\n    this.renderOrder = value;\r\n  }\r\n\r\n  get pivot_point()\r\n  {\r\n    return this.material.uniforms._PivotPoint.value;\r\n  }\r\n\r\n  set_pixel_offset(offset)\r\n  {\r\n    this.pixel_offset.copy(offset);\r\n    this.material.uniforms._PixelOffset.value.copy(offset);\r\n  }\r\n\r\n  set_state(new_state)\r\n  {\r\n    this.current_state.on_exit(this);\r\n    this.current_state = new_state;\r\n    this.current_state.on_enter(this);\r\n  }\r\n\r\n  get position()\r\n  {\r\n    return this._position;\r\n  }\r\n\r\n  set use_depth(boolean)\r\n  {\r\n    this.material.depthTest = boolean;\r\n  }\r\n\r\n  set depth_offset(value)\r\n  {\r\n    this.material.uniforms._DepthOffset.value = value;\r\n  }\r\n\r\n  clear_state()\r\n  {\r\n    this.visible = false;\r\n  }\r\n\r\n\r\n  set_world_space_coordinate_system()\r\n  {\r\n    this.position_strategy = new WorldSpacePosition();\r\n  }\r\n  set_screen_space_coordinate_system()\r\n  {\r\n    this.position_strategy = new ScreenSpacePosition();\r\n  }\r\n\r\n  set_texture(texture)\r\n  {\r\n    texture.minFilter = THREE.NearestFilter;\r\n    texture.magFilter = THREE.NearestFilter;\r\n    texture.needsUpdate = true;\r\n\r\n    this.texture_size.set(texture.image.width, texture.image.height);\r\n\r\n    this.material.uniforms._MainTex.value = texture;\r\n    this.get_size(this.material.uniforms._TextureSize.value);\r\n    this.visible = true;\r\n  }\r\n\r\n  update_state(normalized_mouse_pos)\r\n  {\r\n    this.material.uniforms._ScreenSize.value.set(Screen.width, Screen.height);\r\n    this.get_size(this.material.uniforms._TextureSize.value);\r\n\r\n    this.cached_NDC_position.copy(this.position_strategy.get_pos_NDC(this.position));\r\n    this.material.uniforms._NDC.value.copy(this.position);\r\n    this.current_state.update(this, normalized_mouse_pos);\r\n  }\r\n\r\n  is_mouse_over(normalized_mouse_pos)\r\n  {\r\n\r\n    this.screen_pos_tmp.copy(this.cached_NDC_position)\r\n    this.to_screen_position(this.screen_pos_tmp);\r\n    this.screen_pos_tmp.x += this.pixel_offset.x;\r\n    this.screen_pos_tmp.y += this.pixel_offset.y;\r\n\r\n    let rect = new THREE.Box2().setFromCenterAndSize(this.screen_pos_tmp, this.get_size());\r\n\r\n\r\n    this.mouse_pos_tmp.copy(normalized_mouse_pos);\r\n    this.to_screen_position(this.mouse_pos_tmp);\r\n\r\n    return rect.containsPoint(this.mouse_pos_tmp);\r\n  }\r\n\r\n  to_screen_position(projected_pos)\r\n  {\r\n    projected_pos.x = (projected_pos.x * 0.5 + 0.5) * Screen.width  + this.pixel_offset.x;\r\n    projected_pos.y = (projected_pos.y * 0.5 + 0.5) * Screen.height + this.pixel_offset.y;\r\n  }\r\n\r\n  get_screen_space_position()\r\n  {\r\n    let pos = this.cached_NDC_position.clone()\r\n    this.to_screen_position(pos);\r\n    return pos;\r\n  }\r\n  set_screen_space_position(screen_pos)\r\n  {\r\n    this.position.x = (screen_pos.x / Screen.width) * 2 - 1;\r\n    this.position.y = (screen_pos.y / Screen.height) * 2 - 1;\r\n  }\r\n\r\n  dispose()\r\n  {\r\n    if(this.material.uniforms._MainTex.value)\r\n    {\r\n      this.material.uniforms._MainTex.value.dispose();\r\n    }\r\n    Screen.remove_screen_material(this.material);\r\n    this.geometry.dispose();\r\n    this.material.dispose();\r\n  }\r\n\r\n  get_size(vector2)\r\n  {\r\n    if (vector2)\r\n    {\r\n      return vector2.copy(this.texture_size).multiplyScalar(this.size / Screen.dpr);\r\n    }\r\n    else\r\n    {\r\n      return new THREE.Vector2().copy(this.texture_size).multiplyScalar(this.size / Screen.dpr);\r\n    }\r\n  }\r\n\r\n  on_mouse_enter(){}\r\n  on_mouse_exit(){}\r\n  on_mouse_hover(){}\r\n\r\n}\r\n\r\n","module.exports=\"#define GLSLIFY 1\\nuniform float _Thickness;\\n\\nattribute vec3 next_position;\\nattribute vec3 previous_position;\\nattribute float orientation;\\nattribute float coverage;\\n\\nvarying float line_coverage;\\nvarying float uv_u;\\n\\nvec3 w_space_normal(vec3 from, vec3 to)\\n{\\n  vec3 w_from = (modelMatrix * vec4(from, 1.0)).xyz;\\n  vec3 w_to   = (modelMatrix * vec4(to, 1.0)).xyz;\\n\\n  vec3 z = normalize(w_to - w_from);\\n  return normalize(cross(z , normalize(cameraPosition - w_from)));\\n\\n}\\n\\nvoid main()\\n{\\n\\n  mat4 VP = projectionMatrix * viewMatrix;\\n\\n  vec3 pos = position;\\n  vec3 normal = w_space_normal(next_position ,previous_position);\\n  pos = (modelMatrix * vec4(pos, 1.0)).xyz;\\n  pos += normal * (_Thickness * 0.5) * orientation;\\n\\n  gl_Position = VP * vec4(pos, 1.0);\\n\\n  line_coverage = coverage;\\n  uv_u = orientation * 0.5 + 0.5;\\n\\n}\";","module.exports=\"#define GLSLIFY 1\\nuniform float _Length;\\nuniform float _ElapsedTime;\\nuniform float _Thickness;\\nuniform vec3  _Color;\\n\\nvarying float line_coverage;\\nvarying float uv_u;\\n\\nfloat aastep(float threshold, float value) {\\n  #ifdef GL_OES_standard_derivatives\\n    float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;\\n    return smoothstep(threshold-afwidth, threshold+afwidth, value);\\n  #else\\n    return step(threshold, value);\\n  #endif  \\n}\\n\\nvoid main()\\n{\\n\\n    // float y = fract(line_coverage /_Thickness - _TrueElapsedTime) ;\\n\\n    // vec2 uv = vec2(uv_u, y);\\n\\n   \\n    // vec4 col = texture2D(_ArrowsTex,uv);\\n    // col.rgb *= _ForwardColor;\\n    // col.a = aastep(0.5, col.a);\\n    // gl_FragColor = col;\\n    float u = (1.0 - abs(uv_u * 2.0 - 1.0));\\n    float diffuse = dot(vec2(u, u), vec2(0.0, 1.0)) * 0.5+0.5;\\n    gl_FragColor = vec4(_Color * diffuse, 1.0);\\n\\n}\";","import line_vs from '/shaders/basic_line/basic_line_vert'\r\nimport line_fs from '/shaders/basic_line/basic_line_frag'\r\n\r\nexport default class Line extends THREE.Mesh {\r\n\r\n  constructor(points) {\r\n\r\n\r\n    let geometry = new THREE.BufferGeometry();\r\n    geometry.setAttribute('position',           new THREE.BufferAttribute(new Float32Array([]), 3));\r\n    geometry.setAttribute('next_position',      new THREE.BufferAttribute(new Float32Array([]), 3));\r\n    geometry.setAttribute('previous_position',  new THREE.BufferAttribute(new Float32Array([]), 3));\r\n    geometry.setAttribute('orientation',        new THREE.BufferAttribute(new Float32Array([]), 1));\r\n    geometry.setAttribute('coverage',           new THREE.BufferAttribute(new Float32Array([]), 1));\r\n\r\n    let material = new THREE.ShaderMaterial({\r\n      uniforms: {\r\n        _Thickness: { value: 0.2 },\r\n        _Length: { value: 0 },\r\n        _ElapsedTime: { value: 0 },\r\n        _Color: {value: new THREE.Color(\"#FF0000\")},\r\n      },\r\n      vertexShader: line_vs,\r\n      fragmentShader: line_fs,\r\n      transparent: true,\r\n      depthWrite: false,\r\n      extensions: { derivatives: true}\r\n\r\n    });\r\n\r\n    super(geometry, material);\r\n\r\n    if(points)\r\n      this.setup(points);\r\n  }\r\n\r\n  setup(points)\r\n  {\r\n\r\n    let vertices = [];\r\n    let next_position = [];\r\n    let previous_position = [];\r\n    let orientation = [];\r\n    let coverage = [];\r\n    let accumulated_length = 0;\r\n\r\n\r\n    for (let i = 0; i < points.length; i++) {\r\n\r\n      vertices.push(points[i].x);\r\n      vertices.push(points[i].y);\r\n      vertices.push(points[i].z);\r\n      orientation.push(1);\r\n\r\n      vertices.push(points[i].x);\r\n      vertices.push(points[i].y);\r\n      vertices.push(points[i].z);\r\n      orientation.push(-1);\r\n\r\n      let next_point = this.__get_next_position(points, i);\r\n      next_position.push(next_point.x);\r\n      next_position.push(next_point.y);\r\n      next_position.push(next_point.z);\r\n\r\n      next_position.push(next_point.x);\r\n      next_position.push(next_point.y);\r\n      next_position.push(next_point.z);\r\n\r\n      let previous_point = this.__get_previous_position(points, i);\r\n      previous_position.push(previous_point.x);\r\n      previous_position.push(previous_point.y);\r\n      previous_position.push(previous_point.z);\r\n\r\n      previous_position.push(previous_point.x);\r\n      previous_position.push(previous_point.y);\r\n      previous_position.push(previous_point.z);\r\n\r\n      coverage.push(accumulated_length);\r\n      coverage.push(accumulated_length);\r\n\r\n      if (i < points.length - 1)\r\n        accumulated_length += points[i].distanceTo(next_point);\r\n\r\n    }\r\n    let vertexList            = new Float32Array(vertices);\r\n    let nextPositionList      = new Float32Array(next_position);\r\n    let previousPositionList  = new Float32Array(previous_position);\r\n    let orientationList       = new Float32Array(orientation);\r\n    let coverageList          = new Float32Array(coverage);\r\n\r\n\r\n    let indices = [];\r\n    for (let i = 0; i < ((vertexList.length / 3) - 2) / 2; i++) {\r\n      let index = (i * 2) + 1;\r\n      indices.push(index);\r\n      indices.push(index + 1);\r\n      indices.push(index - 1);\r\n\r\n      indices.push(index);\r\n      indices.push(index + 2);\r\n      indices.push(index + 1);\r\n    }\r\n\r\n    this.geometry.setIndex(indices);\r\n    this.geometry.getAttribute('position').copy(          new THREE.BufferAttribute(vertexList, 3));\r\n    this.geometry.getAttribute('next_position').copy(     new THREE.BufferAttribute(nextPositionList, 3));\r\n    this.geometry.getAttribute('previous_position').copy( new THREE.BufferAttribute(previousPositionList, 3));\r\n    this.geometry.getAttribute('orientation').copy(       new THREE.BufferAttribute(orientationList, 1));\r\n    this.geometry.getAttribute('coverage').copy(          new THREE.BufferAttribute(coverageList, 1));\r\n\r\n    this.geometry.getAttribute('position').needsUpdate = true;\r\n    this.geometry.getAttribute('next_position').needsUpdate = true;\r\n    this.geometry.getAttribute('previous_position').needsUpdate = true;\r\n    this.geometry.getAttribute('orientation').needsUpdate = true;\r\n    this.geometry.getAttribute('coverage').needsUpdate = true;\r\n\r\n    this.material.uniforms._Length.value = accumulated_length;\r\n    this._length = accumulated_length;\r\n  }\r\n\r\n  set thickness(value)\r\n  {\r\n    this.material.uniforms._Thickness.value = value;\r\n  }\r\n\r\n\r\n\r\n  __get_previous_position(points, i)\r\n  {\r\n    if(i === 0)\r\n    {\r\n      return points[1].clone().sub(points[0]).multiplyScalar(-1).add(points[0]);\r\n    }\r\n    else\r\n    {\r\n      return points[i-1];\r\n    }\r\n  }\r\n  __get_next_position(points, i)\r\n  {\r\n    if(i === points.length-1)\r\n    {\r\n      return points[points.length-2].clone().sub(points[points.length-1]).multiplyScalar(-1).add(points[points.length-1]);\r\n    }\r\n    else\r\n    {\r\n      return points[i+1];\r\n    }\r\n  }\r\n\r\n  update() {\r\n  }\r\n\r\n  distance()\r\n  {\r\n    return this.accumulated_length;\r\n  }\r\n  total_length()\r\n  {\r\n    return this.accumulated_length;\r\n  }\r\n\r\n  dispose()\r\n  {\r\n    this.geometry.dispose();\r\n    this.material.dispose();\r\n    if(this.parent)\r\n      this.parent.remove(this);\r\n  }\r\n\r\n  set color(col)\r\n  {\r\n  \tthis.material.uniforms._Color.value.set(col);\r\n  }\r\n  copy_color(col)\r\n  {\r\n  \tthis.material.uniforms._Color.value.copy(col);\r\n  }\r\n}\r\n","import Grid from '/components/Grid';\r\nimport UIElement from '/components/UIElement';\r\nimport Line from '/components/Line';\r\nexport default {\r\n  Grid: Grid,\r\n  Line: Line,\r\n  UIElement: UIElement\r\n}\r\n","export default class CanvasDrawer\r\n{\r\n\tconstructor (uses_dynamic_font)\r\n  {\r\n    this.uses_dynamic_font = uses_dynamic_font;\r\n    this.__textHeight = null;\r\n\r\n    this.canvas = document.createElement('canvas');\r\n    this.ctx = this.canvas.getContext('2d');\r\n  }\r\n\r\n  getFontHeight (fontStyle = \"Arial\") {\r\n\r\n    if(this.__textHeight == null || this.uses_dynamic_font)\r\n    {\r\n      var body = document.getElementsByTagName('body')[0];\r\n      var dummy = document.createElement('div');\r\n      var dummyText = document.createTextNode('MqgOLAKTAL');\r\n      dummy.appendChild(dummyText);\r\n      dummy.setAttribute('style', `font:${ fontStyle };position:absolute;top:0;left:0`);\r\n      body.appendChild(dummy);\r\n      this.__textHeight = dummy.offsetHeight;\r\n      body.removeChild(dummy);\r\n    }\r\n    return this.__textHeight;\r\n\r\n  }\r\n\r\n\r\n\r\n  get_text_size(text, font = \"24px Arial\")\r\n  {\r\n\r\n\r\n  \tlet size = new THREE.Vector2();\r\n  \tthis.ctx.font = font;\r\n\t\tsize.x = Math.ceil(this.ctx.measureText(text).width) * window.devicePixelRatio;\r\n    size.y = Math.ceil(this.getFontHeight(font)) * window.devicePixelRatio;\r\n    return size;\r\n  }\r\n\r\n  draw_canvas (text, ctxOptions = {})\r\n  {\r\n    ctxOptions.font = ctxOptions.font || '24px Arial';\r\n    ctxOptions.font_color = ctxOptions.font_color || '#000000';\r\n\r\n  \tthis.__draw(text, ctxOptions, this.canvas, this.ctx);\r\n  \treturn this.canvas;\r\n  }\r\n\r\n  draw_on_texture(text, ctxOptions)\r\n  {\r\n    let canvas = this.draw_canvas(text, ctxOptions);\r\n    let canvas_texture = new THREE.CanvasTexture(canvas, THREE.UVMapping,\r\n                                          THREE.ClampToEdgeWrapping,\r\n                                          THREE.ClampToEdgeWrapping,\r\n                                          THREE.NearestFilter,\r\n                                          THREE.NearestFilter);\r\n    canvas_texture.generateMipMaps = false;\r\n    canvas_texture.needsUpdate = true;\r\n\r\n    return canvas_texture;\r\n  }\r\n\r\n  __draw(text, ctxOptions){};\r\n\r\n  roundRect(ctx, x, y, width, height, radius, fill, stroke) {\r\n      if (typeof stroke == 'undefined') {\r\n        stroke = true;\r\n      }\r\n      if (typeof radius === 'undefined') {\r\n        radius = 5;\r\n      }\r\n      if (typeof radius === 'number') {\r\n        radius = {tl: radius, tr: radius, br: radius, bl: radius};\r\n      } else {\r\n        var defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};\r\n        for (var side in defaultRadius) {\r\n          radius[side] = radius[side] || defaultRadius[side];\r\n        }\r\n      }\r\n      ctx.beginPath();\r\n      ctx.moveTo(x + radius.tl, y);\r\n      ctx.lineTo(x + width - radius.tr, y);\r\n      ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);\r\n      ctx.lineTo(x + width, y + height - radius.br);\r\n      ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);\r\n      ctx.lineTo(x + radius.bl, y + height);\r\n      ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);\r\n      ctx.lineTo(x, y + radius.tl);\r\n      ctx.quadraticCurveTo(x, y, x + radius.tl, y);\r\n      ctx.closePath();\r\n      if (fill) {\r\n        ctx.fill();\r\n      }\r\n      if (stroke) {\r\n        ctx.stroke();\r\n      }\r\n\r\n    }\r\n}\r\n","\r\nexport default class AxisHelper extends THREE.Object3D {\r\n  constructor(scale = 1.0) {\r\n    super();\r\n\r\n    const blueAxisMat = new THREE.LineBasicMaterial({ color: 0x4444ff, depthFunc: THREE.AlwaysDepth });\r\n    const blueAxisGeo = new THREE.Geometry();\r\n    blueAxisGeo.vertices.push(new THREE.Vector3(0, 0, 0));\r\n    blueAxisGeo.vertices.push(new THREE.Vector3(0, 0, 1000));\r\n    const blueAxisLine = new THREE.Line(blueAxisGeo, blueAxisMat);\r\n    blueAxisLine.renderOrder = 50000;\r\n\r\n    const greenAxisMat = new THREE.LineBasicMaterial({ color: 0x44ff44, depthFunc: THREE.AlwaysDepth });\r\n    const greenAxisGeo = new THREE.Geometry();\r\n    greenAxisGeo.vertices.push(new THREE.Vector3(0, 0, 0));\r\n    greenAxisGeo.vertices.push(new THREE.Vector3(0, 1000, 0));\r\n    const greenAxisLine = new THREE.Line(greenAxisGeo, greenAxisMat);\r\n    greenAxisLine.renderOrder = 50000;\r\n\r\n    const redAxisMat = new THREE.LineBasicMaterial({ linewidth: 100, color: 0xff4444, depthFunc: THREE.AlwaysDepth });\r\n    const redAxisGeo = new THREE.Geometry();\r\n    redAxisGeo.vertices.push(new THREE.Vector3(0, 0, 0));\r\n    redAxisGeo.vertices.push(new THREE.Vector3(1000, 0, 0));\r\n    const redAxisLine = new THREE.Line(redAxisGeo, redAxisMat);\r\n    redAxisLine.renderOrder = 50000;\r\n    this.renderOrder = 100000;\r\n    this.add(blueAxisLine);\r\n    this.add(greenAxisLine);\r\n    this.add(redAxisLine);\r\n    this.scale.set(scale, scale, scale);\r\n\r\n  }\r\n\r\n  update() {\r\n  }\r\n\r\n  dispose() {\r\n\r\n  }\r\n}\r\n","import Mesh from '/Mesh';\r\n\r\nexport default class Cube extends Mesh\r\n{\r\n\tconstructor(size, segments, color)\r\n\t{\r\n\t\tsize \t\t\t= size || new THREE.Vector3(1,1,1);\r\n\t\tsegments \t= segments || new THREE.Vector3(1,1,1);\r\n    color \t\t= color || 0xff0000;\r\n    let geometry = new THREE.BoxGeometry( size.x, size.y, size.z, segments.x, segments.y, segments.z);\r\n    let material = new THREE.MeshBasicMaterial( {color: color} );\r\n\t\tsuper(geometry, material);\r\n\t}\r\n}\r\n","import AxisHelper from '/components/AxisHelper';\r\nimport basic_color_vert from '/shaders/basic_color/basic_color_vert';\r\nimport basic_color_frag from '/shaders/basic_color/basic_color_frag';\r\nimport SceneManager from '/SceneManager';\r\nimport Graphics from '/Graphics';\r\nimport Cube from '/primitives/Cube';\r\nimport Sphere from '/primitives/Sphere';\r\nimport Arrow from '/primitives/Arrow';\r\n\r\nclass Debug {\r\n  constructor() {\r\n    this.Vector3_one = new THREE.Vector3(1,1,1);\r\n    this.Vector3_zero = new THREE.Vector3(0,0,0);\r\n    this.canvas_renderer = undefined;\r\n\r\n    this.rt_debug = undefined;\r\n  }\r\n\r\n  init(webgl)\r\n  {\r\n    this.webgl = webgl;\r\n\r\n    this.ctx = undefined;\r\n\r\n    // var cln = webgl.dom.cloneNode(false);\r\n    // cln.id = \"canvas_debug\";\r\n    // $(cln).css(\"position\", \"absolute\");\r\n    // webgl.dom.parentElement.insertBefore(cln, webgl.dom);\r\n    // this.ctx = cln.getContext('2d');\r\n\r\n    // this.ctx.clearRect(0, 0, cln.width, cln.height);\r\n    // this.ctx.fillStyle =  \"rgba(255, 0, 0, 1)\";\r\n\r\n  }\r\n\r\n  draw_arrow(origin, dir, color = 0xff0000)\r\n  {\r\n    let arrow = new Arrow(color, dir.length(), dir.clone().normalize());\r\n    arrow.position.copy(origin);\r\n    SceneManager.current.add(arrow);\r\n    return arrow;\r\n  }\r\n\r\n  draw_axis()\r\n  {\r\n    let axis = new AxisHelper();\r\n    SceneManager.current.add(axis);\r\n    return axis;\r\n  }\r\n\r\n  set_debug_RT(RT)\r\n  {\r\n    this.rt_debug = RT;\r\n  }\r\n\r\n  draw_rectangle(position_2d, width, height, color)\r\n  {\r\n    width  = width || 100;\r\n    height = height || 100;\r\n    this.ctx.fillStyle =  color || \"rgba(255, 0, 0, 1)\";\r\n    this.ctx.fillRect(position_2d.x - width/2,\r\n                      (this.ctx.canvas.height - position_2d.y) - height/2,width,height);\r\n\r\n  }\r\n\r\n  clear()\r\n  {\r\n    if(this.ctx)\r\n      this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n  }\r\n\r\n  draw_line_2D(from, to, color)\r\n  {\r\n    this.ctx.strokeStyle =  color ||\"rgba(255, 0, 0, 1)\";\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(from.x, from.y);\r\n    this.ctx.lineTo(to.x, to.y);\r\n    this.ctx.closePath();\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  draw_line(points, color = 0xff0000)\r\n  {\r\n    var material = new THREE.LineBasicMaterial({\r\n      color: color\r\n    });\r\n\r\n    var geometry = new THREE.BufferGeometry().setFromPoints(points);\r\n\r\n    var line = new THREE.Line(geometry, material);\r\n    line.frustumCulled = false;\r\n    SceneManager.current.add(line);\r\n    return line;\r\n  }\r\n\r\n\r\n  draw_cube(pos, size, color)\r\n  {\r\n    size = size || 1;\r\n    color = color || 0xff0000;\r\n    pos = pos || new THREE.Vector3();\r\n\r\n    var cube = new Cube(new THREE.Vector3(size, size, size), undefined, color );\r\n    cube.position.copy(pos);\r\n    SceneManager.current.add( cube );\r\n    return cube;\r\n  }\r\n  draw_oriented_cube(from, to, height = 1, color = \"#FF0000\", depth = 0.1)\r\n  {\r\n  \tlet size = from.distanceTo(to);\r\n    let cube = new Cube(new THREE.Vector3(depth, height, size), undefined, color );\r\n\r\n  \tlet center = to.clone().sub(from).multiplyScalar(0.5);\r\n\t\tlet forward_dir = center.clone().normalize();\r\n\t\tcenter.add(from);\r\n\r\n\t\tcube.position.copy(center);\r\n\r\n\r\n\t\tlet up = new THREE.Vector3(0,1,0);\r\n  \tlet forward = forward_dir.clone();\r\n  \tlet right = forward.clone().cross(up);\r\n\r\n  \t// cube.quaternion.setFromRotationMatrix(new THREE.Matrix4().makeBasis(right,up,forward));\r\n  \tcube.quaternion.setFromUnitVectors(new THREE.Vector3(0,0,-1), forward_dir);\r\n\r\n    SceneManager.current.add( cube );\r\n    return cube;\r\n  }\r\n  draw_plane(width, height, color)\r\n  {\r\n    var geometry = new THREE.PlaneGeometry( width, height );\r\n    let material = new THREE.ShaderMaterial({\r\n      uniforms: {\r\n        _Color: {value : new THREE.Vector4(0,1,0, 0.2)},\r\n      },\r\n      vertexShader: basic_color_vert,\r\n      fragmentShader: basic_color_frag,\r\n      transparent: true,\r\n      depthWrite: false\r\n    });\r\n\r\n    var plane = new THREE.Mesh( geometry, material );\r\n    plane.renderOrder = -10000\r\n    SceneManager.current.add(plane);\r\n    return plane;\r\n  }\r\n  draw_empty_cube(pos, size,color)\r\n  {\r\n    size = size || 1;\r\n    color = color || 0xff0000;\r\n\r\n    let box = new THREE.Box3().setFromCenterAndSize(new THREE.Vector3(), new THREE.Vector3(size, size, size));\r\n    let helper = new THREE.Box3Helper( box, color );\r\n    helper.position.copy(pos || new THREE.Vector3());\r\n    return helper;\r\n  }\r\n  draw_sphere(pos, size, color)\r\n  {\r\n    size = size || 1;\r\n    color = color || 0xff0000;\r\n    pos = pos || new THREE.Vector3();\r\n\r\n    var sphere = new Sphere(size, color );\r\n    sphere.position.copy(pos);\r\n    SceneManager.current.add( sphere );\r\n    return sphere;\r\n  }\r\n\r\n  draw_point_array(input_points, open = false, color = 0xff0000 )\r\n  {\r\n    let catmull = new THREE.CatmullRomCurve3(input_points, open)\r\n    catmull.updateArcLengths();\r\n    let points = catmull.getSpacedPoints(200);\r\n    let line_helper = this.draw_line(points, 0x00ff00);\r\n    // line_helper.position.y = 1.5;\r\n    return line_helper;\r\n  }\r\n  draw_sphere_helper(sphere, color)\r\n  {\r\n    color = color || 0xff0000;\r\n    var geometry = new THREE.SphereGeometry( sphere.radius, 32, 32 );\r\n    var material = new THREE.MeshBasicMaterial( {color: color} );\r\n    var sphere_mesh = new THREE.Mesh( geometry, material );\r\n    sphere_mesh.position.copy(sphere.center);\r\n    SceneManager.current.add(sphere_mesh);\r\n    return sphere_mesh;\r\n  }\r\n\r\n  draw_math_sphere(sphere)\r\n  {\r\n    var geometry = new THREE.SphereGeometry( sphere.radius, 32, 32 );\r\n    let material = new THREE.ShaderMaterial({\r\n      uniforms: {\r\n        _Color: {value : new THREE.Vector4(1,0,0, 0.2)},\r\n      },\r\n      vertexShader: basic_color_vert,\r\n      fragmentShader: basic_color_frag,\r\n      transparent: true\r\n    });\r\n    // var material = new THREE.MeshBasicMaterial( {color: 0xff0000, transparent = true} );\r\n    var sphere1 = new THREE.Mesh( geometry, material );\r\n    sphere1.position.copy(sphere.center);\r\n    SceneManager.current.add(sphere1)\r\n  }\r\n\r\n  draw_bounding_box(bb)\r\n  {\r\n    var helper = new THREE.Box3Helper( bb, 0xffff00 );\r\n    SceneManager.current.add( helper );\r\n  }\r\n\r\n  draw_curve(curve, options)\r\n  {\r\n    let offset = new THREE.Vector3(0,0, 0);\r\n    if(options)\r\n      offset.y = options.offset || 0;\r\n\r\n    for(let i=0; i< curve.length-1; i++)\r\n    {\r\n      this.draw_line(curve[i].clone().add(offset), curve[i+1].clone().add(offset));\r\n    }\r\n  }\r\n\r\n}\r\n\r\nconst DEBUG = new Debug();\r\nmodule.exports = DEBUG;\r\n","module.exports=\"#define GLSLIFY 1\\nvarying vec3 v_normal;\\n\\nvoid main()\\n{\\n    gl_FragColor = vec4(v_normal * 0.5 + vec3(0.5), 1.0);\\n}\\n\";","module.exports=\"#define GLSLIFY 1\\nvarying vec3 v_normal;\\nvoid main()\\n{\\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\\n    v_normal = (modelMatrix * vec4(normal, 0.0)).xyz;\\n}\\n\";","import frag from '/shaders/normal/normal.frag';\r\nimport vert from '/shaders/normal/normal.vert';\r\n\r\nexport default class NormalMaterial extends THREE.ShaderMaterial {\r\n    constructor() {\r\n        super({\r\n            uniforms: {\r\n            },\r\n            vertexShader: vert,\r\n            fragmentShader: frag\r\n        });\r\n\r\n    }\r\n\r\n}\r\n","import CameraManager from '/CameraManager';\r\nimport SceneManager from '/SceneManager';\r\nimport Screen from '/Screen';\r\nimport BaseRender from '/render_mode/BaseRender';\r\nimport Graphics from '/Graphics';\r\nimport NormalMaterial from '/materials/NormalMaterial';\r\nexport default class DebugNormalsRender extends BaseRender {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n\r\n    render() {\r\n        Graphics.clear(undefined, CameraManager.current, true, true);\r\n\r\n        Graphics.render(SceneManager.current, CameraManager.current, undefined, new NormalMaterial());\r\n    }\r\n\r\n}\r\n","export default class EasingFunctions {\r\n\tconstructor() { }\r\n\tstatic triangular(x) {\r\n\t\treturn 1 - Math.abs((x * 2) % (1 * 2) - 1);\r\n\t}\r\n\tstatic ease_out_sine(x) {\r\n\t\treturn Math.sin(x * 3.14 / 2);\r\n\t}\r\n\r\n\tstatic ease_in_out_cubic(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t4 * x * x * x :\r\n\t\t\t1 - Math.pow(-2 * x + 2, 3) / 2;\r\n\t}\r\n\r\n\tstatic ease_out_cubic(x) {\r\n\t\treturn 1 - Math.pow(1 - x, 3);\r\n\t}\r\n\r\n\tstatic ease_in_out_quint(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t16 * x * x * x * x * x :\r\n\t\t\t1 - Math.pow(-2 * x + 2, 5) / 2;\r\n\t}\r\n\r\n\tstatic ease_out_quint(x) {\r\n\t\treturn 1 - Math.pow(1 - x, 5);\r\n\t}\r\n\r\n\tstatic ease_in_out_circ(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t(1 - Math.Math.sqrt(1 - Math.pow(2 * x, 2))) / 2 :\r\n\t\t\t(Math.Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\r\n\t}\r\n\r\n\tstatic ease_out_quad(x) {\r\n\t\treturn 1 - (1 - x) * (1 - x);\r\n\t}\r\n\tstatic easeInElastic(t) {\r\n\t\treturn (0.04 - 0.04 / t) * Math.sin(25.0 * t) + 1.0;\r\n\t}\r\n\r\n\tstatic heartbeat(t) {\r\n\t\treturn 1.0 - Math.pow(Math.abs(Math.sin(t + 1.0)), 63.0) * Math.sign(Math.sin(t)) * Math.sin(t + 1.5 + 1.0) * 0.8;\r\n\t}\r\n\r\n\tstatic easeInQuad(x) {\r\n\t\treturn x * x;\r\n\t}\r\n\r\n\tstatic easeOutQuad(x) {\r\n\t\treturn 1 - (1 - x) * (1 - x);\r\n\t}\r\n\r\n\tstatic easeInOutQuad(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t2 * x * x :\r\n\t\t\t1 - Math.pow(-2 * x + 2, 2) / 2;\r\n\t}\r\n\r\n\tstatic easeInCubic(x) {\r\n\t\treturn x * x * x;\r\n\t}\r\n\r\n\tstatic easeOutCubic(x) {\r\n\t\treturn 1 - Math.pow(1 - x, 3);\r\n\t}\r\n\r\n\tstatic easeInOutCubic(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t4 * x * x * x :\r\n\t\t\t1 - Math.pow(-2 * x + 2, 3) / 2;\r\n\t}\r\n\r\n\tstatic easeInQuart(x) {\r\n\t\treturn x * x * x * x;\r\n\t}\r\n\r\n\tstatic easeOutQuart(x) {\r\n\t\treturn 1 - Math.pow(1 - x, 4);\r\n\t}\r\n\r\n\tstatic easeInOutQuart(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t8 * x * x * x * x :\r\n\t\t\t1 - Math.pow(-2 * x + 2, 4) / 2;\r\n\t}\r\n\r\n\tstatic easeInQuint(x) {\r\n\t\treturn x * x * x * x * x;\r\n\t}\r\n\r\n\tstatic easeOutQuint(x) {\r\n\t\treturn 1 - Math.pow(1 - x, 5);\r\n\t}\r\n\r\n\tstatic easeInOutQuint(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t16 * x * x * x * x * x :\r\n\t\t\t1 - Math.pow(-2 * x + 2, 5) / 2;\r\n\t}\r\n\r\n\tstatic easeInSine(x) {\r\n\t\treturn 1 - Math.cos(x * 3.1415926 / 2);\r\n\t}\r\n\r\n\tstatic easeOutSine(x) {\r\n\t\treturn Math.sin(x * 3.1415926 / 2);\r\n\t}\r\n\r\n\tstatic easeInOutSine(x) {\r\n\t\treturn -(Math.cos(3.1415926 * x) - 1) / 2;\r\n\t}\r\n\r\n\tstatic easeInExpo(x) {\r\n\t\treturn x === 0 ? 0 : Math.pow(2, 10 * x - 10);\r\n\t}\r\n\r\n\tstatic easeOutExpo(x) {\r\n\t\treturn x === 1 ? 1 : 1 - Math.pow(2, -10 * x);\r\n\t}\r\n\r\n\tstatic easeInOutExpo(x) {\r\n\t\treturn x === 0 ? 0 : x === 1 ? 1 : x < 0.5 ?\r\n\t\t\tpow(2, 20 * x - 10) / 2 :\r\n\t\t\t(2 - Math.pow(2, -20 * x + 10)) / 2;\r\n\t}\r\n\r\n\tstatic easeInCirc(x) {\r\n\t\treturn 1 - Math.sqrt(1 - Math.pow(x, 2));\r\n\t}\r\n\r\n\tstatic easeOutCirc(x) {\r\n\t\treturn Math.sqrt(1 - Math.pow(x - 1, 2));\r\n\t}\r\n\r\n\tstatic easeInOutCirc(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t(1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2 :\r\n\t\t\t(Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\r\n\t}\r\n\r\n\tstatic easeInBack(x) {\r\n\t\treturn 2.7015 * x * x * x - 1.7015 * x * x;\r\n\t}\r\n\r\n\tstatic easeOutBack(x) {\r\n\t\treturn 1 + 2.7015 * Math.pow(x - 1, 3) + 1.7015 * Math.pow(x - 1, 2);\r\n\t}\r\n\r\n\tstatic easeInOutBack(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t(Math.pow(2 * x, 2) * ((2.5949095 + 1) * 2 * x - 2.5949095)) / 2 :\r\n\t\t\t(Math.pow(2 * x - 2, 2) * ((2.5949095 + 1) * (x * 2 - 2) + 2.5949095) + 2) / 2;\r\n\t}\r\n\r\n\t// static easeInElastic(x) {\r\n\t// \treturn x === 0 ? 0 : x === 1 ? 1 :\r\n\t// \t\t-Math.pow( 2, 10 * x - 10 ) * Math.sin( ( x * 10 - 10.75 ) * 2.0943950 );\r\n\t// }\r\n\r\n\tstatic easeOutElastic(x) {\r\n\t\treturn x === 0 ? 0 : x === 1 ? 1 :\r\n\t\t\tMath.pow(2, -10 * x) * Math.sin((x * 10 - 0.75) * 2.0943950) + 1;\r\n\t}\r\n\r\n\tstatic easeInOutElastic(x) {\r\n\t\treturn x === 0 ? 0 : x === 1 ? 1 : x < 0.5 ?\r\n\t\t\t-(Math.pow(2, 20 * x - 10) * Math.sin((20 * x - 11.125) * 1.3962633)) / 2 :\r\n\t\t\tMath.pow(2, -20 * x + 10) * Math.sin((20 * x - 11.125) * 1.3962633) / 2 + 1;\r\n\t}\r\n\r\n\tstatic easeInBounce(x) {\r\n\t\treturn 1 - bounceOut(1 - x);\r\n\t}\r\n\r\n\tstatic easeInOutBounce(x) {\r\n\t\treturn x < 0.5 ?\r\n\t\t\t(1 - bounceOut(1 - 2 * x)) / 2 :\r\n\t\t\t(1 + bounceOut(2 * x - 1)) / 2;\r\n\t}\r\n\r\n\r\n}\r\n","class EventManager\r\n{\r\n\r\n    constructor()\r\n    {\r\n        this.queue = {};\r\n\r\n        this.zoom_changed_evt           = \"zoom_changed\";\r\n        this.store_clickd_evt           = \"store_clicked\";\r\n        this.point_selected_evt         = \"point_selected\";\r\n        this.config_changed             = \"config_changed\";\r\n\r\n        this.path_substep_completed     = \"path_substep_completed\";\r\n        this.path_completed             = \"path_completed\";\r\n        this.go_to_store_requested_evt  = \"go_to_store_requested\";\r\n\r\n        this.resource_loaded_evt        = \"resource_loaded\";\r\n        this.service_clicked_evt        = \"service_clicked\";\r\n        this.unit_pos_updated_evt       = \"unit_position_updated\";\r\n\r\n        this.floor_changed_evt          = \"floor_changed\";\r\n\r\n        this.on_enter_floor_navigation  = \"on_enter_floor_navigation\";\r\n        this.on_exit_floor_navigation   = \"on_exit_floor_navigation\";\r\n\r\n        this.on_enter_floor_selection   = \"on_enter_floor_selection\";\r\n        this.on_exit_floor_selection    = \"on_exit_floor_selection\";\r\n\r\n        this.on_enter_outside_navigation  = \"on_enter_outside_navigation\";\r\n        this.on_exit_outside_navigation   = \"on_exit_outside_navigation\";\r\n\r\n        this.step_selected_evt = \"step_selected\";\r\n\r\n\r\n        \r\n    }\r\n\r\n    fire(event, payload)\r\n    {\r\n        let queue = this.queue[event];\r\n\r\n        if (queue === undefined) {\r\n            return;\r\n        }\r\n        let i = queue.length;\r\n        while (i--) {\r\n            queue[i](payload);\r\n        }\r\n\r\n    }\r\n\r\n    on(event, callback)\r\n    {\r\n        if (typeof this.queue[event] === 'undefined') \r\n        {\r\n            this.queue[event] = [];\r\n        }\r\n\r\n        this.queue[event].push(callback);\r\n    }\r\n\r\n    fire_zoom_changed(zoom)\r\n    {\r\n        this.fire(this.zoom_changed_evt, zoom);\r\n    }\r\n    fire_store_selected(store_id)\r\n    {\r\n        this.fire(this.store_clickd_evt, store_id);\r\n    }\r\n    fire_point_selected(hit_data)\r\n    {\r\n        this.fire(this.point_selected_evt, hit_data);\r\n    }\r\n    fire_config_changed()\r\n    {\r\n        this.fire(this.config_changed);\r\n    }\r\n    fire_path_substep_completed(step_number)\r\n    {\r\n        this.fire(this.path_substep_completed, step_number);\r\n    }\r\n    fire_path_completed()\r\n    {\r\n        this.fire(this.path_completed);\r\n    }\r\n    fire_step_selected(step_index)\r\n    {\r\n        this.fire(this.step_selected_evt, step_index);\r\n    }\r\n\r\n    fire_go_to_store_requested(store_id)\r\n    {\r\n        this.fire(this.go_to_store_requested_evt, store_id);\r\n    }\r\n\r\n    fire_resource_loaded(resource)\r\n    {\r\n        this.fire(this.resource_loaded_evt, resource);\r\n    }\r\n\r\n    fire_service_clicked(service)\r\n    {\r\n        this.fire(this.service_clicked_evt, service);\r\n    }\r\n    fire_unit_position_updated(unit_data)\r\n    {\r\n        this.fire(this.unit_pos_updated_evt, unit_data);\r\n    }\r\n\r\n    fire_floor_switched(floor_id)\r\n    {\r\n        this.fire(this.floor_changed_evt, floor_id);\r\n    }\r\n\r\n    fire_on_enter_floor_navigation(state)\r\n    {\r\n        this.fire(this.on_enter_floor_navigation, state);\r\n    }\r\n\r\n    fire_on_exit_floor_navigation(state)\r\n    {\r\n        this.fire(this.on_exit_floor_navigation, state);\r\n    }\r\n\r\n    fire_on_enter_floor_selection(state)\r\n    {\r\n        this.fire(this.on_enter_floor_selection,state);\r\n    }\r\n\r\n    fire_on_exit_floor_selection(state)\r\n    {\r\n        this.fire(this.on_exit_floor_selection,state);\r\n    }\r\n    \r\n    fire_on_enter_outside_navigation(state)\r\n    {\r\n        this.fire(this.on_enter_outside_navigation,state);\r\n    }\r\n\r\n    fire_on_exit_outside_navigation(state)\r\n    {\r\n        this.fire(this.on_exit_outside_navigation,state);\r\n    }\r\n\r\n\r\n}\r\n\r\nconst event_manager = new EventManager();\r\nmodule.exports = event_manager;","export default class ImageUtilities {\r\n    constructor() { }\r\n\r\n    static get_image_data(image) {\r\n\r\n        var canvas = document.createElement('canvas');\r\n        canvas.width = image.width;\r\n        canvas.height = image.height;\r\n\r\n        var context = canvas.getContext('2d');\r\n        context.drawImage(image, 0, 0);\r\n\r\n        return context.getImageData(0, 0, image.width, image.height);\r\n    }\r\n    static get_pixel(imagedata, x, y) {\r\n\r\n        let position = (x + imagedata.width * y) * 4;\r\n        let data = imagedata.data;\r\n        return new THREE.Vector4(data[position + 0], data[position + 1], data[position + 2], data[position + 3]);\r\n    }\r\n\r\n}\r\n","export default class AbstractLoader\r\n{\r\n\tconstructor(resource_id, url, size = 0)\r\n\t{\r\n\t\tthis.progress = 0;\r\n\t\tthis.resource_id = resource_id;\r\n\t\tthis.url = url;\r\n\t\tthis.size = size;\r\n\r\n\t\tthis.has_finished = false;\r\n\t\tthis.has_error = false;\r\n\t\tthis.error_message = \"none\";\r\n\t}\r\n\r\n\t__update_progress(value)\r\n\t{\r\n\t\tthis.progress = value;\r\n\t}\r\n\t__loading_ended()\r\n\t{\r\n\t\tthis.has_finished = true;\r\n\t}\r\n\t__set_error(message)\r\n\t{\r\n\t\tthis.has_error = true;\r\n\t\tthis.error_message = message;\r\n\t}\r\n\r\n\tprint_error()\r\n\t{\r\n\t\tconsole.error(\"Error while loading \"+this.resource_id+\"\\n\\t path: \"+this.url+\"\\n\\t\\t\"+this.error_message);\r\n\t}\r\n\r\n\tload(resource_container) {\r\n\r\n\t}\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class JSONLoader extends AbstractLoader {\r\n\tconstructor(resource_id, url, size)\r\n\t{\r\n\t\tsuper(resource_id, url, size);\r\n\r\n\t\tthis.loader = new THREE.FileLoader();\r\n\r\n\t}\r\n\r\n\tload(resource_container) {\r\n\r\n\t\tlet ctx = this;\r\n\r\n\t\tthis.loader.load(this.url, (data) => {\r\n                resource_container.set_resource(ctx.resource_id, JSON.parse(data));\r\n                ctx.__update_progress(1);\r\n                ctx.__loading_ended()\r\n            },\r\n            (xhr) =>{\r\n                if (xhr) {\r\n                    let total = xhr.total || this.size;\r\n                    ctx.__update_progress(xhr.loaded / total);\r\n                }\r\n            },\r\n\t\t\t(msg) => {\r\n\t\t\t\tctx.__set_error(msg + \"\\n\\n\\t If the error says something about unexpected token < in JSON then the probably the problem is related to the file not being found. Check the name and path of the resource\");\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t}\r\n\r\n}\r\n","export class ModelUtilities\r\n{\r\n\r\n\tget_mesh(scene, result_callback)\r\n\t{\r\n\t\tscene.traverse((child)=>{\r\n\t\t\tif(child instanceof THREE.Mesh)\r\n\t\t\t{\r\n\t\t\t\tif(child.geometry instanceof THREE.Geometry)\r\n\t\t\t\t{\r\n\t\t\t\t\tchild.geometry = new THREE.BufferGeometry().fromGeometry(child.geometry);\r\n\t\t\t\t}\r\n\t\t\t\tresult_callback(child);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tget_geometries(scene)\r\n\t{\r\n\t\tlet geometries = [];\r\n\r\n\t\tthis.get_mesh(scene, (child)=>{\r\n\t\t\tgeometries.push(child.geometry);\r\n\t\t});\r\n\t\treturn geometries;\r\n\t}\r\n\r\n\r\n\tassign_material(scene, material, name)\r\n\t{\r\n\t\tscene.traverse((child) => {\r\n\t\t\tif(child instanceof THREE.Mesh)\r\n\t\t\t{\r\n\t\t\t\t// assign to all if no name is given\r\n\t\t\t\tif(name === undefined)\r\n\t\t\t\t\tchild.material = material;\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// if name is given, assign only to that\r\n\t\t\t\t\tif(child.name === name )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tchild.material = material;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tclone_animated_gltf(gltf)\r\n\t{\r\n\t\tconst clone = {\r\n\t\t\tanimations: gltf.animations,\r\n\t\t\tscene: gltf.scene.clone(true)\r\n\t\t};\r\n\r\n\t\tconst skinnedMeshes = {};\r\n\r\n\t\tgltf.scene.traverse(node => {\r\n\t\t\tif (node.isSkinnedMesh) {\r\n\t\t\t\tskinnedMeshes[node.name] = node;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst cloneBones = {};\r\n\t\tconst cloneSkinnedMeshes = {};\r\n\r\n\t\tclone.scene.traverse(node => {\r\n\t\t\tif (node.isBone) {\r\n\t\t\t\tcloneBones[node.name] = node;\r\n\t\t\t}\r\n\r\n\t\t\tif (node.isSkinnedMesh) {\r\n\t\t\t\tcloneSkinnedMeshes[node.name] = node;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfor (let name in skinnedMeshes) {\r\n\t\t\tconst skinnedMesh = skinnedMeshes[name];\r\n\t\t\tconst skeleton = skinnedMesh.skeleton;\r\n\t\t\tconst cloneSkinnedMesh = cloneSkinnedMeshes[name];\r\n\r\n\t\t\tconst orderedCloneBones = [];\r\n\r\n\t\t\tfor (let i = 0; i < skeleton.bones.length; ++i) {\r\n\t\t\t\tconst cloneBone = cloneBones[skeleton.bones[i].name];\r\n\t\t\t\torderedCloneBones.push(cloneBone);\r\n\t\t\t}\r\n\r\n\t\t\tcloneSkinnedMesh.bind(\r\n\t\t\t\tnew THREE.Skeleton(orderedCloneBones, skeleton.boneInverses),\r\n\t\t\t\tcloneSkinnedMesh.matrixWorld);\r\n\t\t}\r\n\r\n\t\treturn clone;\r\n\t}\r\n\r\n\tset_shadow_config(scene, cast, receive)\r\n\t{\r\n\t\tscene.traverse((child) => {\r\n\t\t\tif(child instanceof THREE.Mesh)\r\n\t\t\t{\r\n\t\t\t\tchild.castShadow = cast;\r\n\t\t\t\tchild.receiveShadow = receive;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t__find_object(scene, object_name, result_callback)\r\n\t{\r\n\r\n\t\tscene.traverse((obj)=>{\r\n\t\t\tif(obj.name === object_name)\r\n\t\t\t\tresult_callback(obj);\r\n\t\t});\r\n\t}\r\n\r\n\tget_object(scene, object_name)\r\n\t{\r\n\t\tlet object = undefined;\r\n\t\tscene.traverse((obj)=>{\r\n\t\t\tif(obj.name === object_name)\r\n\t\t\t\tobject = obj;\r\n\t\t});\r\n\t\treturn object;\r\n\t}\r\n\tget_object_by_type(scene, object_type)\r\n\t{\r\n\t\tlet object = undefined;\r\n\t\tscene.traverse((obj)=>{\r\n\t\t\tif(obj.constructor.name === object_type)\r\n\t\t\t\tobject = obj;\r\n\t\t});\r\n\t\treturn object;\r\n\t}\r\n\r\n}\r\n\r\nconst model_utilities = new ModelUtilities();\r\nmodule.exports = model_utilities;\r\n","class MeshSampler\r\n{\r\n  constructor()\r\n  {\r\n\r\n  }\r\n\r\n  sample(geometry, sample_count)\r\n  {\r\n    let face_areas = [];\r\n\r\n\r\n    let min_area = 99999999;\r\n    for(let i=0; i< geometry.faces.length; i++)\r\n    {\r\n        let area = this.get_face_area (geometry.faces[i], geometry.vertices);\r\n        min_area = Math.min(area, min_area);\r\n        face_areas.push(area);\r\n    }\r\n\r\n    let normalized_faces_array = this.get_uniform_face_distribution(face_areas, min_area, geometry.faces);\r\n    let selected_faces = this.select_random_faces(normalized_faces_array, sample_count);\r\n    let sampled_data = this.sample_data_from_faces(selected_faces, geometry.vertices);\r\n    return sampled_data;\r\n\r\n  }\r\n\r\n\r\n  sample_data_from_faces(faces, vertices)\r\n  {\r\n      let sampled_points = [];\r\n      let sampled_normals = [];\r\n      for(let i=0; i< faces.length; i++)\r\n      {\r\n          let face = faces[i];\r\n\r\n          let w1 = Math.random();\r\n          let w2 = Math.random();\r\n\r\n          sampled_points.push(this.sample_point_in_face(w1, w2, vertices[face.a], vertices[face.b], vertices[face.c]).clone());\r\n          if(sampled_normals && face.normal)\r\n            sampled_normals.push(face.normal.clone());\r\n      }\r\n      return {points: sampled_points, normals: sampled_normals};\r\n  }\r\n\r\n  select_random_faces(faces, amount)\r\n  {\r\n    let selected_faces = [];\r\n    for(let i=0; i< amount; i++)\r\n    {\r\n      let random = parseInt(Math.random() * (faces.length-1));\r\n      let selected_face = faces[random];\r\n\r\n      selected_faces.push(selected_face);\r\n    }\r\n\r\n    return selected_faces;\r\n  }\r\n\r\n  get_uniform_face_distribution(face_areas, minimum_area, faces)\r\n  {\r\n      let extended_triangle_indices = [];\r\n      for(let i=0; i< face_areas.length; i++)\r\n      {\r\n          face_areas[i] /= minimum_area;\r\n          let repetitions_needed = parseInt(Math.round(face_areas[i]));\r\n          for(let j=0; j< repetitions_needed; j++)\r\n          {\r\n              extended_triangle_indices.push(faces[i]);\r\n          }\r\n      }\r\n      return extended_triangle_indices;\r\n  }\r\n\r\n  get_face_area(face, vertices)\r\n  {\r\n    let v1 = vertices[face.a].clone();\r\n    let v2 = vertices[face.b].clone();\r\n    let v3 = vertices[face.c].clone();\r\n\r\n    let vec1 = v2.clone().sub(v1);\r\n    let vec2 = v3.clone().sub(v1);\r\n    return vec1.cross(vec2).length()/2;\r\n  }\r\n\r\n  sample_point_in_face( w1, w2, v1, v2, v3)\r\n  {\r\n      if(w1+w2 > 1)\r\n      {\r\n          w1 = 1.0 - w1;\r\n          w2 = 1.0 - w2;\r\n      }\r\n\r\n      let w3 = 1.0 - (w1+w2);\r\n\r\n      return v1.clone().multiplyScalar(w1).add(v2.clone().multiplyScalar(w2)).add(v3.clone().multiplyScalar(w3));\r\n  }\r\n}\r\n\r\nconst mesh_sampler = new MeshSampler();\r\nmodule.exports = mesh_sampler;\r\n","import EventManager from '/EventManager';\r\n\r\nclass ResourceContainer\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.resources = {};\r\n\t}\r\n\r\n\tset_resource(name, resource)\r\n\t{\r\n\t\tthis.resources[name] = resource;\r\n\t\tEventManager.fire_resource_loaded({name: name, value: resource});\r\n\t}\r\n\r\n\tget_resource(name)\r\n\t{\r\n\t\treturn this.resources[name];\r\n\t}\r\n\tget(name)\r\n\t{\r\n\t\treturn this.resources[name];\r\n\t}\r\n\r\n}\r\n\r\nconst resource_container = new ResourceContainer();\r\nmodule.exports = resource_container;\r\n","module.exports=\"#define GLSLIFY 1\\nuniform sampler2D _MainTex;\\nuniform mat4 _InverseProjMatrix;\\n\\nuniform float _Bias;\\nuniform float _Radius;\\n\\nuniform vec2 _Resolution;\\nuniform float _FarPlane;\\n\\nvarying vec2 vUv;\\nvarying vec4 vRay;\\n\\nuniform vec3 _SampleKernel[64];\\nuniform sampler2D _RandomRotation;\\nuniform mat4 _ProjectionMatrix;\\n\\nvec3 decode_normal (vec4 enc)\\n{\\n    float scale = 1.7777;\\n    vec3 nn =\\n        enc.xyz*vec3(2.0*scale,2.0*scale,0.0) +\\n        vec3(-scale,-scale,1.0);\\n    float g = 2.0 / dot(nn.xyz,nn.xyz);\\n    vec3 n;\\n    n.xy = g*nn.xy;\\n    n.z = g-1.0;\\n    return n;\\n}\\n\\nfloat DecodeFloatRG( vec2 enc )\\n{\\n    vec2 kDecodeDot = vec2(1.0, 1.0/255.0);\\n    return dot( enc, kDecodeDot );\\n}\\n\\nvec3 DecodeNormal(vec2 uv)\\n{\\n  vec2 encoded_normal = texture2D(_MainTex, uv).zw;\\n  vec3 normalValue = normalize(decode_normal(vec4(encoded_normal, 0., 0.)));\\n  return normalize(normalValue);\\n}\\nvec3 DecodeViewPos(vec2 uv)\\n{\\n  vec2 depth = texture2D(_MainTex, uv).xy;\\n  vec4 inv_proj = _InverseProjMatrix * vec4(vUv * 2.0 - 1.0, 1.0, 1.0);\\n  return DecodeFloatRG(depth) * (vRay.xyz/vRay.w);\\n  \\n}\\n\\nvoid main()\\n{\\n\\n  vec2 noiseScale = vec2(_Resolution.x/4.0,_Resolution.y/4.0); // noise texture 4x4\\n\\n  vec3 fragPos   = DecodeViewPos(vUv);\\n  vec3 normal    = DecodeNormal(vUv);\\n  vec3 randomVec = texture2D(_RandomRotation, vUv * noiseScale).xyz;\\n  randomVec = vec3(randomVec.xy * 2.0 - 1.0, 0);\\n  randomVec = normalize(randomVec);\\n\\n  vec3 tangent   = normalize(randomVec - normal * dot(randomVec, normal));\\n  vec3 bitangent = normalize(cross(normal, tangent));\\n  mat3 TBN       = mat3(tangent, bitangent, normal); \\n\\n  float occlusion = 0.0;\\n  const int kernelSize = 64;\\n\\n  for(int i = 0; i < kernelSize; ++i)\\n  {\\n      // get sample position\\n      vec3 sample = TBN * _SampleKernel[i]; // From tangent to view-space\\n      sample = fragPos + sample * _Radius; \\n      vec4 projPos = _ProjectionMatrix * vec4(sample, 1.0);\\n      vec2 screenPos = projPos.xy / projPos.w;\\n      screenPos = screenPos * 0.5 +0.5;\\n\\n      float sampled_depth = DecodeViewPos(screenPos).z;\\n      float rangeCheck = smoothstep(0.0, 1.0, _Radius / abs(fragPos.z - sampled_depth));\\n      occlusion += step(sample.z+_Bias, sampled_depth) * rangeCheck;         \\n      \\n  } \\n  occlusion = (occlusion / float(kernelSize));\\n  gl_FragColor.rgb = vec3(occlusion,occlusion,occlusion); \\n  gl_FragColor.a = 1.0; \\n\\n}\\n\";","module.exports=\"#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec4 vRay;\\n\\nuniform mat4 _InverseProjMatrix;\\n\\nvoid main()\\n{\\n\\tgl_Position = vec4(uv * 2.0 - 1.0, 1.0, 1.0);\\n\\tvRay = _InverseProjMatrix * vec4(uv * 2.0 - 1.0, 1.0, 1.0);\\n\\tvUv = uv;\\n}\";","import BlitMaterial from '/materials/BlitMaterial';\r\nimport frag from '/shaders/ssao/ssao_frag';\r\nimport vert from '/shaders/ssao/ssao_vert';\r\nimport Sphere from '/primitives/Sphere';\r\nimport SceneManager from '/SceneManager';\r\n\r\nexport default class SSAOMaterial extends BlitMaterial\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper(frag, vert);\r\n\r\n\t\tthis.uniforms._InverseProjMatrix \t= { value: new THREE.Matrix4()};\r\n\t\tthis.uniforms._ProjectionMatrix \t= { value: new THREE.Matrix4()};\r\n\r\n\t\tthis.uniforms._Bias \t\t\t\t\t= { value: 0.0125};\r\n\t\tthis.uniforms._Radius \t\t\t\t= { value: 0.3\t};\r\n\t\tthis.uniforms._FarPlane\t\t\t\t= {value: 100};\r\n\r\n\r\n\t\tthis.uniforms._SampleKernel = {value: this.__get_sample_kernel()};\r\n\t\tthis.uniforms._RandomRotation = {value: this.__get_rotation_kernel()};\r\n\r\n\t}\r\n\r\n\r\n\t__get_sample_kernel()\r\n\t{\r\n\t\tlet sample_kernel = [];\r\n\t\tlet kernel_size = 64;\r\n\r\n\t\tfor(let i=0; i< kernel_size; i++)\r\n\t\t{\r\n\t\t\tlet dir = new THREE.Vector3(Math.random() * 2 -1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tMath.random() * 2 -1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tMath.random());\r\n\t\t\tdir.normalize();\r\n\t\t\tlet scale = i / kernel_size;\r\n\t\t\tscale   = THREE.Math.lerp(0.1, 1.0, scale * scale);\r\n\t\t\tdir.multiplyScalar(scale);\r\n\r\n   \t\tsample_kernel.push(dir);\r\n\t\t}\r\n\t\treturn sample_kernel;\r\n\r\n\t}\r\n\t__get_rotation_kernel()\r\n\t{\r\n\t\tlet rotation_kernel = new Uint8Array( 3 * 16 );\r\n\t\tfor(let i=0; i< 16; i++)\r\n\t\t{\r\n\t\t\trotation_kernel[i*3+1] = Math.floor(Math.random() * 255);\r\n\t\t\trotation_kernel[i*3+2] = Math.floor(Math.random() * 255);\r\n\t\t\trotation_kernel[i*3+3] = 0;\r\n\r\n\t\t}\r\n\r\n\t\tlet rotation_texture = new THREE.DataTexture( rotation_kernel, 4, 4, THREE.RGBFormat );\r\n\t\trotation_texture.wrapS = THREE.RepeatWrapping;\r\n\t\trotation_texture.wrapT = THREE.RepeatWrapping;\r\n\r\n\t\trotation_texture.needsUpdate = true;\r\n\t\treturn rotation_texture;\r\n\t}\r\n\r\n}\r\n","module.exports=\"#define GLSLIFY 1\\nuniform sampler2D _MainTex;\\nuniform sampler2D _AO;\\nuniform vec2 _Resolution;\\nuniform vec2 _SampleDir;\\nvarying vec2 vUv;\\n\\nvoid main()\\n{\\n\\n  gl_FragColor.rgb = texture2D(_MainTex, vUv).rgb * (1.0 - texture2D(_AO, vUv).r);\\n  gl_FragColor.a = 1.0;\\n\\n}\\n\";","import BlitMaterial from '/materials/BlitMaterial';\r\nimport frag from '/shaders/ssao/ssao_compose_frag';\r\n\r\nexport default class SSAOComposeMaterial extends BlitMaterial\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper(frag);\r\n\t\tthis.uniforms._AO = {value: undefined};\r\n\t}\r\n\r\n}\r\n","module.exports=\"#define GLSLIFY 1\\nuniform sampler2D _MainTex;\\nuniform vec2 _Resolution;\\nuniform float _FarPlane;\\n\\nvarying vec2 vUv;\\nvarying vec4 vRay;\\n\\nvec3 decode_normal (vec4 enc)\\n{\\n    float scale = 1.7777;\\n    vec3 nn =\\n        enc.xyz*vec3(2.0*scale,2.0*scale,0.0) +\\n        vec3(-scale,-scale,1.0);\\n    float g = 2.0 / dot(nn.xyz,nn.xyz);\\n    vec3 n;\\n    n.xy = g*nn.xy;\\n    n.z = g-1.0;\\n    return n;\\n}\\n\\nfloat DecodeFloatRG( vec2 enc )\\n{\\n    vec2 kDecodeDot = vec2(1.0, 1.0/255.0);\\n    return dot( enc, kDecodeDot );\\n}\\n\\nvec3 DecodeNormal(vec2 uv)\\n{\\n  vec4 depthNormal = texture2D(_MainTex, uv);\\n  vec3 normalValue = normalize(decode_normal(vec4(depthNormal.zw, 0., 0.)));\\n  return normalize(normalValue);\\n}\\nvec3 DecodeViewPos(vec2 uv)\\n{\\n  vec2 depth = texture2D(_MainTex, uv).xy;\\n  return DecodeFloatRG(depth) * (vRay.xyz/vRay.w);\\n}\\n\\nvoid main()\\n{\\n    vec3 viewPos = DecodeViewPos(vUv);\\n    vec3 normalValue = DecodeNormal(vUv);\\n\\n    float vDepth = clamp(0.0, 1.0, length(viewPos)/_FarPlane);\\n    vDepth = length(viewPos)/_FarPlane;\\n    // gl_FragColor = vec4(normalValue*0.5+0.5, 1.0);\\n    gl_FragColor = vec4(vDepth,vDepth,vDepth, 1.0);\\n}\";","import BlitMaterial from '/materials/BlitMaterial';\r\nimport frag from '/shaders/depth_normals/debug_normals_frag';\r\nimport depth_normals_vert from '/shaders/ssao/ssao_vert';\r\n\r\nexport default class DisplayNormalTextureMaterial extends BlitMaterial\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper(frag, depth_normals_vert);\r\n\t\tthis.uniforms._FarPlane\t\t\t\t\t\t= { value: 1};\r\n\t\tthis.uniforms._InverseProjMatrix\t= { value: new THREE.Matrix4()};\r\n\t}\r\n\r\n}\r\n","import BlitMaterial from '/materials/BlitMaterial';\r\nimport frag from '/shaders/box_blur/box_blur_frag';\r\n\r\nexport default class BoxBlurMaterial extends BlitMaterial\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper(frag);\r\n\t\tthis.uniforms._SampleDir = { value: new THREE.Vector2()};\r\n\t}\r\n\r\n}\r\n","import BoxBlurMaterial from '/materials/BoxBlurMaterial';\r\nimport Graphics from '/Graphics';\r\n\r\nexport default class Blurrer\r\n{\r\n\r\n  constructor(renderer)\r\n  {\r\n    this.RT1 = new THREE.WebGLRenderTarget(1,1);\r\n    this.RT2 = new THREE.WebGLRenderTarget(1,1);\r\n    this.box_blur_mat = new BoxBlurMaterial();\r\n  }\r\n\r\n\r\n  blur(RT)\r\n  {\r\n    if(RT.width !== this.RT1.width || RT.height !== this.RT1.height)\r\n    {\r\n      this.RT1.setSize(RT.width, RT.height);\r\n      this.RT2.setSize(RT.width, RT.height);\r\n    }\r\n\r\n    this.box_blur_mat.uniforms._SampleDir.value.set(1,0);\r\n    Graphics.blit(RT, this.RT1, this.box_blur_mat);\r\n    this.box_blur_mat.uniforms._SampleDir.value.set(0,1);\r\n    Graphics.blit(this.RT1, RT, this.box_blur_mat);\r\n    // return this.RT2;\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n}\r\n","import CameraManager from '/CameraManager';\r\nimport SceneManager from '/SceneManager';\r\nimport Screen from '/Screen';\r\nimport BaseRender from '/render_mode/BaseRender';\r\nimport ResourceContainer from '/ResourceContainer';\r\nimport Configuration from '/Configuration';\r\nimport SSAOMaterial from '/materials/SSAOMaterial';\r\nimport SSAOComposeMaterial from '/materials/SSAOComposeMaterial';\r\nimport DisplayNormalTextureMaterial from '/materials/DisplayNormalTextureMaterial';\r\nimport Blurrer from '/render_utilities/Blurrer';\r\nimport Graphics from '/Graphics';\r\n\r\n\r\nexport default class NormalAORender extends BaseRender\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.ssao_mat = new SSAOMaterial();\r\n\t\tthis.ssao_compose_mat = new SSAOComposeMaterial();\r\n\t\tthis.debug_normals = new DisplayNormalTextureMaterial();\r\n\r\n\r\n\t\tthis.ssaa = Configuration.use_ssaa? 2 : 1;\r\n\r\n\t\tthis.main_RT = new THREE.WebGLRenderTarget(Screen.width * this.ssaa, Screen.height * this.ssaa);\r\n\r\n\t\tthis.SSAO_RT = new THREE.WebGLRenderTarget(Screen.width, Screen.height);\r\n\r\n\t\tthis.blurrer = new Blurrer();\r\n\t\tGraphics.generateDepthNormalTexture = true;\r\n\r\n\r\n\t}\r\n\r\n\r\n\trender()\r\n\t{\r\n\r\n\t\t\tthis.__check_RT_size();\r\n\r\n\t\t\tGraphics.clear(this.main_RT, CameraManager.current, true, false);\r\n\t\t\tGraphics.render(SceneManager.current, CameraManager.current, this.main_RT);\r\n\r\n\t\t\tthis.__update_uniforms();\r\n\r\n\r\n\t\t\tGraphics.blit(Graphics.depth_normals_RT, this.SSAO_RT, this.ssao_mat);\r\n\r\n\t\t\t// // BLUR\r\n\t\t\tthis.blurrer.blur(this.SSAO_RT);\r\n\t\t\tGraphics.blit(this.SSAO_RT, undefined);\r\n\r\n\t\t\t// // COMPOSE\r\n\t\t\tthis.ssao_compose_mat.uniforms._AO.value = this.SSAO_RT.texture;\r\n\t\t\tGraphics.blit(this.main_RT, undefined, this.ssao_compose_mat);\r\n\r\n\r\n\t\t\t// Graphics.blit(this.SSAO_RT, undefined);\r\n\t}\r\n\r\n\t__update_uniforms()\r\n\t{\r\n\t\tthis.ssao_mat.uniforms._InverseProjMatrix.value.getInverse(CameraManager.current.projectionMatrix);\r\n\t\tthis.ssao_mat.uniforms._ProjectionMatrix.value.copy(CameraManager.current.projectionMatrix);\r\n\t\tthis.ssao_mat.uniforms._FarPlane.value \t\t\t= CameraManager.current.far;\r\n\t}\r\n\r\n\t__check_RT_size()\r\n\t{\r\n\t\tif(this.main_RT.width !== Screen.width * this.ssaa || this.main_RT.height !== Screen.height * this.ssaa)\r\n\t\t{\r\n\t\t\tthis.main_RT.setSize(Screen.width * this.ssaa, Screen.height * this.ssaa);\r\n\t\t\tthis.SSAO_RT.setSize(Screen.width, Screen.height);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","import CameraManager from '/CameraManager';\r\nimport SceneManager from '/SceneManager';\r\nimport Screen from '/Screen';\r\nimport BaseRender from '/render_mode/BaseRender';\r\nimport Graphics from '/Graphics';\r\n\r\nexport default class NormalRender extends BaseRender\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\trender()\r\n\t{\r\n\t\tGraphics.clear(undefined, CameraManager.current, true, true);\r\n\r\n\t\tGraphics.render(SceneManager.current, CameraManager.current);\r\n\t}\r\n\r\n}\r\n","export default class ObjectUtilities\r\n{\r\n\tconstructor(){}\r\n\r\n  // Changes XML to JSON\r\n  static xml_to_json(xml) {\r\n\r\n    // Create the return object\r\n    var obj = {};\r\n\r\n    if (xml.nodeType == 1) { // element\r\n      // do attributes\r\n      if (xml.attributes.length > 0) {\r\n        obj[\"@attributes\"] = {};\r\n        for (var j = 0; j < xml.attributes.length; j++) {\r\n          var attribute = xml.attributes.item(j);\r\n          obj[\"@attributes\"][attribute.nodeName] = attribute.nodeValue;\r\n        }\r\n      }\r\n    } else if (xml.nodeType == 3) { // text\r\n      obj = xml.nodeValue;\r\n    }\r\n\r\n    // do children\r\n    if (xml.hasChildNodes()) {\r\n      for (var i = 0; i < xml.childNodes.length; i++) {\r\n        var item = xml.childNodes.item(i);\r\n        var nodeName = item.nodeName;\r\n        if (typeof (obj[nodeName]) == \"undefined\") {\r\n          obj[nodeName] = this.xml_to_json(item);\r\n        } else {\r\n          if (typeof (obj[nodeName].push) == \"undefined\") {\r\n            var old = obj[nodeName];\r\n            obj[nodeName] = [];\r\n            obj[nodeName].push(old);\r\n          }\r\n          obj[nodeName].push(this.xml_to_json(item));\r\n        }\r\n      }\r\n    }\r\n    return obj;\r\n  };\r\n\r\n}\r\n\r\n","export default class PerspectiveCamera extends THREE.PerspectiveCamera\r\n{\r\n\tconstructor(fov, aspect, near, far)\r\n\t{\r\n\t\tsuper(fov, aspect, near, far);\r\n\r\n\t\tthis.clear_color = new THREE.Color(\"#000000\");\r\n\t\tthis.clear_alpha = 1;\r\n\t}\r\n}","export default class GeometryBatch\r\n{\r\n\tconstructor(geometry, batch_width)\r\n\t{\r\n\t\tthis.geometry = geometry;\r\n\r\n\t\tthis.material = undefined;\r\n\t\tthis.uniforms = {};\r\n\t\tthis.batch_width = batch_width;\r\n\r\n\t\tthis.data_textures = [];\r\n\r\n\t\tthis.object_names = undefined;\r\n\r\n\r\n\t\tthis.zero_offset = new THREE.Vector2();\r\n\t\tthis.write_offset = new THREE.Vector2();\r\n\r\n\t\tthis.uniform_dirty_count = 0;\r\n\r\n\t\tthis.tmp_uploaded_data_count = 0;\r\n\r\n\t}\r\n\r\n\tinit(object_names, vert_shader, frag_shader)\r\n\t{\r\n\t\tthis.material = new THREE.ShaderMaterial({\r\n\t\t\tuniforms: this.uniforms,\r\n\t\t\tvertexShader: vert_shader,\r\n\t\t\tfragmentShader: frag_shader\r\n\t\t});\r\n\t\tthis.object_names = object_names;\r\n\r\n\t}\r\n\r\n\tadd_global_uniform(name, data)\r\n\t{\r\n\t\tthis.uniforms[name] = {value: data};\r\n\t\tthis.material.needsUpdate = true;\r\n\t}\r\n\tset_global_uniform(name, data)\r\n\t{\r\n\t\tthis.uniforms[name].value = data;\r\n\t}\r\n\r\n\tadd_object_uniform_v3(uniform_name, default_value_v3)\r\n\t{\r\n\t\tlet src_tex \t\t= this.__create_rgb_texture(this.batch_width);\r\n\t\tlet dst_tex \t\t= this.__create_rgb_texture(this.batch_width);\r\n\t\tlet one_pixel_tex = this.__create_rgb_texture(1);\r\n\r\n\r\n\t\tlet new_data_tex = this.__add_data_texture(uniform_name, src_tex, dst_tex, one_pixel_tex);\r\n\r\n\t\tif(default_value_v3)\r\n\t\t\tthis.__flood_data_texture_rgb(new_data_tex, default_value_v3);\r\n\t\r\n\t}\r\n\r\n\tadd_object_uniform_v4(uniform_name, default_value_v4)\r\n\t{\r\n\t\tlet src_tex \t\t= this.__create_rgba_texture(this.batch_width);\r\n\t\tlet dst_tex \t\t= this.__create_rgba_texture(this.batch_width);\r\n\t\tlet one_pixel_tex = this.__create_rgba_texture(1);\r\n\r\n\r\n\t\tlet new_data_tex = this.__add_data_texture(uniform_name, src_tex, dst_tex, one_pixel_tex);\r\n\r\n\t\tif(default_value_v4)\r\n\t\t\tthis.__flood_data_texture_rgba(new_data_tex, default_value_v4);\r\n\t\r\n\t}\r\n\r\n\tadd_object_uniform_v4_float(uniform_name, default_value_v4)\r\n\t{\r\n\t\tlet src_tex \t\t= this.__create_rgba_float_texture(this.batch_width);\r\n\t\tlet dst_tex \t\t= this.__create_rgba_float_texture(this.batch_width);\r\n\t\tlet one_pixel_tex = this.__create_rgba_float_texture(1);\r\n\r\n\r\n\t\tlet new_data_tex = this.__add_data_texture(uniform_name, src_tex, dst_tex, one_pixel_tex);\r\n\r\n\t\tif(default_value_v4)\r\n\t\t\tthis.__flood_data_texture_rgba(new_data_tex, default_value_v4);\r\n\t\r\n\t}\r\n\r\n\tset_object_uniform_v3(object_name, uniform_name, vector3, use_r, use_g, use_b)\r\n\t{\r\n\t\tlet obj_index = this.__get_object_index(object_name);\r\n\t\tlet data_texture = this.__get_data_texture(uniform_name);\r\n\r\n\t\tthis.__set_pixel_rgb(data_texture.src, obj_index, vector3, use_r, use_g, use_b);\r\n\t\tthis.__set_pixel_rgb(data_texture.one_pixel, 0\t, vector3, use_r, use_g, use_b);\r\n\r\n\t\tdata_texture.last_accessed_index = obj_index;\r\n\r\n\t\tdata_texture.dirty_count++; \r\n\t}\r\n\r\n\tset_object_uniform_v4(object_name, uniform_name, vector4, use_r, use_g, use_b, use_a)\r\n\t{\r\n\t\tlet obj_index = this.__get_object_index(object_name);\r\n\t\tlet data_texture = this.__get_data_texture(uniform_name);\r\n\r\n\t\tthis.__set_pixel_rgba(data_texture.src, obj_index, vector4, use_r, use_g, use_b, use_a);\r\n\t\tthis.__set_pixel_rgba(data_texture.one_pixel, 0, vector4, use_r, use_g, use_b, use_a);\r\n\t\tdata_texture.last_accessed_index = obj_index;\r\n\r\n\t\tdata_texture.dirty_count++; \r\n\t}\r\n\r\n\r\n\tupload_texture_data(renderer, upload_budget)\r\n\t{\r\n\t\tfor(let i=0; i< this.data_textures.length; i++)\r\n\t\t{\r\n\t\t\tif(upload_budget > 0 && this.data_textures[i].dirty_count > 0)\r\n\t\t\t{\r\n\t\t\t\tif(this.data_textures[i].dirty_count === 1)\r\n\t\t\t\t\tthis.__partial_texture_data_upload(renderer, this.data_textures[i]);\r\n\t\t\t\tif(this.data_textures[i].dirty_count > 1)\r\n\t\t\t\t\tthis.__full_texture_data_upload(renderer, this.data_textures[i]);\r\n\r\n\t\t\t\tthis.data_textures[i].dirty_count = 0;\r\n\r\n\t\t\t\tupload_budget--;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tget_uniform_dirty_count()\r\n\t{\r\n\t\tthis.uniform_dirty_count = 0;\r\n\t\tfor(let i=0; i< this.data_textures.length; i++)\r\n\t\t{\r\n\t\t\tif(this.data_textures[i].dirty_count > 0)\r\n\t\t\t\tthis.uniform_dirty_count++;\r\n\t\t}\r\n\t\treturn this.uniform_dirty_count;\r\n\t}\r\n\r\n\r\n\t__full_texture_data_upload(renderer, texture_data)\r\n\t{\r\n\t\t// console.log(\"full texture update of\"+ texture_data.name);\r\n\t\ttexture_data.dst.needsUpdate = true;\r\n\t\trenderer.copyTextureToTexture(\r\n\t\t\t\t\tthis.zero_offset, \r\n\t\t\t\t\ttexture_data.src, \r\n\t\t\t\t\ttexture_data.dst\r\n\t\t\t);\r\n\t}\r\n\t__partial_texture_data_upload(renderer, texture_data)\r\n\t{\r\n\t\t// console.log(\"partial texture update\"+ texture_data.name);\r\n\t\tlet index = texture_data.last_accessed_index;\r\n\t\tif(index === -1)\r\n\t\t\treturn;\r\n\t\t\r\n  \tthis.write_offset.y = Math.floor(index/this.batch_width);\r\n  \tthis.write_offset.x = index - this.batch_width*this.write_offset.y;\r\n\t\trenderer.copyTextureToTexture(\r\n\t\t\tthis.write_offset, \r\n\t\t\ttexture_data.one_pixel, \r\n\t\t\ttexture_data.dst\r\n\t\t);\r\n\t}\r\n\r\n\tget_mesh()\r\n\t{\r\n\t\treturn new THREE.Mesh(this.geometry, this.material);\r\n\t}\r\n\r\n\t__set_pixel_rgb(data_texture, index, vector3, use_r, use_g, use_b)\r\n\t{\r\n\t\tif(use_r)\r\n\t\t\tdata_texture.image.data[index*3+0] = vector3.x;\t    \r\n\t\tif(use_g)\r\n\t\t\tdata_texture.image.data[index*3+1] = vector3.y;\t    \r\n\t\tif(use_b)\r\n\t\t\tdata_texture.image.data[index*3+2] = vector3.z;\t\r\n\t}\r\n\t__set_pixel_rgba(data_texture, index, vector4, use_r, use_g, use_b, use_a)\r\n\t{\r\n\t\tif(use_r)\r\n\t\t\tdata_texture.image.data[index*4+0] = vector4.x;\t    \r\n\t\tif(use_g)\r\n\t\t\tdata_texture.image.data[index*4+1] = vector4.y;\t    \r\n\t\tif(use_b)\r\n\t\t\tdata_texture.image.data[index*4+2] = vector4.z;\t\r\n\t\tif(use_a)\r\n\t\t\tdata_texture.image.data[index*4+3] = vector4.w;\r\n\t}\r\n\r\n\t__flood_data_texture_rgb(data_texture, v3)\r\n\t{\r\n\t\tfor(let i=0; i< this.batch_width * this.batch_width; i++)\r\n\t\t{\r\n\t\t\tthis.__set_pixel_rgb(data_texture.src, i, v3, true, true, true);\r\n\t\t\tdata_texture.dirty_count++;\r\n\t\t}\r\n\t}\r\n\r\n\t__flood_data_texture_rgba(data_texture, v4)\r\n\t{\r\n\t\tfor(let i=0; i< this.batch_width * this.batch_width; i++)\r\n\t\t{\r\n\t\t\tthis.__set_pixel_rgba(data_texture.src, i, v4, true, true, true, true);\r\n\t\t\tdata_texture.dirty_count++;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t__create_rgb_texture(width)\r\n\t{\r\n\t\tlet data = new Uint8Array( 3 * width * width );\r\n\t\treturn new THREE.DataTexture( data, width, width, THREE.RGBFormat );\r\n\t}\r\n\t__create_rgba_texture(width)\r\n\t{\r\n\t\tlet data = new Uint8Array( 4 * width * width );\r\n\t\treturn new THREE.DataTexture( data, width, width, THREE.RGBAFormat );\r\n\t}\r\n\r\n\t__create_rgba_float_texture(width)\r\n\t{\r\n\t\tlet data = new Float32Array( 4 * width * width );\r\n\t\treturn new THREE.DataTexture( data, width, width, THREE.RGBA, THREE.FloatType );\r\n\t}\r\n\r\n\t__get_data_texture(uniform_name)\r\n\t{\r\n\t\tfor(let i=0; i< this.data_textures.length; i++)\r\n\t\t{\r\n\t\t\tif(this.data_textures[i].name === uniform_name)\r\n\t\t\t\treturn this.data_textures[i];\r\n\t\t}\r\n\t\tconosle.error(\"Data texture \"+uniform_name+\" does not exist\");\r\n\t\treturn undefined;\r\n\t}\r\n\t__get_object_index(name)\r\n\t{\r\n\t\tfor(let i=0; i< this.object_names.length; i++)\r\n\t\t{\r\n\t\t\tif(this.object_names[i] === name)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t\tconsole.error(\"the name \"+name+\" is not contained in this batch\");\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\t__add_data_texture(uniform_name, src_texture, dst_texture, one_pixel_text)\r\n\t{\r\n\t\tdst_texture.needsUpdate = true;\r\n\r\n\t\tthis.data_textures.push({\r\n\t\t\tname: uniform_name,\r\n\t\t\tsrc: src_texture, \r\n\t\t\tdst: dst_texture,\r\n\t\t\tone_pixel: one_pixel_text,\r\n\t\t\tlast_accessed_index: -1,\r\n\t\t\tdirty_count: 0\r\n\t\t});\r\n\r\n\t\tthis.uniforms[uniform_name] = {value: dst_texture};\r\n\t\treturn this.data_textures[this.data_textures.length-1];\r\n\t}\r\n\r\n\tdispose()\r\n\t{\r\n\t\tfor(let i=0; i< this.data_textures.length; i++)\r\n\t\t{\r\n\t\t\tthis.data_textures[i].src.dispose();\r\n\t\t\tthis.data_textures[i].dst.dispose();\r\n\t\t\tthis.data_textures[i].one_pixel.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\t\r\n}","import GeometryBatch from '/static_batcher/GeometryBatch'\r\n\r\nclass GeometryBatcher\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.batches = [];\r\n\t}\r\n\r\n\tbatch(buffer_geometries)\r\n\t{\r\n\t  let attr_accessor_uvs = [];\r\n\t  let texture_width = THREE.Math.ceilPowerOfTwo(Math.sqrt(buffer_geometries.length));\r\n\t  // console.log(\"Store count: \" + buffer_geometries.length + \", Texture size: \" +texture_width);\r\n\r\n\t  this.__init_uv_array(attr_accessor_uvs, texture_width);\r\n\r\n\r\n\t  let uv_index = 0;\r\n\r\n\t  for(let i=0; i< buffer_geometries.length; i++)\r\n\t  {\r\n\t    let vertex_count = buffer_geometries[i].getAttribute('position').count;\r\n\t    let y = Math.floor(i/texture_width);\r\n\t    let x = i - texture_width*y;\r\n\t    for(let count = 0; count < vertex_count; count++)\r\n\t    {\r\n\r\n\t      attr_accessor_uvs[uv_index] = (x/texture_width) + 0.5/texture_width;\r\n\t      attr_accessor_uvs[uv_index+1] = (y/texture_width) + 0.5/texture_width;\r\n\t      uv_index+=2;\r\n\t    }\r\n\t  }\r\n\r\n\t  let buffer_attribute = new THREE.BufferAttribute( new Float32Array( attr_accessor_uvs ), 2);\r\n\t  let buffer_geometry = THREE.BufferGeometryUtils.mergeBufferGeometries(buffer_geometries);\r\n\t  buffer_geometry.setAttribute( 'attr_accessor_uv', buffer_attribute);\r\n\r\n\t  this.batches.push(new GeometryBatch(buffer_geometry, texture_width));\r\n\t  return this.batches[this.batches.length-1];\r\n\r\n\t}\r\n\r\n\tupload_texture_data(renderer)\r\n\t{\r\n\t\tfor(let i=0; i< this.batches.length; i++)\r\n\t\t{\r\n\t\t\tthis.batches[i].upload_texture_data(renderer, 1);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t__init_uv_array(uvs, texture_width)\r\n\t{\r\n\t\tfor(let i=0; i< texture_width*texture_width*2; i++)\r\n\t  {\r\n\t    uvs.push(0);\r\n\t  }\r\n\t}\r\n}\r\n\r\n\r\nconst geometry_batcher = new GeometryBatcher();\r\nmodule.exports = geometry_batcher;\r\n","import Time from '/Time';\r\nimport Input from '/Input';\r\nimport UI from '/UI';\r\nimport Debug from '/Debug';\r\nimport GeometryBatcher from '/static_batcher/GeometryBatcher';\r\nimport BaseApplication from '/BaseApplication';\r\n\r\nexport default class RenderLoop {\r\n\r\n  constructor(target_application, renderer) {\r\n\r\n    target_application = target_application || new BaseApplication();\r\n\r\n    this._frame_id = -1;\r\n\r\n    this.target_application = target_application;\r\n    this.renderer = renderer;\r\n\r\n    this.is_running = true;\r\n    this.frames_passed = 0;\r\n\r\n  }\r\n\r\n  update() {\r\n\r\n    if(!this.is_running)\r\n      return;\r\n\r\n    Time.__update();\r\n    Debug.clear();\r\n\r\n    //###### START CYCLE ######\r\n    if (this.frames_passed === 5) {\r\n      this.target_application.post_start();\r\n    }\r\n\r\n    this.target_application.update();\r\n\r\n    this.target_application.on_pre_render();\r\n\r\n    this.renderer.update();     // render scene\r\n    UI.update();                // update after new camera matrix has been calculated\r\n    UI.render(this.renderer);   // render ui layer on top\r\n\r\n    this.target_application.on_post_render();\r\n\r\n    if(Debug.rt_debug)\r\n      this.renderer.blit(Debug.rt_debug);\r\n    //###### END  CYCLE #######\r\n    Input.clear();\r\n    UI.clear();\r\n\r\n    //   GeometryBatcher.upload_texture_data(this.renderer);\r\n\r\n    this._frame_id = requestAnimationFrame(this.update.bind(this));\r\n    this.frames_passed++;\r\n  }\r\n\r\n  start() {\r\n    this.target_application.start();\r\n    this.update();\r\n    this.is_running = true;\r\n\r\n\r\n  }\r\n\r\n  stop() {\r\n    this.is_running = false;\r\n    this.target_application.end();\r\n\r\n    cancelAnimationFrame(this._frame_id);\r\n  }\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class TextureLoader extends AbstractLoader\r\n{\r\n\tconstructor(resource_id, url, size)\r\n\t{\r\n\t\tsuper(resource_id, url, size);\r\n\t\tthis.loader = new THREE.TextureLoader();\r\n\t}\r\n\r\n\tload(resource_container)\r\n\t{\r\n\t\tlet ctx = this;\r\n\r\n\t\tthis.loader.load(\tthis.url, (image)=> {\r\n\t\t\tresource_container.set_resource(ctx.resource_id, image);\r\n\t\t\t\tctx.__update_progress(1);\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t},\r\n\t\t\t(xhr) =>{\r\n\t\t\t\tif (xhr) {\r\n\t\t\t\t\tlet total = xhr.total || this.size;\r\n\t\t\t\t\tctx.__update_progress(xhr.loaded / total);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t() => {\r\n\t\t\t\tctx.__set_error(\"Image could not  be loaded. Maybe wrong name or path, I don't know\" + '\\\\_()_/');\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class GLTFLoader extends AbstractLoader\r\n{\r\n\tconstructor(resource_id, url, size)\r\n\t{\r\n\t\tsuper(resource_id, url, size);\r\n\t\tthis.loader = new THREE.GLTFLoader();\r\n\t}\r\n\r\n\tload(resource_container)\r\n\t{\r\n\t\tlet ctx = this;\r\n\r\n\t\tthis.loader.load(\tthis.url, (gltf)=> {\r\n\t\t\tresource_container.set_resource(ctx.resource_id, gltf);\r\n\t\t\t\tctx.__update_progress(1);\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t},\r\n\t\t\t(xhr) =>{\r\n\t\t\t\tif (xhr) {\r\n\t\t\t\t\tlet total = xhr.total || this.size;\r\n\t\t\t\t\tctx.__update_progress(THREE.Math.clamp(xhr.loaded / total), 0,1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t(msg) => {\r\n\t\t\t\tctx.__set_error(msg +\"\\n\\n\\t If the error says something about unexpected token < in JSON then the probably the problem is related to the file not being found. Check the name and path of the resource\");\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class DAELoader extends AbstractLoader\r\n{\r\n\tconstructor(resource_id, url, size)\r\n\t{\r\n\t\tsuper(resource_id, url, size);\r\n\t\tthis.loader = new THREE.ColladaLoader();\r\n\t}\r\n\r\n\tload(resource_container)\r\n\t{\r\n\t\tlet ctx = this;\r\n\r\n\t\tthis.loader.load(\tthis.url, (gltf)=> {\r\n\t\t\tresource_container.set_resource(ctx.resource_id, gltf);\r\n\t\t\t\tctx.__update_progress(1);\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t},\r\n\t\t\t(xhr) =>{\r\n\t\t\t\tif (xhr) {\r\n\t\t\t\t\tlet total = xhr.total || this.size;\r\n\t\t\t\t\tctx.__update_progress(xhr.loaded / total);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t(msg) => {\r\n\t\t\t\tctx.__set_error(msg +\"\\n\\n\\t If the error says something about unexpected token < in JSON then the probably the problem is related to the file not being found. Check the name and path of the resource\");\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class TextLoader extends AbstractLoader\r\n{\r\n\tconstructor(resource_id, url, size)\r\n\t{\r\n\t\tsuper(resource_id, url, size);\r\n\t\tthis.loader = new THREE.FileLoader();\r\n\t}\r\n\r\n\tload(resource_container)\r\n\t{\r\n\t\tlet ctx = this;\r\n\r\n\t\tthis.loader.load(\tthis.url, (gltf)=> {\r\n\t\t\tresource_container.set_resource(ctx.resource_id, gltf);\r\n\t\t\t\tctx.__update_progress(1);\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t},\r\n\t\t\t(xhr) =>{\r\n\t\t\t\tif (xhr) {\r\n\t\t\t\t\tlet total = xhr.total || this.size;\r\n\t\t\t\t\tctx.__update_progress(xhr.loaded / total);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t(msg) => {\r\n\t\t\t\tctx.__set_error(msg);\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class CubemapLoader extends AbstractLoader\r\n{\r\n\tconstructor(resource_id, url, size)\r\n\t{\r\n\t\tsuper(resource_id, url, size);\r\n\t\tthis.loader = new THREE.CubeTextureLoader();\r\n\t\tthis.loader.setPath(url + \"/\");\r\n\t\tthis.urls = [\r\n\t\t\t'px.png',\r\n\t\t\t'nx.png',\r\n\t\t\t'py.png',\r\n\t\t\t'ny.png',\r\n\t\t\t'pz.png',\r\n\t\t\t'nz.png'\r\n\t\t]\r\n\t}\r\n\r\n\tload(resource_container)\r\n\t{\r\n\t\tlet ctx = this;\r\n\r\n\t\tthis.loader.load(\tthis.urls, (image)=> {\r\n\t\t\tresource_container.set_resource(ctx.resource_id, image);\r\n\t\t\t\tctx.__update_progress(1);\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t},\r\n\t\t\t(xhr) =>{\r\n\t\t\t\tif (xhr) {\r\n\t\t\t\t\tlet total = xhr.total || this.size;\r\n\t\t\t\t\tctx.__update_progress(xhr.loaded / total);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t(error) => {\r\n\t\t\t\tctx.__set_error(\"Image could not  be loaded. Maybe wrong name or path, I don't know\" + '\\\\_()_/', error);\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","export default class AudioClip\r\n{\r\n    constructor(buffer, loop = true, volume = 1)\r\n    {\r\n        this.buffer = buffer;\r\n        this.loop = loop;\r\n        this.volume = volume;\r\n\r\n        this.audio = undefined;\r\n    }\r\n\r\n    init(audio_listener)\r\n    {\r\n        this.audio = new THREE.Audio(audio_listener);\r\n        this.audio.setBuffer(this.buffer);\r\n        this.audio.setLoop(this.loop);\r\n        this.audio.setVolume(this.volume);\r\n    }\r\n\r\n    play()\r\n    {\r\n        this.audio.play();\r\n    }\r\n\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\nimport AudioClip from '/components/AudioClip';\r\n\r\nexport default class AudioLoader extends AbstractLoader\r\n{\r\n\tconstructor(resource_id, url, loop = true, volume = 1, size)\r\n\t{\r\n\t\tsuper(resource_id, url, size);\r\n\t\tthis.loader = new THREE.AudioLoader();\r\n\t\tthis.loop = loop;\r\n\t\tthis.volume = volume;\r\n\t}\r\n\r\n\tload(resource_container)\r\n\t{\r\n\t\tlet ctx = this;\r\n\r\n\t\tthis.loader.load(this.url, (buffer)=> {\r\n\r\n\t\t\tresource_container.set_resource(ctx.resource_id, new AudioClip(buffer, this.loop, this.volume));\r\n\r\n\r\n\t\t\tctx.__update_progress(1);\r\n\t\t\tctx.__loading_ended()\r\n\t\t},\r\n\t\t(xhr) =>{\r\n\t\t\tif (xhr) {\r\n\t\t\t\tlet total = xhr.total || this.size;\r\n\t\t\t\tctx.__update_progress(xhr.loaded / total);\r\n\t\t\t}\r\n\t\t},\r\n\t\t(error) => {\r\n\t\t\tctx.__set_error(\"Audio could not be loaded. Maybe wrong name or path, I don't know\" + '\\\\_()_/', error);\r\n\t\t\tctx.__loading_ended()\r\n\t\t});\r\n\t}\r\n\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class OBJLoader extends AbstractLoader {\r\n    constructor(resource_id, url, size)\r\n    {\r\n        super(resource_id, url, size);\r\n        this.loader = new THREE.OBJLoader();\r\n    }\r\n\r\n    load(resource_container) {\r\n        let ctx = this;\r\n\r\n        this.loader.load(this.url, (gltf) => {\r\n                resource_container.set_resource(ctx.resource_id, gltf);\r\n                ctx.__update_progress(1);\r\n                ctx.__loading_ended()\r\n            },\r\n            (xhr) =>{\r\n                if (xhr) {\r\n                    let total = xhr.total || this.size;\r\n                    ctx.__update_progress(xhr.loaded / total);\r\n                }\r\n            },\r\n            (msg) => {\r\n                ctx.__set_error(msg + \"\\n\\n\\t If the error says something about unexpected token < in JSON then probably the problem is related to the file not being found. Check the name and path of the resource\");\r\n                ctx.__loading_ended()\r\n            }\r\n        );\r\n    }\r\n\r\n}\r\n","import AbstractLoader from './AbstractLoader';\r\n\r\nexport default class RGBETextureLoader extends AbstractLoader\r\n{\r\n  constructor(resource_id, url, size)\r\n  {\r\n    super(resource_id, url, size);\r\n    this.loader = new THREE.RGBELoader();\r\n    this.loader.setDataType( THREE.UnsignedByteType );\r\n\r\n  }\r\n\r\n  load(resource_container)\r\n  {\r\n    let ctx = this;\r\n\r\n    this.loader.load( this.url, (hdr)=> {\r\n        resource_container.set_resource(ctx.resource_id, hdr);\r\n        ctx.__update_progress(1);\r\n        ctx.__loading_ended()\r\n      },\r\n      (xhr) =>{\r\n\t\t\t\tif (xhr) {\r\n\t\t\t\t\tlet total = xhr.total || this.size;\r\n\t\t\t\t\tctx.__update_progress(xhr.loaded / total);\r\n\t\t\t\t}\r\n\t\t\t},\r\n      (msg) => {\r\n        ctx.__set_error(msg +\"\\n\\n\\t If the error says something about unexpected token < in JSON then the probably the problem is related to the file not being found. Check the name and path of the resource\");\r\n        ctx.__loading_ended()\r\n      }\r\n    );\r\n  }\r\n\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class PointArrayLoader extends AbstractLoader {\r\n    constructor(resource_id, url, size)\r\n    {\r\n        super(resource_id, url, size);\r\n        this.loader = new THREE.FileLoader();\r\n    }\r\n\r\n    load(resource_container) {\r\n        let ctx = this;\r\n\r\n        this.loader.load(this.url, (text) => {\r\n                resource_container.set_resource(ctx.resource_id, ctx.parse_path(text));\r\n                ctx.__update_progress(1);\r\n                ctx.__loading_ended()\r\n            },\r\n            (xhr) =>{\r\n                if (xhr) {\r\n                    let total = xhr.total || this.size;\r\n                    ctx.__update_progress(xhr.loaded / total);\r\n                }\r\n            },\r\n            (msg) => {\r\n                ctx.__set_error(msg);\r\n                ctx.__loading_ended()\r\n            }\r\n        );\r\n    }\r\n\r\n    parse_path(raw_data) {\r\n        let string_array = raw_data.split('\\n');\r\n\r\n        if (string_array[string_array.length - 1] === \"\") {\r\n            string_array.pop();\r\n        }\r\n\r\n        let positions = [];\r\n\r\n        for (let i = 0; i < string_array.length; i += 3) {\r\n            let x = parseFloat(string_array[i + 0]);\r\n            let y = parseFloat(string_array[i + 1]);\r\n            let z = parseFloat(string_array[i + 2]);\r\n            positions.push(new THREE.Vector3(x, y, z));\r\n        }\r\n        return positions;\r\n        // let curve = new THREE.CatmullRomCurve3(positions);\r\n        // return curve.getPoints(100);\r\n    }\r\n\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class HDRCubeTextureLoader extends AbstractLoader\r\n{\r\n\tconstructor(resource_id, url, size)\r\n\t{\r\n\t\tsuper(resource_id, url, size);\r\n\t\tthis.loader = new THREE.HDRCubeTextureLoader();\r\n\t\tthis.url_suffix = [ '/px.hdr', '/nx.hdr', '/py.hdr', '/ny.hdr', '/pz.hdr', '/nz.hdr' ];\r\n\r\n\r\n\t}\r\n\r\n\tload(resource_container)\r\n\t{\r\n\t\tlet ctx = this;\r\n\r\n\t\tthis.loader.setPath( this.url)\r\n\t\t\t\t\t.setDataType( THREE.UnsignedByteType )\r\n\t\t\t\t\t.load(\tthis.url_suffix, (hdr)=> {\r\n\t\t\t\tresource_container.set_resource(ctx.resource_id, hdr);\r\n\t\t\t\tctx.__update_progress(1);\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t},\r\n\t\t\t(xhr) =>{\r\n\t\t\t\tif (xhr) {\r\n\t\t\t\t\tlet total = xhr.total || this.size;\r\n\t\t\t\t\tctx.__update_progress(xhr.loaded / total);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t(msg) => {\r\n\t\t\t\tctx.__set_error(msg +\"\\n\\n\\t If the error says something about unexpected token < in JSON then the probably the problem is related to the file not being found. Check the name and path of the resource\");\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import AbstractLoader from '/resource_loader/AbstractLoader';\r\n\r\nexport default class GLTFDRACOLoader extends AbstractLoader\r\n{\r\n\tconstructor(resource_id, url, size)\r\n\t{\r\n\t\tsuper(resource_id, url, size);\r\n\t\tthis.loader = new THREE.GLTFLoader();\r\n\t\tthis.draco_loader = new THREE.DRACOLoader();\r\n\r\n\t\tthis.draco_loader.setDecoderPath( 'libs/three/gltf/' );\r\n\t\tthis.draco_loader.setDecoderConfig({type: 'js'});\r\n\t\tthis.loader.setDRACOLoader( this.draco_loader );\r\n\t}\r\n\r\n\tload(resource_container)\r\n\t{\r\n\t\tlet ctx = this;\r\n\r\n\t\tthis.loader.load(\tthis.url, (gltf)=> {\r\n\t\t\tresource_container.set_resource(ctx.resource_id, gltf);\r\n\t\t\t\tctx.__update_progress(1);\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t},\r\n\t\t\t(xhr) =>{\r\n\t\t\t\tif (xhr) {\r\n\t\t\t\t\tlet total = xhr.total || this.size;\r\n\t\t\t\t\tctx.__update_progress(THREE.Math.clamp(xhr.loaded / total), 0,1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t(msg) => {\r\n\t\t\t\tctx.__set_error(msg +\"\\n\\n\\t If the error says something about unexpected token < in JSON then the probably the problem is related to the file not being found. Check the name and path of the resource\");\r\n\t\t\t\tctx.__loading_ended()\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","import TextureLoader from '/resource_loader/TextureLoader';\r\nimport GLTFLoader from '/resource_loader/GLTFLoader';\r\nimport DAELoader from '/resource_loader/DAELoader';\r\nimport TextLoader from '/resource_loader/TextLoader';\r\nimport CubemapLoader from '/resource_loader/CubemapLoader';\r\nimport AudioLoader from '/resource_loader/AudioLoader';\r\nimport JSONLoader from '/resource_loader/JSONLoader';\r\nimport OBJLoader from '/resource_loader/OBJLoader';\r\nimport RGBETextureLoader from '/resource_loader/RGBETextureLoader';\r\nimport PointArrayLoader from '/resource_loader/PointArrayLoader';\r\nimport HDRCubeTextureLoader from '/resource_loader/HDRCubeTextureLoader';\r\nimport ResourceContainer from '/ResourceContainer';\r\nimport GLTFDRACOLoader from './GLTFDRACOLoader';\r\n\r\nexport default class ResourceBatch\r\n{\r\n\tconstructor(batch_name)\r\n\t{\r\n\t\tthis.resource_loaders = [];\r\n\t\tthis.batch_name = batch_name || \"unnamed batch\";\r\n\t}\r\n\r\n\tadd_texture(resource_id, url, size)\r\n\t{\r\n\t\tthis.resource_loaders.push(new TextureLoader(resource_id, url, size));\r\n\t}\r\n\r\n\tadd_gltf(resource_id, url, size)\r\n\t{\r\n\t\tthis.resource_loaders.push(new GLTFLoader(resource_id, url, size));\r\n\t}\r\n\tadd_gltf_draco(resource_id, url, size)\r\n\t{\r\n\t\tthis.resource_loaders.push(new GLTFDRACOLoader(resource_id, url, size));\r\n\t}\r\n\tadd_dae(resource_id, url, size)\r\n\t{\r\n\t\tthis.resource_loaders.push(new DAELoader(resource_id, url, size));\r\n\t}\r\n\tadd_obj(resource_id, url, size)\r\n\t{\r\n\t\tthis.resource_loaders.push(new OBJLoader(resource_id, url, size));\r\n\t}\r\n\tadd_text(resource_id, url, size)\r\n\t{\r\n\t\tthis.resource_loaders.push(new TextLoader(resource_id, url, size));\r\n\t}\r\n\tadd_cubemap(resource_id, url, size)\r\n\t{\r\n\t\tthis.resource_loaders.push(new CubemapLoader(resource_id, url, size));\r\n\t}\r\n\tadd_audio(resource_id, url, loop, volume, size) {\r\n\t\tthis.resource_loaders.push(new AudioLoader(resource_id, url, loop, volume, size));\r\n\t}\r\n\tadd_json(resource_id, url, size) {\r\n\t\tthis.resource_loaders.push(new JSONLoader(resource_id, url, size));\r\n\t}\r\n\tadd_point_array(resource_id, url, size)\r\n\t{\r\n\t\tthis.resource_loaders.push(new PointArrayLoader(resource_id, url, size));\r\n\t}\r\n\tadd_hdr(resource_id, url, size)\r\n\t{\r\n\t\tthis.resource_loaders.push(new RGBETextureLoader(resource_id, url, size));\r\n\t}\r\n\tadd_hdr_cubemap(resource_id, url, size) {\r\n\t\tthis.resource_loaders.push(new HDRCubeTextureLoader(resource_id, url, size));\r\n\t}\r\n\tadd_loader(loader)\r\n\t{\r\n\t\tthis.resource_loaders.push(loader)\r\n\t}\r\n\r\n\tload(resource_container)\r\n\t{\r\n\t\tfor(let i=0; i< this.resource_loaders.length; i++)\r\n\t\t{\r\n\t\t\tthis.resource_loaders[i].load(resource_container || ResourceContainer);\r\n\t\t}\r\n\t}\r\n\r\n\tget loading_finished()\r\n\t{\r\n\t\tlet finished = true;\r\n\t\tfor(let i=0; i< this.resource_loaders.length; i++)\r\n\t\t{\r\n\t\t\tfinished = finished && this.resource_loaders[i].has_finished;\r\n\t\t}\r\n\t\treturn finished;\r\n\t}\r\n\r\n\tget has_errors()\r\n\t{\r\n\t\tlet has_error = false;\r\n\t\tfor(let i=0; i< this.resource_loaders.length; i++)\r\n\t\t{\r\n\t\t\thas_error = has_error || this.resource_loaders[i].has_error;\r\n\t\t}\r\n\t\treturn has_error;\r\n\t}\r\n\r\n\tprint_errors()\r\n\t{\r\n\t\tconsole.error(\"Batch <\"+this.batch_name+\"> could not load successfully\")\r\n\t\tfor(let i=0; i< this.resource_loaders.length; i++)\r\n\t\t{\r\n\t\t\tif(this.resource_loaders[i].has_error)\r\n\t\t\t\tthis.resource_loaders[i].print_error();\r\n\t\t}\r\n\t}\r\n\r\n\tget_progress()\r\n\t{\r\n\t\tlet progress = 0;\r\n\r\n\t\tfor(let i=0; i< this.resource_loaders.length; i++)\r\n\t\t{\r\n\t\t\tprogress+=this.resource_loaders[i].progress;\r\n\t\t}\r\n\r\n\t\tif (this.resource_loaders.length === 0)\r\n\t\t{\r\n\t\t\treturn 1;\r\n\t\t}\r\n\r\n\t\tif (!progress) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\r\n\t\treturn progress/this.resource_loaders.length;\r\n\t}\r\n}\r\n","import CanvasDrawer from '/canvas_drawer/CanvasDrawer';\r\n\r\nexport default class SimpleTextDrawer extends CanvasDrawer{\r\n\r\n  constructor ()\r\n  {\r\n    super();\r\n    this.text_margin = new THREE.Vector2(2,0);\r\n  }\r\n\r\n  __draw (text, ctxOptions, canvas, ctx)\r\n  {\r\n    ctx.font = ctxOptions.font;\r\n\r\n    let text_size = this.get_text_size(text, ctxOptions.font);\r\n    // canvas.width = THREE.Math.ceilPowerOfTwo(text_size.x+this.text_margin.x*2);\r\n    // canvas.height = THREE.Math.ceilPowerOfTwo(text_size.y+ this.text_margin.y*2);\r\n    canvas.width = Math.ceil(text_size.x+this.text_margin.x*2);\r\n    canvas.height = Math.ceil(text_size.y+ this.text_margin.y*2);\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // ctx.globalAlpha = 0.2;\r\n    // ctx.fillStyle = \"#FF0000\";\r\n    // ctx.fillRect(0,0, canvas.width, canvas.height);\r\n\r\n\r\n\r\n    ctx.globalAlpha = 1;\r\n\r\n    ctx.font = ctxOptions.font;\r\n    ctx.fillStyle = ctxOptions.font_color || \"#000000\";\r\n    ctx.textBaseline = \"middle\";\r\n    ctx.textAlignment = \"left\";\r\n    ctx.fillText(text, 0, canvas.height/2);\r\n  }\r\n\r\n}\r\n","// This class helps with parsing an entire recording that spans several days, into one-day recordings\r\n// that start at 0:00:00 and ends at 23:59:59, except for the first and last day of a recording range\r\nexport default class TimeUtilities\r\n{\r\n\tconstructor(){}\r\n\r\n}\r\n\r\n","export default class Validation\r\n{\r\n\tconstructor(){}\r\n\r\n  static is_int(n) {\r\n    return Number(n) === n && n % 1 === 0;\r\n  }\r\n\r\n  static is_float(n) {\r\n    return Number(n) === n && n % 1 !== 0;\r\n  }\r\n\r\n  static is_json(str)\r\n  {\r\n    try {\r\n      JSON.parse(str);\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","import ArrayUtilities from '/utilities/ArrayUtilities.js';\r\nimport BaseApplication from '/BaseApplication';\r\nimport BaseShaderMaterial from '/materials/BaseShaderMaterial';\r\nimport CameraManager from '/CameraManager';\r\nimport CameraUtilities from '/utilities/CameraUtilities';\r\nimport Capabilities from '/Capabilities';\r\nimport Components from '/Components';\r\nimport CanvasDrawer from '/canvas_drawer/CanvasDrawer';\r\nimport Configuration from '/Configuration';\r\nimport Debug from '/Debug';\r\nimport DebugNormalsRender from '/render_mode/DebugNormalsRender';\r\nimport EasingFunctions from '/utilities/EasingFunctions';\r\nimport EventManager from '/EventManager';\r\nimport Graphics from '/Graphics';\r\nimport ImageUtilities from '/utilities/ImageUtilities';\r\nimport Input from '/Input';\r\nimport JSONLoader from '/resource_loader/JSONLoader';\r\nimport MathUtilities from '/utilities/MathUtilities';\r\nimport ModelUtilities from '/utilities/ModelUtilities';\r\nimport MeshSampler from '/utilities/MeshSampler';\r\nimport NormalAORender from '/render_mode/NormalAORender';\r\nimport NormalRender from '/render_mode/NormalRender';\r\nimport ObjectUtilities from '/utilities/ObjectUtilities';\r\nimport PerspectiveCamera from '/PerspectiveCamera';\r\nimport RenderLoop from '/RenderLoop';\r\nimport ResourceBatch from '/resource_loader/ResourceBatch';\r\nimport ResourceContainer from '/ResourceContainer';\r\nimport SceneManager from '/SceneManager';\r\nimport Screen from '/Screen';\r\nimport SimpleTextDrawer from '/canvas_drawer/SimpleTextDrawer';\r\nimport Time from '/Time';\r\nimport TimeUtilities from '/utilities/TimeUtilities';\r\nimport UI from '/UI';\r\nimport Validation from '/utilities/Validation';\r\n\r\nmodule.exports = {\r\n  ArrayUtilities: ArrayUtilities,\r\n  BaseApplication: BaseApplication,\r\n  BaseShaderMaterial: BaseShaderMaterial,\r\n  CameraManager: CameraManager,\r\n  CameraUtilities: CameraUtilities,\r\n  CanvasDrawer: CanvasDrawer,\r\n  Capabilities: Capabilities,\r\n  Components: Components,\r\n  Configuration: Configuration,\r\n  Debug: Debug,\r\n  DebugNormalsRender: DebugNormalsRender,\r\n  EasingFunctions: EasingFunctions,\r\n  EventManager: EventManager,\r\n  Graphics: Graphics,\r\n  ImageUtilities: ImageUtilities,\r\n  Input: Input,\r\n  JSONLoader: JSONLoader,\r\n  MathUtilities: MathUtilities,\r\n  ModelUtilities: ModelUtilities,\r\n  NormalAORender: NormalAORender,\r\n  NormalRender: NormalRender,\r\n  ObjectUtilities: ObjectUtilities,\r\n  PerspectiveCamera: PerspectiveCamera,\r\n  RenderLoop: RenderLoop,\r\n  ResourceBatch: ResourceBatch,\r\n  ResourceContainer: ResourceContainer,\r\n  SceneManager: SceneManager,\r\n  Screen: Screen,\r\n  SimpleTextDrawer: SimpleTextDrawer,\r\n  Time: Time,\r\n  TimeUtilities: TimeUtilities,\r\n  UI: UI,\r\n  Validation: Validation,\r\n  MeshSampler: MeshSampler\r\n}\r\n"]}